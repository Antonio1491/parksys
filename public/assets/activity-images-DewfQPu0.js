import{a4 as f,l as Q,az as R,u as q,ar as S,aC as K,j as e,f as N,g as C,h as k,cN as M,ad as z,i as b,Q as u,B as i,b0 as d,V as I,b as U,X as B,k as H,aH as O,bh as E,A as G}from"./index-BKCBrrzQ.js";import{S as J}from"./star-off-DFRAJhdR.js";const X=({activityId:s,onImageUploaded:o,showUploadOnly:t=!1})=>{const[n,p]=f.useState(null),[j,P]=f.useState(null),[g,w]=f.useState(""),m=f.useRef(null),{toast:l}=Q(),y=R(),{data:h=[],isLoading:T}=q({queryKey:[`/api/activities/${s}/images`],enabled:!!s&&!t}),x=S({mutationFn:async a=>{if(!s)throw new Error("ID de actividad requerido");const c=localStorage.getItem("token")||"direct-token-1750522117022",r=await fetch(`/api/activities/${s}/images`,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:a});if(!r.ok){const v=await r.text();throw new Error(`Error al subir imagen: ${r.status} ${v}`)}return await r.json()},onSuccess:a=>{l({title:"Imagen subida",description:"La imagen se ha subido exitosamente"}),p(null),P(null),w(""),m.current&&(m.current.value=""),y.invalidateQueries({queryKey:[`/api/activities/${s}/images`]}),o&&o(a)},onError:a=>{l({title:"Error",description:`No se pudo subir la imagen: ${a.message}`,variant:"destructive"})}}),$=S({mutationFn:async a=>await K(`/api/activities/${s}/images/${a}`,{method:"DELETE"}),onSuccess:()=>{l({title:"Imagen eliminada",description:"La imagen se ha eliminado exitosamente"}),y.invalidateQueries({queryKey:[`/api/activities/${s}/images`]})},onError:()=>{l({title:"Error",description:"No se pudo eliminar la imagen",variant:"destructive"})}}),A=S({mutationFn:async a=>{const c=localStorage.getItem("token")||"direct-token-1750522117022";if(!(await fetch(`/api/activities/${s}/images/${a}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({isPrimary:!0})})).ok)throw new Error("Error al establecer imagen principal")},onSuccess:()=>{l({title:"Imagen principal actualizada",description:"La imagen principal se ha actualizado exitosamente"}),y.invalidateQueries({queryKey:[`/api/activities/${s}/images`]})},onError:()=>{l({title:"Error",description:"No se pudo actualizar la imagen principal",variant:"destructive"})}}),F=a=>{var r;const c=(r=a.target.files)==null?void 0:r[0];if(c){p(c);const v=new FileReader;v.onload=V=>{var D;P((D=V.target)==null?void 0:D.result)},v.readAsDataURL(c)}},L=async()=>{if(!n){l({title:"Error",description:"Por favor selecciona una imagen",variant:"destructive"});return}const a=new FormData;a.append("image",n),g&&a.append("caption",g),x.mutate(a)};return t||!s?e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Subir Imagen"]}),e.jsx(z,{children:s?"Selecciona una imagen para la actividad":"Primero guarda la actividad para poder subir imágenes"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Seleccionar Imagen"}),e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:F,disabled:!s,className:"hidden"}),e.jsxs(i,{type:"button",variant:"outline",onClick:()=>{var a;return(a=m.current)==null?void 0:a.click()},disabled:!s,className:"w-full mt-2",children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),"Seleccionar Imagen"]})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Vista previa:"}),e.jsx("div",{className:"relative w-full h-48 border rounded-lg overflow-hidden",children:e.jsx("img",{src:j,alt:"Vista previa",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"caption",children:"Descripción (opcional)"}),e.jsx(I,{id:"caption",value:g,onChange:a=>w(a.target.value),placeholder:"Describe la imagen...",disabled:!s})]}),e.jsx(i,{onClick:L,disabled:!n||!s||x.isPending,className:"w-full",children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),"Subir Imagen"]})})]})]}):T?e.jsx(N,{children:e.jsx(b,{className:"p-6",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#00a587]"})})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"Subir Nueva Imagen"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Seleccionar Imagen"}),e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:F,className:"hidden"}),e.jsxs(i,{type:"button",variant:"outline",onClick:()=>{var a;return(a=m.current)==null?void 0:a.click()},className:"w-full mt-2",children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),"Seleccionar Imagen"]})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Vista previa:"}),e.jsx("div",{className:"relative w-full h-48 border rounded-lg overflow-hidden",children:e.jsx("img",{src:j,alt:"Vista previa",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"caption",children:"Descripción (opcional)"}),e.jsx(I,{id:"caption",value:g,onChange:a=>w(a.target.value),placeholder:"Describe la imagen..."})]}),e.jsx(i,{onClick:L,disabled:!n||x.isPending,className:"w-full bg-[#00a587] hover:bg-[#067f5f]",children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),"Subir Imagen"]})})]})]}),h.length>0&&e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsx(k,{children:"Imágenes de la Actividad"}),e.jsxs(z,{children:[h.length," imagen",h.length!==1?"es":""," subida",h.length!==1?"s":""]})]}),e.jsx(b,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(a=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"relative aspect-video border rounded-lg overflow-hidden",children:[e.jsx("img",{src:a.imageUrl,alt:a.caption||"Imagen de actividad",className:"w-full h-full object-cover"}),a.isPrimary&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white px-2 py-1 rounded-md text-xs font-medium flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),"Principal"]}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[!a.isPrimary&&e.jsx(i,{size:"sm",variant:"secondary",onClick:()=>A.mutate(a.id),disabled:A.isPending,className:"h-8 w-8 p-0",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"destructive",onClick:()=>$.mutate(a.id),disabled:$.isPending,className:"h-8 w-8 p-0",children:e.jsx(B,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[a.caption&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:a.caption}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Subida el ",new Date(a.createdAt).toLocaleDateString("es-ES")]})]})]},a.id))})})]})]})},Z=()=>{const{id:s}=H(),[,o]=O(),t=parseInt(s||"0"),{data:n,isLoading:p}=q({queryKey:["/api/activities",t],enabled:!!t});return p?e.jsx(E,{children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#00a587] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Cargando actividad..."})]})})})}):n?e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>o("/admin/activities"),className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Imágenes"}),e.jsxs("p",{className:"text-gray-500",children:["Actividad: ",n.title]})]})]}),e.jsx(i,{onClick:()=>o(`/admin/organizador/catalogo/editar/${t}`),variant:"outline",children:"Editar Actividad"})]}),e.jsx(X,{activityId:t})]})}):e.jsx(E,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Actividad no encontrada"}),e.jsx(i,{onClick:()=>o("/admin/activities"),children:"Volver a Actividades"})]})})})};export{Z as default};
