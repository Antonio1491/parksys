import{c as ee,aH as je,l as be,az as ye,a4 as c,u as R,ar as v,j as e,bh as z,B as l,f as Z,ao as fe,bv as G,a6 as ve,V as P,X as Ne,g as Ce,h as we,dc as W,bV as Y,ad as Ee,i as Se,bH as ke,bI as Le,bJ as _,bK as k,bL as ze,bM as L,y as F,I as T,J as I,K as A,N as M,Q as N,a1 as re,b5 as Fe,bE as Te,v as Ie,a3 as Ae}from"./index-BKCBrrzQ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=ee("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=ee("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Pe=({mode:t,initialData:a,onClose:o,onSubmit:p,isSubmitting:j})=>{const[i,y]=c.useState((a==null?void 0:a.name)||""),[d,g]=c.useState((a==null?void 0:a.description)||""),[u,x]=c.useState((a==null?void 0:a.color)||"#3b82f6"),m=h=>{h.preventDefault(),p({id:a==null?void 0:a.id,name:i,description:d,color:u})};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nombre de la categoría"}),e.jsx(P,{id:"name",value:i,onChange:h=>y(h.target.value),placeholder:"Ej: Daños, Mantenimiento, Seguridad",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Descripción"}),e.jsx(re,{id:"description",value:d,onChange:h=>g(h.target.value),placeholder:"Describe el propósito de esta categoría...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"color",children:"Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"color",id:"color",value:u,onChange:h=>x(h.target.value),className:"w-12 h-8 rounded border"}),e.jsx("span",{className:"text-sm text-gray-500",children:u})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:o,children:"Cancelar"}),e.jsx(l,{type:"submit",disabled:j||!i.trim(),children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t==="create"?"Creando...":"Actualizando..."]}):t==="create"?"Crear categoría":"Actualizar categoría"})]})]})},qe=({mode:t,initialData:a,parentCategoryId:o,categories:p,onClose:j,onSubmit:i,isSubmitting:y})=>{var S;const[d,g]=c.useState((a==null?void 0:a.name)||""),[u,x]=c.useState((a==null?void 0:a.description)||""),[m,h]=c.useState(((S=a==null?void 0:a.categoryId)==null?void 0:S.toString())||(o==null?void 0:o.toString())||""),C=n=>{n.preventDefault(),i({id:a==null?void 0:a.id,name:d,description:u,categoryId:parseInt(m)})};return e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"category",children:"Categoría principal"}),e.jsxs("select",{id:"category",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:m,onChange:n=>h(n.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),p.map(n=>e.jsx("option",{value:n.id.toString(),children:n.name},n.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nombre de la subcategoría"}),e.jsx(P,{id:"name",value:d,onChange:n=>g(n.target.value),placeholder:"Ej: Juegos infantiles, Iluminación, Baños",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Descripción"}),e.jsx(re,{id:"description",value:u,onChange:n=>x(n.target.value),placeholder:"Describe el propósito de esta subcategoría...",rows:3})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:j,children:"Cancelar"}),e.jsx(l,{type:"submit",disabled:y||!d.trim()||!m,children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t==="create"?"Creando...":"Actualizando..."]}):t==="create"?"Crear subcategoría":"Actualizar subcategoría"})]})]})},Be=({isOpen:t,onClose:a,onConfirm:o,isDeleting:p,itemType:j,itemName:i})=>e.jsx(F,{open:t,onOpenChange:a,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(A,{children:"Confirmar eliminación"}),e.jsx(M,{children:j==="category"?"Esta acción eliminará la categoría y todas sus subcategorías. Las incidencias asociadas se mantendrán pero perderán su categorización.":"Esta acción eliminará la subcategoría. Las incidencias asociadas se mantendrán pero perderán su subcategorización."})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex items-center p-4 bg-amber-50 text-amber-800 rounded-md",children:[e.jsx(Fe,{className:"h-5 w-5 mr-2 text-amber-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["¿Estás seguro de eliminar ",j==="category"?"la categoría":"la subcategoría",' "',i,'"?']}),e.jsx("p",{className:"text-sm",children:"Esta acción no se puede deshacer."})]})]})}),e.jsxs(Te,{children:[e.jsx(l,{variant:"outline",onClick:a,children:"Cancelar"}),e.jsx(l,{variant:"destructive",onClick:o,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Eliminando..."]}):"Eliminar"})]})]})}),Oe=()=>{je();const{toast:t}=be(),a=ye(),[o,p]=c.useState(""),[j,i]=c.useState(!1),[y,d]=c.useState(!1),[g,u]=c.useState(null),[x,m]=c.useState(null),[h,C]=c.useState(void 0),[S,n]=c.useState(!1),[b,w]=c.useState(null),[E,q]=c.useState("category"),{data:B=[],isLoading:ae,isError:se,refetch:te}=R({queryKey:["/api/incident-categories"],onError:r=>{console.error("Error al cargar categorías:",r),t({title:"Error",description:"No se pudieron cargar las categorías",variant:"destructive"})}}),{data:oe=[],isLoading:ne,refetch:Qe}=R({queryKey:["/api/incident-subcategories"],onError:r=>{console.error("Error al cargar subcategorías:",r),t({title:"Error",description:"No se pudieron cargar las subcategorías",variant:"destructive"})}}),Q=v({mutationFn:async r=>{const s=await fetch("/api/incident-categories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify(r)});if(!s.ok)throw new Error("Error al crear la categoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-categories"]}),i(!1),t({title:"Categoría creada",description:"La categoría ha sido creada correctamente"})},onError:r=>{console.error("Error al crear categoría:",r),t({title:"Error",description:"No se pudo crear la categoría",variant:"destructive"})}}),K=v({mutationFn:async r=>{const s=await fetch(`/api/incident-categories/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify({name:r.name,description:r.description,color:r.color})});if(!s.ok)throw new Error("Error al actualizar la categoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-categories"]}),u(null),i(!1),t({title:"Categoría actualizada",description:"La categoría ha sido actualizada correctamente"})},onError:r=>{console.error("Error al actualizar categoría:",r),t({title:"Error",description:"No se pudo actualizar la categoría",variant:"destructive"})}}),O=v({mutationFn:async r=>{if(!(await fetch(`/api/incident-categories/${r}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-admin","X-User-Id":"1"}})).ok)throw new Error("Error al eliminar la categoría");return!0},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-categories"]}),a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),n(!1),w(null),t({title:"Categoría eliminada",description:"La categoría ha sido eliminada correctamente"})},onError:r=>{console.error("Error al eliminar categoría:",r),t({title:"Error",description:"No se pudo eliminar la categoría",variant:"destructive"})}}),U=v({mutationFn:async r=>{const s=await fetch("/api/incident-subcategories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify(r)});if(!s.ok)throw new Error("Error al crear la subcategoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),d(!1),C(void 0),t({title:"Subcategoría creada",description:"La subcategoría ha sido creada correctamente"})},onError:r=>{console.error("Error al crear subcategoría:",r),t({title:"Error",description:"No se pudo crear la subcategoría",variant:"destructive"})}}),H=v({mutationFn:async r=>{const s=await fetch(`/api/incident-subcategories/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify({name:r.name,description:r.description,categoryId:r.categoryId})});if(!s.ok)throw new Error("Error al actualizar la subcategoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),m(null),d(!1),t({title:"Subcategoría actualizada",description:"La subcategoría ha sido actualizada correctamente"})},onError:r=>{console.error("Error al actualizar subcategoría:",r),t({title:"Error",description:"No se pudo actualizar la subcategoría",variant:"destructive"})}}),J=v({mutationFn:async r=>{if(!(await fetch(`/api/incident-subcategories/${r}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-admin","X-User-Id":"1"}})).ok)throw new Error("Error al eliminar la subcategoría");return!0},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),n(!1),w(null),t({title:"Subcategoría eliminada",description:"La subcategoría ha sido eliminada correctamente"})},onError:r=>{console.error("Error al eliminar subcategoría:",r),t({title:"Error",description:"No se pudo eliminar la subcategoría",variant:"destructive"})}}),X=B.filter(r=>r.name.toLowerCase().includes(o.toLowerCase())||r.description&&r.description.toLowerCase().includes(o.toLowerCase())),V=oe.reduce((r,s)=>(r[s.categoryId]||(r[s.categoryId]=[]),r[s.categoryId].push(s),r),{}),ie=r=>V[r]?V[r].filter(s=>s.name.toLowerCase().includes(o.toLowerCase())||s.description&&s.description.toLowerCase().includes(o.toLowerCase())):[],ce=r=>{Q.mutate(r)},le=r=>{K.mutate(r)},de=r=>{w(r),q("category"),n(!0)},ue=()=>{b&&E==="category"&&O.mutate(b.id)},me=r=>{U.mutate(r)},he=r=>{H.mutate(r)},ge=r=>{w(r),q("subcategory"),n(!0)},xe=()=>{b&&E==="subcategory"&&J.mutate(b.id)},pe=r=>Ie(new Date(r),"d MMM yyyy",{locale:Ae});return ae||ne?e.jsx(z,{children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})})})}):se?e.jsx(z,{children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error al cargar categorías"}),e.jsx("p",{className:"mb-4",children:"No se pudieron cargar las categorías de incidencias."}),e.jsx(l,{onClick:()=>te(),children:"Reintentar"})]})})}):e.jsxs(z,{children:[e.jsxs("div",{className:"p-6",children:[e.jsx(Z,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Categorías de incidencias"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestión de categorías y subcategorías para clasificar incidencias"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(l,{variant:"outline",onClick:()=>{m(null),d(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Nueva subcategoría"]}),e.jsxs(l,{onClick:()=>{u(null),i(!0)},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Nueva categoría"]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(P,{type:"search",placeholder:"Buscar categorías y subcategorías...",className:"pl-8",value:o,onChange:r=>p(r.target.value)}),o&&e.jsx("button",{onClick:()=>p(""),className:"absolute right-2.5 top-2.5 text-gray-500 hover:text-gray-700",children:e.jsx(Ne,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-6",children:X.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4",children:e.jsx(Me,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No hay categorías"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No se encontraron categorías con los criterios de búsqueda."}),e.jsxs(l,{onClick:()=>i(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Crear primera categoría"]})]}):X.map(r=>{var $;const s=ie(r.id);return o&&s.length===0&&!r.name.toLowerCase().includes(o.toLowerCase())&&!(($=r.description)!=null&&$.toLowerCase().includes(o.toLowerCase()))?null:e.jsxs(Z,{className:"overflow-hidden",children:[e.jsxs(Ce,{className:"bg-gray-50 pb-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:r.color||"#3b82f6"}}),e.jsx(we,{children:r.name})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 md:mt-0",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>{C(r.id),m(null),d(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Añadir subcategoría"]}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>{u(r),i(!0)},children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>de(r),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]}),r.description&&e.jsx(Ee,{className:"mt-2",children:r.description})]}),e.jsx(Se,{children:s.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No hay subcategorías definidas"}):e.jsxs(ke,{children:[e.jsx(Le,{children:e.jsxs(_,{children:[e.jsx(k,{children:"Nombre"}),e.jsx(k,{children:"Descripción"}),e.jsx(k,{children:"Creada"}),e.jsx(k,{className:"text-right",children:"Acciones"})]})}),e.jsx(ze,{children:s.map(f=>e.jsxs(_,{children:[e.jsx(L,{className:"font-medium",children:f.name}),e.jsx(L,{className:"max-w-md truncate",children:f.description||"-"}),e.jsx(L,{children:pe(f.createdAt)}),e.jsx(L,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{m(f),d(!0)},children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>ge(f),children:e.jsx(Y,{className:"h-4 w-4"})})]})})]},f.id))})]})})]},r.id)})})]}),e.jsx(F,{open:j,onOpenChange:i,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(A,{children:g?"Editar categoría":"Nueva categoría"}),e.jsx(M,{children:g?"Actualiza los detalles de esta categoría de incidencias":"Crea una nueva categoría para clasificar incidencias"})]}),e.jsx(Pe,{mode:g?"edit":"create",initialData:g,onClose:()=>{i(!1),u(null)},onSubmit:g?le:ce,isSubmitting:g?K.isPending:Q.isPending})]})}),e.jsx(F,{open:y,onOpenChange:d,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(A,{children:x?"Editar subcategoría":"Nueva subcategoría"}),e.jsx(M,{children:x?"Actualiza los detalles de esta subcategoría":"Crea una nueva subcategoría para clasificar incidencias de forma más específica"})]}),e.jsx(qe,{mode:x?"edit":"create",initialData:x,parentCategoryId:h,categories:B,onClose:()=>{d(!1),m(null),C(void 0)},onSubmit:x?he:me,isSubmitting:x?H.isPending:U.isPending})]})}),e.jsx(Be,{isOpen:S,onClose:()=>{n(!1),w(null)},onConfirm:E==="category"?ue:xe,isDeleting:E==="category"?O.isPending:J.isPending,itemType:E,itemName:(b==null?void 0:b.name)||""})]})};export{Oe as default};
