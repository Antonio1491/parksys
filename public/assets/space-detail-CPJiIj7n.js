import{ay as l,k as ie,aH as te,l as ne,az as le,a4 as I,u as D,aA as ce,ar as oe,j as e,a as k,B as g,A as de,M as E,f as v,g as b,h as N,q as P,e as me,i as f,U as J,p as xe,n as T,al as he,F as pe,b as je,O as ue,af as ge,y as ve,I as be,J as Ne,K as fe,N as ye,aI as we,aJ as c,aK as o,aL as d,aM as m,V as C,aN as p,v as _,aO as $,W as L,Y as B,_ as M,$ as V,a0 as K,a1 as Ce,aP as Se,aQ as De,T as O,am as Te,aB as ke,aC as Re,aR as Ae,aS as Fe,aT as He}from"./index-BKCBrrzQ.js";import{P as Q}from"./PublicLayout-Cks6Enyp.js";import{T as U}from"./trophy-Dl0yD0QC.js";import{C as qe}from"./coffee-Bt9rJuMz.js";const Ie=l.object({customerName:l.string().min(2,"El nombre debe tener al menos 2 caracteres"),customerEmail:l.string().email("Email inválido"),customerPhone:l.string().min(10,"El teléfono debe tener al menos 10 dígitos"),reservationDate:l.string().min(1,"Selecciona una fecha"),startTime:l.string().min(1,"Selecciona hora de inicio"),endTime:l.string().min(1,"Selecciona hora de fin"),specialRequests:l.string().optional(),acceptsTerms:l.boolean().refine(i=>i===!0,{message:"Debes aceptar los términos y condiciones"})}),Ee={playground:"Área de Juegos",kiosk:"Kiosco",open_area:"Área Abierta",pavilion:"Pabellón",amphitheater:"Anfiteatro",sports_court:"Cancha Deportiva",garden:"Jardín",picnic_area:"Zona de Picnic"},Pe={playground:U,kiosk:qe,open_area:O,pavilion:k,amphitheater:J,sports_court:U,garden:O,picnic_area:Te};function Oe(){const{id:i}=ie(),[_e,R]=te(),{toast:x}=ne(),A=le(),[z,y]=I.useState(!1),[F,G]=I.useState(0),{data:a,isLoading:X}=D({queryKey:[`/api/reservable-spaces/${i}`],enabled:!!i}),{data:W=[]}=D({queryKey:[`/api/space-reservations/space/${i}`],enabled:!!i}),{data:u}=D({queryKey:[`/api/space-reservations/stats/${i}`],enabled:!!i}),t=ce({resolver:ke(Ie),defaultValues:{customerName:"",customerEmail:"",customerPhone:"",reservationDate:"",startTime:"",endTime:"",specialRequests:"",acceptsTerms:!1}}),S=oe({mutationFn:async s=>(await Re("POST",`/api/space-reservations/spaces/${i}/reserve`)).json(),onSuccess:s=>{x({title:"Reserva creada exitosamente",description:"Revisa tu email para más detalles sobre el proceso de confirmación."}),A.invalidateQueries({queryKey:[`/api/space-reservations/space/${i}`]}),A.invalidateQueries({queryKey:[`/api/space-reservations/stats/${i}`]}),y(!1),t.reset()},onError:s=>{x({title:"Error al crear la reserva",description:s.message||"Ocurrió un error inesperado",variant:"destructive"})}});if(X)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-green-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando detalles del espacio..."})]})});if(!a)return e.jsx(Q,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-green-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Espacio no encontrado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"El espacio que buscas no existe o no está disponible."}),e.jsx(g,{onClick:()=>R("/reservations"),children:"Volver a espacios"})]})})});const Y=s=>s||"",w=(a.images?a.images.split(",").filter(Boolean):[]).map(Y),j=parseFloat(a.hourlyRate),Z=Pe[a.spaceType]||k,ee=Ee[a.spaceType]||a.spaceType,H=Array.from({length:13},(s,r)=>`${(r+8).toString().padStart(2,"0")}:00`),se=(s,r,h)=>!W.some(n=>n.reservation_date===s&&n.status!=="cancelled"&&(r>=n.start_time&&r<n.end_time||h>n.start_time&&h<=n.end_time||r<=n.start_time&&h>=n.end_time)),ae=s=>{const r=new Date(s.reservationDate),h=Ae(new Date);if(Fe(r,h)){x({title:"Fecha inválida",description:"No puedes reservar en fechas pasadas.",variant:"destructive"});return}const n=$(h,a.advanceBookingDays);if(He(r,n)){x({title:"Fecha muy lejana",description:`Solo puedes reservar con máximo ${a.advanceBookingDays} días de anticipación.`,variant:"destructive"});return}if(!se(s.reservationDate,s.startTime,s.endTime)){x({title:"Horario no disponible",description:"El horario seleccionado ya está reservado.",variant:"destructive"});return}const re=parseInt(s.startTime.split(":")[0]),q=parseInt(s.endTime.split(":")[0])-re;if(q<a.minimumHours){x({title:"Duración insuficiente",description:`La reserva mínima es de ${a.minimumHours} horas.`,variant:"destructive"});return}if(q>a.maximumHours){x({title:"Duración excesiva",description:`La reserva máxima es de ${a.maximumHours} horas.`,variant:"destructive"});return}S.mutate(s)};return e.jsx(Q,{children:e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-green-50 min-h-screen",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs(g,{variant:"ghost",onClick:()=>R("/reservations"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(de,{className:"h-4 w-4"}),"Volver a espacios"]})})}),w.length>0&&e.jsx("section",{className:"bg-white",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"aspect-video relative overflow-hidden",children:[e.jsx("img",{src:w[F],alt:a.name,className:"w-full h-full object-contain bg-gray-100"}),e.jsx("div",{className:"absolute inset-0 bg-black/20"}),w.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"flex gap-2",children:w.map((s,r)=>e.jsx("button",{onClick:()=>G(r),className:`w-3 h-3 rounded-full transition-all ${r===F?"bg-white":"bg-white/50 hover:bg-white/75"}`},r))})}),e.jsx("div",{className:"absolute bottom-8 left-8",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:a.parkName})]})]})})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-2xl mb-2",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs(P,{className:"border",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),ee]}),a.requiresApproval&&e.jsxs(P,{variant:"outline",className:"border-orange-200 text-orange-700",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Requiere Aprobación"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j>0?`$${j.toLocaleString("es-MX")}`:"Gratis"}),j>0&&e.jsx("div",{className:"text-sm text-gray-500",children:"por hora"})]})]})}),e.jsxs(f,{children:[e.jsx("p",{className:"text-gray-700 mb-6",children:a.description}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(J,{className:"h-4 w-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Capacidad"}),e.jsxs("div",{children:[a.capacity," personas"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(xe,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Duración"}),e.jsxs("div",{children:[a.minimumHours,"-",a.maximumHours," horas"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(T,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Anticipación"}),e.jsxs("div",{children:["Hasta ",a.advanceBookingDays," días"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(E,{className:"h-4 w-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Ubicación"}),e.jsx("div",{children:a.parkName})]})]})]})]})]}),a.amenities&&e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-green-600"}),"Amenidades incluidas"]})}),e.jsx(f,{children:e.jsx("p",{className:"text-gray-700",children:a.amenities})})]}),a.rules&&e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-blue-600"}),"Reglas y políticas"]})}),e.jsx(f,{children:e.jsx("p",{className:"text-gray-700",children:a.rules})})]}),u&&e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-yellow-600"}),"Estadísticas del espacio"]})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.totalReservations||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Reservas totales"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.confirmedReservations||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Confirmadas"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:u.pendingReservations||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pendientes"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:u.averageRating||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Calificación"})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{className:"sticky top-4",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-blue-600"}),"Reservar este espacio"]})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:j>0?`$${j.toLocaleString("es-MX")}`:"Gratis"}),j>0&&e.jsx("div",{className:"text-sm text-gray-600",children:"por hora"})]}),e.jsxs(g,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>y(!0),disabled:!a.isActive,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),a.isActive?"Reservar ahora":"No disponible"]}),a.requiresApproval&&e.jsxs("div",{className:"text-xs text-orange-600 bg-orange-50 p-2 rounded",children:[e.jsx(ue,{className:"h-3 w-3 inline mr-1"}),"Esta reserva requiere aprobación administrativa"]})]})})]}),e.jsx(ge,{placementId:3})]})]})}),e.jsx(ve,{open:z,onOpenChange:y,children:e.jsxs(be,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsxs(fe,{children:["Reservar ",a.name]}),e.jsx(ye,{children:"Completa la información para reservar este espacio"})]}),e.jsx(we,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(ae),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:t.control,name:"customerName",render:({field:s})=>e.jsxs(o,{children:[e.jsx(d,{children:"Nombre completo"}),e.jsx(m,{children:e.jsx(C,{placeholder:"Tu nombre completo",...s})}),e.jsx(p,{})]})}),e.jsx(c,{control:t.control,name:"customerEmail",render:({field:s})=>e.jsxs(o,{children:[e.jsx(d,{children:"Email"}),e.jsx(m,{children:e.jsx(C,{type:"email",placeholder:"tu@email.com",...s})}),e.jsx(p,{})]})})]}),e.jsx(c,{control:t.control,name:"customerPhone",render:({field:s})=>e.jsxs(o,{children:[e.jsx(d,{children:"Teléfono"}),e.jsx(m,{children:e.jsx(C,{placeholder:"3312345678",...s})}),e.jsx(p,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{control:t.control,name:"reservationDate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(d,{children:"Fecha de reserva"}),e.jsx(m,{children:e.jsx(C,{type:"date",min:_(new Date,"yyyy-MM-dd"),max:_($(new Date,a.advanceBookingDays),"yyyy-MM-dd"),...s})}),e.jsx(p,{})]})}),e.jsx(c,{control:t.control,name:"startTime",render:({field:s})=>e.jsxs(o,{children:[e.jsx(d,{children:"Hora de inicio"}),e.jsxs(L,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(B,{children:e.jsx(M,{placeholder:"Selecciona hora"})})}),e.jsx(V,{children:H.map(r=>e.jsx(K,{value:r,children:r},r))})]}),e.jsx(p,{})]})}),e.jsx(c,{control:t.control,name:"endTime",render:({field:s})=>e.jsxs(o,{children:[e.jsx(d,{children:"Hora de fin"}),e.jsxs(L,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(B,{children:e.jsx(M,{placeholder:"Selecciona hora"})})}),e.jsx(V,{children:H.slice(1).map(r=>e.jsx(K,{value:r,children:r},r))})]}),e.jsx(p,{})]})})]}),e.jsx(c,{control:t.control,name:"specialRequests",render:({field:s})=>e.jsxs(o,{children:[e.jsx(d,{children:"Solicitudes especiales (opcional)"}),e.jsx(m,{children:e.jsx(Ce,{placeholder:"Describe cualquier solicitud especial para tu evento...",...s})}),e.jsx(p,{})]})}),e.jsx(c,{control:t.control,name:"acceptsTerms",render:({field:s})=>e.jsxs(o,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(m,{children:e.jsx(Se,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(d,{children:"Acepto los términos y condiciones de reserva"}),e.jsx(De,{children:"Al reservar este espacio, acepto cumplir con las reglas establecidas."})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>y(!1),className:"flex-1",children:"Cancelar"}),e.jsx(g,{type:"submit",className:"flex-1 bg-blue-600 hover:bg-blue-700",disabled:S.isPending,children:S.isPending?"Procesando...":"Confirmar reserva"})]})]})})]})})]})})}export{Oe as default};
