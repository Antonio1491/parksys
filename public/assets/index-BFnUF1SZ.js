import{a4 as g,l as ge,az as pe,u as M,aA as W,ar as K,j as e,bh as be,y as R,z as Ne,B as v,bv as ye,I as H,J as $,K as X,N as Y,aI as _,aJ as n,aK as r,aL as t,W as D,aM as c,Y as I,_ as w,$ as E,a0 as o,aN as l,V as p,a1 as ee,M as B,bE as se,a6 as Ce,f as ve,g as Se,h as fe,ad as De,i as Ie,bH as we,bI as Ee,bJ as z,bK as f,bL as ze,bM as b,F as Le,bC as ke,bV as Te,bT as Oe,bW as Ue,bX as Ve,bY as Pe,bZ as qe,b_ as Ae,b$ as Fe,c0 as Ze,ay as j,aB as ae}from"./index-BKCBrrzQ.js";import{H as Me}from"./Helmet-B2HBtdJj.js";const ie=j.object({contractId:j.string().min(1,"Debes seleccionar un contrato"),parkZoneId:j.string().optional(),latitude:j.string().optional(),longitude:j.string().optional(),areaSize:j.string().min(1,"La superficie es obligatoria"),locationDescription:j.string().optional(),polygonCoordinates:j.string().optional()});function He(){const[ne,J]=g.useState(!1),[re,L]=g.useState(!1),[te,G]=g.useState(!1),[ce,k]=g.useState(!1),[i,T]=g.useState(null),[S,oe]=g.useState("");g.useRef(null);const{toast:N}=ge(),O=pe(),{data:Q,isLoading:le}=M({queryKey:["/api/concession-locations"]}),{data:y,isLoading:U}=M({queryKey:["/api/concession-contracts"]}),{data:C,isLoading:V}=M({queryKey:["/api/park-zones"]}),h=W({resolver:ae(ie),defaultValues:{contractId:"",parkZoneId:"",latitude:"",longitude:"",areaSize:"",locationDescription:"",polygonCoordinates:""}}),x=W({resolver:ae(ie),defaultValues:{contractId:"",parkZoneId:"",latitude:"",longitude:"",areaSize:"",locationDescription:"",polygonCoordinates:""}}),P=K({mutationFn:async s=>{const a=await fetch("/api/concession-locations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:JSON.stringify(s)});if(!a.ok){const d=await a.json();throw new Error(d.message||"Error al crear la ubicación")}return await a.json()},onSuccess:()=>{O.invalidateQueries({queryKey:["/api/concession-locations"]}),N({title:"Ubicación creada",description:"La ubicación ha sido creada exitosamente."}),h.reset(),J(!1)},onError:s=>{N({title:"Error",description:s.message,variant:"destructive"})}}),q=K({mutationFn:async s=>{const{id:a,...d}=s,m=await fetch(`/api/concession-locations/${a}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:JSON.stringify(d)});if(!m.ok){const u=await m.json();throw new Error(u.message||"Error al actualizar la ubicación")}return await m.json()},onSuccess:()=>{O.invalidateQueries({queryKey:["/api/concession-locations"]}),N({title:"Ubicación actualizada",description:"La ubicación ha sido actualizada exitosamente."}),x.reset(),L(!1)},onError:s=>{N({title:"Error",description:s.message,variant:"destructive"})}}),A=K({mutationFn:async s=>{const a=await fetch(`/api/concession-locations/${s}`,{method:"DELETE",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""}});if(!a.ok){const d=await a.json();throw new Error(d.message||"Error al eliminar la ubicación")}return await a.json()},onSuccess:()=>{O.invalidateQueries({queryKey:["/api/concession-locations"]}),N({title:"Ubicación eliminada",description:"La ubicación ha sido eliminada exitosamente."}),k(!1)},onError:s=>{N({title:"Error",description:s.message,variant:"destructive"})}}),de=s=>{P.mutate(s)},xe=s=>{i&&q.mutate({...s,id:i.id})},he=s=>{var a,d,m,u;T(s),x.reset({contractId:s.contractId.toString(),parkZoneId:((a=s.parkZoneId)==null?void 0:a.toString())||"",latitude:((d=s.latitude)==null?void 0:d.toString())||"",longitude:((m=s.longitude)==null?void 0:m.toString())||"",areaSize:((u=s.areaSize)==null?void 0:u.toString())||"",locationDescription:s.locationDescription||"",polygonCoordinates:s.polygonCoordinates?JSON.stringify(s.polygonCoordinates):""}),L(!0)},me=s=>{T(s),G(!0)},je=s=>{T(s),k(!0)},ue=()=>{i&&A.mutate(i.id)},F=Q?Q.filter(s=>{var d,m,u;return S===""||((d=s.contractName)==null?void 0:d.toLowerCase().includes(S.toLowerCase()))||((m=s.parkName)==null?void 0:m.toLowerCase().includes(S.toLowerCase()))||((u=s.locationDescription)==null?void 0:u.toLowerCase().includes(S.toLowerCase()))}):[],Z=U||V;return e.jsxs(be,{children:[e.jsxs(Me,{children:[e.jsx("title",{children:"Ubicaciones de Concesiones | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Gestiona la ubicación y georreferenciación de las concesiones en los parques"})]}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Ubicaciones de Concesiones"}),e.jsx("p",{className:"text-muted-foreground",children:"Administra la ubicación y georreferenciación de las concesiones en los parques"})]}),e.jsxs(R,{open:ne,onOpenChange:J,children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(v,{className:"gap-2",children:[e.jsx(ye,{size:16}),"Nueva ubicación"]})}),e.jsxs(H,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(X,{children:"Agregar ubicación para concesión"}),e.jsx(Y,{children:"Introduce la información de ubicación para la concesión"})]}),e.jsx(_,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(de),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:h.control,name:"contractId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Contrato de Concesión"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:Z,children:[e.jsx(c,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona un contrato"})})}),e.jsx(E,{children:U?e.jsx(o,{value:"loading",children:"Cargando contratos..."}):y&&y.length>0?y.map(a=>e.jsxs(o,{value:a.id.toString(),children:[a.parkName," - ",a.concessionaireName]},a.id)):e.jsx(o,{value:"empty",children:"No hay contratos disponibles"})})]}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"parkZoneId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Zona del Parque (Opcional)"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:Z,children:[e.jsx(c,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona una zona"})})}),e.jsx(E,{children:V?e.jsx(o,{value:"loading",children:"Cargando zonas..."}):C&&C.length>0?C.map(a=>e.jsx(o,{value:a.id.toString(),children:a.name},a.id)):e.jsx(o,{value:"empty",children:"No hay zonas disponibles"})})]}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{control:h.control,name:"latitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Latitud (Opcional)"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ej. 19.4326",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"longitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Longitud (Opcional)"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ej. -99.1332",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"areaSize",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Superficie (m²)"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ej. 250",...s,type:"number",min:"0",step:"0.01"})}),e.jsx(l,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsx(n,{control:h.control,name:"locationDescription",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Descripción de la Ubicación"}),e.jsx(c,{children:e.jsx(ee,{placeholder:"Describe la ubicación de la concesión dentro del parque",...s})}),e.jsx(l,{})]})})}),e.jsx("div",{className:"h-80 bg-gray-100 rounded-md p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"mx-auto mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Visualizador de mapa (en desarrollo)"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Pronto podrás seleccionar ubicaciones en el mapa"})]})}),e.jsx(se,{children:e.jsx(v,{type:"submit",disabled:P.isPending,children:P.isPending?"Guardando...":"Guardar ubicación"})})]})})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(Ce,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Buscar ubicaciones...",className:"pl-8",value:S,onChange:s=>oe(s.target.value)})]})}),e.jsxs(ve,{children:[e.jsxs(Se,{className:"pb-3",children:[e.jsx(fe,{children:"Ubicaciones de Concesiones"}),e.jsx(De,{children:"Lista de ubicaciones registradas para las concesiones"})]}),e.jsx(Ie,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(we,{children:[e.jsx(Ee,{children:e.jsxs(z,{children:[e.jsx(f,{children:"Parque"}),e.jsx(f,{children:"Concesionario"}),e.jsx(f,{children:"Ubicación"}),e.jsx(f,{children:"Superficie (m²)"}),e.jsx(f,{children:"Acciones"})]})}),e.jsx(ze,{children:le?e.jsx(z,{children:e.jsx(b,{colSpan:5,className:"text-center py-4",children:"Cargando ubicaciones..."})}):F&&F.length>0?F.map(s=>e.jsxs(z,{children:[e.jsx(b,{children:s.parkName}),e.jsx(b,{children:s.concessionaireName}),e.jsx(b,{children:s.locationDescription||(s.latitude&&s.longitude?`${s.latitude}, ${s.longitude}`:"No especificada")}),e.jsxs(b,{children:[s.areaSize," m²"]}),e.jsx(b,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>me(s),title:"Ver detalles",children:e.jsx(Le,{size:16})}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>he(s),title:"Editar",children:e.jsx(ke,{size:16})}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>je(s),title:"Eliminar",className:"text-destructive",children:e.jsx(Te,{size:16})})]})})]},s.id)):e.jsx(z,{children:e.jsx(b,{colSpan:5,className:"text-center py-4",children:'No hay ubicaciones registradas. Agrega una ubicación usando el botón "Nueva ubicación".'})})})]})})})]})]}),e.jsx(R,{open:te,onOpenChange:G,children:e.jsxs(H,{className:"sm:max-w-[750px]",children:[e.jsx($,{children:e.jsx(X,{children:"Detalles de la Ubicación"})}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Contrato"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.contractName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Parque"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.parkName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Concesionario"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.concessionaireName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Zona del Parque"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.zoneName||"No especificada"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Coordenadas"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.latitude&&i.longitude?`${i.latitude}, ${i.longitude}`:"No especificadas"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Superficie"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.areaSize," m²"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Descripción de la Ubicación"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.locationDescription||"Sin descripción"})]}),e.jsx("div",{className:"h-80 bg-gray-100 rounded-md p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"mx-auto mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Visualizador de mapa (en desarrollo)"})]})})]})]})}),e.jsx(R,{open:re,onOpenChange:L,children:e.jsxs(H,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(X,{children:"Editar Ubicación"}),e.jsx(Y,{children:"Modifica la información de ubicación para esta concesión"})]}),e.jsx(_,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(xe),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:x.control,name:"contractId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Contrato de Concesión"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:!0,children:[e.jsx(c,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona un contrato"})})}),e.jsx(E,{children:U?e.jsx(o,{value:"loading",children:"Cargando contratos..."}):y&&y.length>0?y.map(a=>e.jsxs(o,{value:a.id.toString(),children:[a.parkName," - ",a.concessionaireName]},a.id)):e.jsx(o,{value:"empty",children:"No hay contratos disponibles"})})]}),e.jsx(l,{})]})}),e.jsx(n,{control:x.control,name:"parkZoneId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Zona del Parque (Opcional)"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:Z,children:[e.jsx(c,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona una zona"})})}),e.jsx(E,{children:V?e.jsx(o,{value:"loading",children:"Cargando zonas..."}):C&&C.length>0?C.map(a=>e.jsx(o,{value:a.id.toString(),children:a.name},a.id)):e.jsx(o,{value:"empty",children:"No hay zonas disponibles"})})]}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{control:x.control,name:"latitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Latitud (Opcional)"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ej. 19.4326",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:x.control,name:"longitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Longitud (Opcional)"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ej. -99.1332",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:x.control,name:"areaSize",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Superficie (m²)"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ej. 250",...s,type:"number",min:"0",step:"0.01"})}),e.jsx(l,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsx(n,{control:x.control,name:"locationDescription",render:({field:s})=>e.jsxs(r,{children:[e.jsx(t,{children:"Descripción de la Ubicación"}),e.jsx(c,{children:e.jsx(ee,{placeholder:"Describe la ubicación de la concesión dentro del parque",...s})}),e.jsx(l,{})]})})}),e.jsx("div",{className:"h-80 bg-gray-100 rounded-md p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"mx-auto mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Visualizador de mapa (en desarrollo)"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Pronto podrás seleccionar ubicaciones en el mapa"})]})}),e.jsx(se,{children:e.jsx(v,{type:"submit",disabled:q.isPending,children:q.isPending?"Guardando...":"Guardar cambios"})})]})})]})}),e.jsx(Oe,{open:ce,onOpenChange:k,children:e.jsxs(Ue,{children:[e.jsxs(Ve,{children:[e.jsx(Pe,{children:"¿Estás seguro?"}),e.jsx(qe,{children:"Esta acción eliminará permanentemente la ubicación de la concesión."})]}),e.jsxs(Ae,{children:[e.jsx(Fe,{children:"Cancelar"}),e.jsx(Ze,{onClick:ue,disabled:A.isPending,children:A.isPending?"Eliminando...":"Eliminar"})]})]})})]})}export{He as default};
