import{u as j,j as s,b7 as G,b2 as f,b1 as de,al as xe,eo as he,au as ue,b5 as me,av as ge,bc as q,bd as W,be as H,bf as I,bg as M,bx as V,f as T,g as A,h as D,cr as Q,i as P,bp as be,bq as pe,br as je,bt as fe,M as ye,q as $}from"./index-BKCBrrzQ.js";import{M as y,V as Ne}from"./vertical-bar-chart-BIgnbi8N.js";import{G as X}from"./graphic-card-DqEiXv3p.js";import{B as ve}from"./BarChart-CGQMqZFp.js";const Pe=()=>{var R,K,F;const{data:x,isLoading:Y,refetch:Ce}=j({queryKey:["/api/trees"],retry:1}),{data:h,isLoading:J,refetch:we}=j({queryKey:["/api/trees/maintenances"],retry:1}),{data:u,isLoading:U,refetch:Se}=j({queryKey:["/api/tree-species"],retry:1}),{data:m,isLoading:Z,refetch:qe}=j({queryKey:["/api/parks"],retry:1}),r=Array.isArray(x)?x:(x==null?void 0:x.data)||[],i=Array.isArray(h)?h:(h==null?void 0:h.data)||[],N=Array.isArray(u)?u:(u==null?void 0:u.data)||[],d=Array.isArray(m)?m:(m==null?void 0:m.data)||[];if(Y||J||U||Z)return s.jsx(G,{icon:f,title:"Arbolado",subtitle:"An치lisis y estad칤sticas del arbolado urbano",backgroundColor:"#14b8a6",children:s.jsx("div",{className:"flex h-64 items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-green-500 border-t-transparent"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando datos del arbolado..."})]})})});const c=(r==null?void 0:r.length)||0,v=(N==null?void 0:N.length)||0,L=(i==null?void 0:i.length)||0,_=e=>{if(!e||e.trim()==="")return"Desconocido";switch(e.trim().toLowerCase()){case"excelente":case"excellent":return"Excelente";case"bueno":case"good":case"bien":return"Bueno";case"regular":case"fair":case"medio":return"Regular";case"malo":case"bad":case"poor":return"Malo";case"cr칤tico":case"critical":case"critico":return"Cr칤tico";default:return"Desconocido"}},C=(r==null?void 0:r.reduce((e,a)=>{const t=_((a==null?void 0:a.healthStatus)||"");return e[t]=(e[t]||0)+1,e},{}))||{},k=(i==null?void 0:i.reduce((e,a)=>{const t=(a==null?void 0:a.urgency)||"media";return e[t]=(e[t]||0)+1,e},{}))||{},ee=(i==null?void 0:i.reduce((e,a)=>{const t=(a==null?void 0:a.maintenanceType)||"General";return e[t]=(e[t]||0)+1,e},{}))||{},E=(()=>{const e={};return d==null||d.forEach(a=>{const t=(a==null?void 0:a.name)||`Parque ${a==null?void 0:a.id}`;e[t]=0}),r==null||r.forEach(a=>{const t=(a==null?void 0:a.parkName)||"Sin parque";e.hasOwnProperty(t),e[t]=(e[t]||0)+1}),e})(),se=Object.entries(E).sort(([,e],[,a])=>a-e).slice(0,3),ae=(r==null?void 0:r.reduce((e,a)=>{const t=(a==null?void 0:a.speciesName)||"Especie desconocida";return e[t]=(e[t]||0)+1,e},{}))||{},g=Object.entries(ae).sort(([,e],[,a])=>a-e).slice(0,5),te=(()=>{const e={};d==null||d.forEach(t=>{const n=(t==null?void 0:t.name)||`Parque ${t==null?void 0:t.id}`;e[n]=new Set}),r==null||r.forEach(t=>{const n=(t==null?void 0:t.parkName)||"Sin parque",l=(t==null?void 0:t.speciesName)||"Especie desconocida";e[n]||(e[n]=new Set),e[n].add(l)});const a={};return Object.entries(e).forEach(([t,n])=>{a[t]=n.size}),a})(),w=Object.entries(te).map(([e,a])=>{const t=v>0?v:1,n=a/t*100;return{label:e,value:n,id:e,speciesCount:a,percentage:n.toFixed(1)}}).sort((e,a)=>a.value-e.value),o=Object.entries(E).map(([e,a],t)=>({parkId:t+1,parkName:e,treeCount:a})).sort((e,a)=>a.treeCount-e.treeCount),re=e=>{switch(e){case"Excelente":return"#22c55e";case"Bueno":return"#84cc16";case"Regular":return"#eab308";case"Malo":return"#f97316";case"Cr칤tico":return"#ef4444";case"Desconocido":return"#6b7280";default:return"#9ca3af"}},b=Object.entries(C).map(([e,a])=>({name:e,value:a,percentage:c>0?(a/c*100).toFixed(1):"0.0",color:re(e)})).filter(e=>e.value>0);g.map(([e,a])=>({species:e.length>15?e.substring(0,15)+"...":e,count:a}));const ne=e=>{const a=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#10b981","#f97316","#6366f1","#ec4899","#84cc16"];return a[e%a.length]},p=g.map(([e,a],t)=>({name:e.length>20?e.substring(0,20)+"...":e,value:a,percentage:c>0?(a/c*100).toFixed(1):"0.0",color:ne(t)})).filter(e=>e.value>0),ie=Object.entries(ee).map(([e,a])=>({type:e,count:a,color:e==="Poda"?"#22c55e":e==="Riego"?"#3b82f6":e==="Fertilizaci칩n"?"#f59e0b":e==="Tratamiento fitosanitario"?"#ef4444":e==="Replantaci칩n"?"#8b5cf6":"#6b7280"})),le=(C.Excelente||0)+(C.Bueno||0),z=c>0?Math.round(le/c*100):0,ce=((R=i==null?void 0:i.filter(e=>(e==null?void 0:e.status)==="pending"))==null?void 0:R.length)||0,B=((K=i==null?void 0:i.filter(e=>(e==null?void 0:e.urgency)==="alta"))==null?void 0:K.length)||0,oe=((F=r==null?void 0:r.filter(e=>(e==null?void 0:e.lastMaintenanceDate)&&e.lastMaintenanceDate!==""))==null?void 0:F.length)||0,O=c>0?Math.round(oe/c*100):0;return s.jsx(G,{icon:f,title:"Arbolado",subtitle:"An치lisis y estad칤sticas del arbolado urbano",backgroundColor:"#14b8a6",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[s.jsx(y,{title:"Total Global",value:s.jsx("div",{className:"text-2xl font-bold text-white mb-2",children:c}),subtitle:"Inventario activo",icon:f,iconColor:"#14b8a6",backgroundColor:"#003D49"}),s.jsx(y,{title:"Especies Registradas",value:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-2xl font-bold text-white",children:v}),g.length>0&&s.jsxs("div",{className:"text-xs text-green-300",children:["M치s com칰n: ",g[0][0]," (",g[0][1]," ejemplares)"]})]}),subtitle:"Biodiversidad",icon:de,iconColor:"#14b8a6",backgroundColor:"#003D49"}),s.jsx(y,{title:"Salud General",value:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"text-2xl font-bold text-white",children:[z,"%"]}),s.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:s.jsx("div",{className:"bg-green-400 h-2 rounded-full transition-all duration-300",style:{width:`${z}%`}})})]}),subtitle:"츼rboles en buen estado",icon:xe,iconColor:"#14b8a6",backgroundColor:"#003D49"}),s.jsx(y,{title:"Mantenimientos",value:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-2xl font-bold text-white",children:L}),s.jsxs("div",{className:"text-xs text-green-300",children:[O,"% 치rboles atendidos"]}),s.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:s.jsx("div",{className:"bg-green-400 h-2 rounded-full transition-all duration-300",style:{width:`${O}%`}})})]}),subtitle:"Total global",icon:he,iconColor:"#14b8a6",backgroundColor:"#003D49"})]}),B>0&&s.jsxs(ue,{className:"border-red-200 bg-red-50",children:[s.jsx(me,{className:"h-4 w-4"}),s.jsxs(ge,{className:"text-red-800",children:[s.jsx("strong",{children:"Atenci칩n:"})," Hay ",B," mantenimientos urgentes que requieren atenci칩n inmediata."]})]}),s.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsx("h2",{className:"text-xl font-semibold",children:"Estado de Salud de 츼rboles"})}),s.jsx("div",{className:"h-80",children:!b||b.length===0?s.jsx("div",{className:"text-center py-4 text-gray-500",children:"No hay datos de estado de salud disponibles"}):s.jsx(q,{width:"100%",height:"100%",children:s.jsxs(W,{children:[s.jsx(H,{data:b,cx:"50%",cy:"50%",outerRadius:80,innerRadius:30,paddingAngle:2,dataKey:"value",label:({value:e,percent:a})=>`${e} (${(a*100).toFixed(0)}%)`,labelLine:!1,children:b.map((e,a)=>s.jsx(I,{fill:e.color},`cell-${a}`))}),s.jsx(M,{formatter:e=>[`${e} 치rboles`,"Cantidad"],labelStyle:{color:"#374151",fontWeight:"bold"}}),s.jsx(V,{wrapperStyle:{paddingTop:"20px",fontSize:"12px"},formatter:(e,a)=>{const t=b.find(S=>S.name===e),n=t?t.value:0,l=t?t.percentage:"0";return s.jsxs("span",{style:{color:"#374151",fontSize:"12px",fontWeight:"500"},children:[e," (",n," 치rboles - ",l,"%)"]})}})]})})})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsx("h2",{className:"text-xl font-semibold",children:"Especies M치s Comunes"})}),s.jsx("div",{className:"h-80",children:!p||p.length===0?s.jsx("div",{className:"text-center py-4 text-gray-500",children:"No hay datos de especies disponibles"}):s.jsx(q,{width:"100%",height:"100%",children:s.jsxs(W,{children:[s.jsx(H,{data:p,cx:"50%",cy:"50%",outerRadius:80,innerRadius:30,paddingAngle:2,dataKey:"value",label:({value:e,percent:a})=>`${e} (${(a*100).toFixed(0)}%)`,labelLine:!1,children:p.map((e,a)=>s.jsx(I,{fill:e.color},`cell-${a}`))}),s.jsx(M,{formatter:e=>[`${e} 치rboles`,"Cantidad"],labelStyle:{color:"#374151",fontWeight:"bold"}}),s.jsx(V,{wrapperStyle:{paddingTop:"20px",fontSize:"12px"},formatter:(e,a)=>{const t=p.find(S=>S.name===e),n=t?t.value:0,l=t?t.percentage:"0";return s.jsxs("span",{style:{color:"#374151",fontSize:"12px",fontWeight:"500"},children:[e," (",n," 치rboles - ",l,"%)"]})}})]})})})]})]}),s.jsx("div",{className:"grid gap-6 md:grid-cols-1",children:s.jsxs(T,{children:[s.jsx(A,{children:s.jsxs(D,{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"h-5 w-5"}),"Tipos de Mantenimientos"]})}),s.jsx(P,{children:s.jsx(q,{width:"100%",height:300,children:s.jsxs(ve,{data:ie,children:[s.jsx(be,{strokeDasharray:"3 3"}),s.jsx(pe,{dataKey:"type",angle:-45,textAnchor:"end",height:80,fontSize:12}),s.jsx(je,{}),s.jsx(M,{formatter:e=>[`${e} mantenimientos`,"Cantidad"]}),s.jsx(fe,{dataKey:"count",fill:"#14b8a6"})]})})})]})}),s.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[s.jsx(X,{title:"游 Especies por Parque",description:"Distribuci칩n de diversidad de especies en cada parque y porcentaje del total del sistema",className:"h-full",children:s.jsx(Ne,{data:w,emptyStateTitle:"No hay datos de especies por parque disponibles",emptyStateDescription:"Los datos aparecer치n aqu칤 una vez que se registren especies en los parques",footerText:w.length>0?`Mostrando ${w.length} parques con especies registradas`:void 0,sortDescending:!0,showLabels:!0,formatValue:(e,a)=>a?`${a.speciesCount} (${Math.round(a.percentage)}%)`:`${Math.round(e)}%`})}),s.jsxs(X,{title:"游꺕 츼rboles Registrados por Parque",description:"Cantidad de 치rboles inventariados en cada parque municipal",className:"h-full",children:[s.jsx("div",{className:"w-full",children:(o==null?void 0:o.length)>0?s.jsx("div",{className:"flex justify-center items-end gap-2 min-h-[320px] px-4 overflow-x-auto",children:o.map(e=>{const a=Math.max(...o.map(l=>l.treeCount)),t=a>0?e.treeCount/a*100:5,n=l=>a===0?"#e5e7eb":l>=a*.8?"#22c55e":l>=a*.5?"#10b981":l>=a*.3?"#14b8a6":l>0?"#84cc16":"#e5e7eb";return s.jsxs("div",{className:"flex flex-col items-center relative",children:[s.jsxs("div",{className:"mb-2 text-center",children:[s.jsx("div",{className:"text-sm font-poppins font-thin text-gray-700 flex items-center gap-1",children:e.treeCount}),s.jsx("div",{className:"text-xs font-poppins font-thin text-gray-500",children:"치rboles"})]}),s.jsxs("div",{className:"relative h-64 w-4 flex flex-col justify-end",children:[s.jsx("div",{className:"absolute bottom-0 w-full h-full bg-gray-200 rounded-t-3xl border border-gray-300"}),s.jsx("div",{className:"absolute bottom-0 w-full rounded-t-3xl transition-all duration-700 border border-opacity-20",style:{height:`${Math.max(t,5)}%`,backgroundColor:n(e.treeCount),borderColor:n(e.treeCount)}})]}),s.jsx("div",{className:"absolute bottom-32 -left-28 transform -rotate-90 origin-bottom-right w-32",children:s.jsx("div",{className:"text-xs font-poppins font-thin text-gray-700 whitespace-nowrap",children:e.parkName})})]},e.parkId)})}):s.jsx("div",{className:"text-center py-8 text-gray-500",children:s.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[s.jsx(f,{className:"h-12 w-12 text-gray-300"}),s.jsx("p",{className:"text-lg font-medium",children:"No hay datos de 치rboles por parque disponibles"}),s.jsx("p",{className:"text-sm",children:"Los datos aparecer치n aqu칤 una vez que se registren 치rboles en los parques"})]})})}),(o==null?void 0:o.length)>0&&s.jsx("div",{className:"mt-2 text-center",children:s.jsxs("p",{className:"text-sm text-gray-500 font-poppins font-thin",children:["Mostrando ",o.length," parques municipales"]})})]})]}),s.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[s.jsxs(T,{children:[s.jsx(A,{children:s.jsxs(D,{className:"flex items-center gap-2",children:[s.jsx(ye,{className:"h-5 w-5"}),"Parques con M치s 츼rboles"]})}),s.jsx(P,{className:"space-y-4",children:se.map(([e,a],t)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($,{variant:"secondary",children:t+1}),s.jsx("span",{className:"font-medium",children:e})]}),s.jsxs($,{variant:"outline",children:[a," 치rboles"]})]},e))})]}),s.jsxs(T,{children:[s.jsx(A,{children:s.jsxs(D,{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"h-5 w-5"}),"Resumen de Mantenimientos"]})}),s.jsxs(P,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:L}),s.jsx("div",{className:"text-sm text-gray-600",children:"Total registrados"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:ce}),s.jsx("div",{className:"text-sm text-gray-600",children:"Pendientes"})]})]}),s.jsx("div",{className:"space-y-2",children:Object.entries(k).map(([e,a])=>s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"capitalize",children:e}),s.jsx($,{variant:e==="alta"?"destructive":e==="media"?"default":"secondary",children:a})]},e))})]})]})]})]})})};export{Pe as default};
