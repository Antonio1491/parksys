import{aG as Y,aH as Z,l as ee,az as se,u as $,j as e,bh as q,au as L,b5 as k,er as A,av as H,B as n,A as z,bC as ae,bV as re,M,q as t,bk as ne,bl as ie,bm as u,bn as p,f as o,g as m,h as x,ad as N,i as h,m as T,cW as B,n as le,bH as te,bI as ce,bJ as O,bK as v,bL as de,bM as y,aC as oe,v as me,a3 as xe,cr as he,b1 as je,eo as ge,O as ue,aw as pe,a4 as S,ep as Ne}from"./index-BKCBrrzQ.js";import{H as ve}from"./Helmet-B2HBtdJj.js";import{S as i}from"./skeleton-DXHnzw_f.js";import{S as f,a as U}from"./sprout-MYC5xYd7.js";import{R as ye}from"./ruler-Br_jp5cV.js";import{C as I}from"./circle-check-4bNI6GJ1.js";function Se(){var F,R;const[fe,b]=Y("/admin/trees/inventory/:id"),[,g]=Z(),{toast:P}=ee(),V=se(),l=b==null?void 0:b.id;console.log("ID del árbol:",l);const{data:w,isLoading:D,error:G}=$({queryKey:[`/api/trees/${l}`],queryFn:async()=>{const a=await fetch(`/api/trees/${l}`);if(!a.ok)throw new Error("Error al cargar la información del árbol");const r=await a.json();return console.log("Datos del árbol:",r),r},enabled:!!l}),s=w==null?void 0:w.data,{data:d,isLoading:K,refetch:be}=$({queryKey:[`/api/trees/${l}/maintenances`],queryFn:async()=>{const a=await fetch(`/api/trees/${l}/maintenances`);if(!a.ok)throw new Error("Error al cargar los mantenimientos del árbol");return a.json()},enabled:!!l}),Q=async a=>{try{await oe(`/api/trees/${l}`,{method:"DELETE",data:{removalReason:a}}),P({title:"Árbol eliminado",description:"El árbol ha sido marcado como removido correctamente."}),V.invalidateQueries({queryKey:["/api/trees"]}),g("/admin/trees/inventory")}catch(r){console.error("Error al eliminar el árbol:",r),P({title:"Error",description:"No se pudo eliminar el árbol. Por favor, intenta nuevamente.",variant:"destructive"})}},c=a=>{if(!a)return"No disponible";try{return me(new Date(a),"dd/MM/yyyy",{locale:xe})}catch{return"Fecha inválida"}},W=a=>{switch(a.toLowerCase()){case"poda":return e.jsx(ge,{className:"h-4 w-4"});case"plantación":return e.jsx(U,{className:"h-4 w-4"});case"riego":return e.jsx(f,{className:"h-4 w-4"});case"tratamiento fitosanitario":return e.jsx(je,{className:"h-4 w-4"});case"reparación":return e.jsx(he,{className:"h-4 w-4"});default:return e.jsx(I,{className:"h-4 w-4"})}},C=a=>{if(!a)return e.jsx(t,{variant:"outline",children:"No evaluado"});switch(a.toLowerCase()){case"bueno":return e.jsxs(t,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:[e.jsx(I,{className:"h-3 w-3 mr-1"})," Bueno"]});case"regular":return e.jsxs(t,{variant:"outline",className:"bg-yellow-50 text-yellow-700 hover:bg-yellow-100",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"})," Regular"]});case"malo":return e.jsxs(t,{variant:"outline",className:"bg-orange-50 text-orange-700 hover:bg-orange-100",children:[e.jsx(k,{className:"h-3 w-3 mr-1"})," Malo"]});case"crítico":return e.jsxs(t,{variant:"destructive",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"})," Crítico"]});default:return e.jsx(t,{variant:"outline",children:a})}},_=({tree:a})=>{const[r,J]=S.useState(null),[X,E]=S.useState(!1);return S.useEffect(()=>{a.speciesId&&(E(!0),fetch(`/api/tree-species/${a.speciesId}`).then(j=>j.json()).then(j=>{J(j),E(!1)}).catch(j=>{console.error("Error cargando especie:",j),E(!1)}))},[a.speciesId]),X?e.jsx("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center mb-4",children:e.jsx(f,{className:"h-16 w-16 text-gray-300 animate-pulse"})}):r&&r.photoUrl?e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"aspect-square overflow-hidden rounded-md",children:e.jsx("img",{src:r.photoUrl,alt:`${r.commonName} (${r.scientificName})`,className:"object-cover w-full h-full"})}),e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:["Foto de la especie: ",r.commonName]})]}):e.jsxs("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center mb-4",children:[e.jsx(Ne,{className:"h-16 w-16 text-gray-400"}),e.jsx("div",{className:"absolute bottom-2 bg-white/90 px-2 py-1 rounded text-xs text-gray-600",children:"Sin foto disponible"})]})};return G?e.jsx(q,{children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs(L,{variant:"destructive",className:"mb-4",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(A,{children:"Error"}),e.jsx(H,{children:"No se pudo cargar la información del árbol. Verifica que el ID sea correcto."})]}),e.jsxs(n,{onClick:()=>g("/admin/trees/inventory"),variant:"outline",className:"mt-4",children:[e.jsx(z,{className:"mr-2 h-4 w-4"})," Volver al Inventario"]})]})}):e.jsxs(q,{children:[e.jsxs(ve,{children:[e.jsx("title",{children:D?"Cargando detalles...":`Árbol ${s.code} | Inventario Arbóreo | ParquesMX`}),e.jsx("meta",{name:"description",content:"Detalles del árbol en el inventario de parques municipales"})]}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>g("/admin/trees/inventory"),className:"mr-4 mt-1",children:e.jsx(z,{className:"h-5 w-5"})}),D?e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(i,{className:"h-8 w-64"}),e.jsx(i,{className:"h-4 w-48"})]}):e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-3xl font-bold text-green-800 flex items-center",children:[e.jsx(f,{className:"mr-2 h-8 w-8"}),`${s.code} - ${s.speciesName}`]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",className:"flex items-center",onClick:()=>g(`/admin/trees/inventory/${l}/edit`),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(Dialog,{children:[e.jsx(DialogTrigger,{asChild:!0,children:e.jsxs(n,{variant:"destructive",className:"flex items-center",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Eliminar"]})}),e.jsxs(DialogContent,{children:[e.jsxs(DialogHeader,{children:[e.jsx(DialogTitle,{children:"Confirmar eliminación"}),e.jsx(DialogDescription,{children:"¿Estás seguro de que deseas marcar este árbol como removido? Esta acción no eliminará el registro, pero lo marcará como removido del inventario."})]}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Motivo de la remoción:"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",id:"removalReason",defaultValue:"Tala programada",children:[e.jsx("option",{value:"Tala programada",children:"Tala programada"}),e.jsx("option",{value:"Árbol enfermo",children:"Árbol enfermo"}),e.jsx("option",{value:"Árbol caído",children:"Árbol caído"}),e.jsx("option",{value:"Riesgo de caída",children:"Riesgo de caída"}),e.jsx("option",{value:"Reubicación",children:"Reubicación"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(n,{variant:"outline",children:"Cancelar"})}),e.jsx(n,{variant:"destructive",onClick:()=>{const a=document.getElementById("removalReason").value;Q(a)},children:"Confirmar eliminación"})]})]})]})]})]}),e.jsxs("p",{className:"text-gray-600 mt-1 flex items-center",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),s.parkName," • ",s.scientificName,e.jsx("span",{className:"mx-2",children:"•"}),C(s.healthStatus),s.isProtected&&e.jsx(t,{variant:"secondary",className:"ml-2",children:"Protección Especial"})]})]})]}),D?e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:"h-[300px] w-full rounded-lg"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(i,{className:"h-12 w-full rounded-md"}),e.jsx(i,{className:"h-12 w-full rounded-md"}),e.jsx(i,{className:"h-12 w-full rounded-md"})]}),e.jsx(i,{className:"h-[400px] w-full rounded-lg"})]}):e.jsxs(ne,{defaultValue:"general",className:"space-y-6",children:[e.jsxs(ie,{className:"grid grid-cols-4",children:[e.jsx(u,{value:"general",children:"Información General"}),e.jsx(u,{value:"physical",children:"Estado Físico"}),e.jsx(u,{value:"location",children:"Ubicación"}),e.jsx(u,{value:"maintenance",children:"Mantenimiento"})]}),e.jsx(p,{value:"general",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(o,{className:"md:col-span-2",children:[e.jsxs(m,{children:[e.jsx(x,{children:"Datos Generales"}),e.jsx(N,{children:"Información general del árbol en el inventario"})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Código Identificador"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.code})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Especie"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.speciesName}),e.jsx("p",{className:"text-sm italic text-gray-500",children:s.scientificName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Parque"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.parkName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Estado de Salud"}),e.jsx("p",{className:"mt-1",children:C(s.healthStatus)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Etapa de Desarrollo"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.developmentStage||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Edad Estimada"}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.ageEstimate?`${s.ageEstimate} años`:"No especificado"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Fecha de Plantación"}),e.jsx("p",{className:"mt-1 text-gray-700",children:c(s.plantingDate)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Última Inspección"}),e.jsx("p",{className:"mt-1 text-gray-700",children:c(s.lastInspectionDate)})]})]}),e.jsx(T,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Dimensiones"}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center",children:[e.jsx(ye,{className:"h-5 w-5 text-green-600 mb-1"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Altura"}),e.jsx("span",{className:"font-medium text-lg text-gray-800",children:s.height?`${s.height} m`:"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"font-medium text-2xl text-green-600 mb-1",children:"Ø"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Diámetro (DAP)"}),e.jsx("span",{className:"font-medium text-lg text-gray-800",children:s.diameter?`${s.diameter} cm`:"-"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center",children:[e.jsx(f,{className:"h-5 w-5 text-green-600 mb-1"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Cobertura Copa"}),e.jsx("span",{className:"font-medium text-lg text-gray-800",children:s.canopyCoverage?`${s.canopyCoverage} m²`:"-"})]})]})]}),s.observations&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Observaciones"}),e.jsx("p",{className:"mt-2 text-gray-700 whitespace-pre-wrap",children:s.observations})]})]})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(x,{children:"Información Adicional"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsx(_,{tree:s}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Creado"}),e.jsx("p",{className:"text-sm text-gray-500",children:c(s.createdAt)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Última Actualización"}),e.jsx("p",{className:"text-sm text-gray-500",children:c(s.updatedAt)})]}),s.isProtected&&e.jsxs(L,{className:"bg-green-50 border-green-200",children:[e.jsx(I,{className:"h-4 w-4 text-green-600"}),e.jsx(A,{children:"Árbol Protegido"}),e.jsx(H,{children:"Este ejemplar cuenta con protección especial."})]})]}),e.jsx(B,{className:"flex justify-center",children:e.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${s.latitude},${s.longitude}`,"_blank"),children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Ver en Google Maps"]})})]})]})}),e.jsx(p,{value:"physical",children:e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Estado Físico y Condiciones"}),e.jsx(N,{children:"Información sobre el estado y condiciones del árbol"})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estado General"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Estado de Salud"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Evaluación general del árbol"})]}),e.jsx("div",{children:C(s.healthStatus)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Etapa de Desarrollo"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Fase actual del ciclo de vida"})]}),e.jsx("div",{children:e.jsx(t,{variant:"outline",children:s.developmentStage||"No especificado"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Última Inspección"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Fecha de la evaluación más reciente"})]}),e.jsx("div",{children:e.jsxs(t,{variant:"secondary",children:[e.jsx(le,{className:"mr-1 h-3 w-3"}),c(s.lastInspectionDate)]})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Condiciones Específicas"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`h-4 w-4 rounded-full mr-3 ${s.hasHollows?"bg-orange-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Presencia de Huecos"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.hasHollows?"El árbol presenta huecos o cavidades":"No se han detectado huecos o cavidades"})]})]}),e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`h-4 w-4 rounded-full mr-3 ${s.hasExposedRoots?"bg-orange-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Raíces Expuestas"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.hasExposedRoots?"El árbol tiene raíces expuestas en la superficie":"No se observan raíces expuestas"})]})]}),e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`h-4 w-4 rounded-full mr-3 ${s.hasPests?"bg-red-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Presencia de Plagas"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.hasPests?"Se han detectado plagas o enfermedades":"No se han detectado plagas o enfermedades"})]})]})]})]})]}),s.physicalCondition&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Descripción de Condición Física"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.physicalCondition})})]})]})]})]})}),e.jsx(p,{value:"maintenance",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Historial de Mantenimiento"})}),e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Historial de Mantenimientos"}),e.jsx(N,{children:"Registro de todas las actividades de mantenimiento realizadas en este árbol"})]}),e.jsx(h,{children:K?e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{className:"h-12 w-full"}),e.jsx(i,{className:"h-12 w-full"}),e.jsx(i,{className:"h-12 w-full"})]}):((F=d==null?void 0:d.data)==null?void 0:F.length)>0?e.jsxs(te,{children:[e.jsx(ce,{children:e.jsxs(O,{children:[e.jsx(v,{children:"Tipo"}),e.jsx(v,{children:"Fecha"}),e.jsx(v,{children:"Realizado por"}),e.jsx(v,{children:"Notas"})]})}),e.jsx(de,{children:d.data.map(a=>e.jsxs(O,{children:[e.jsxs(y,{className:"font-medium flex items-center",children:[e.jsx("div",{className:"mr-2 text-green-600",children:W(a.maintenanceType)}),a.maintenanceType]}),e.jsx(y,{children:c(a.maintenanceDate)}),e.jsx(y,{children:a.performedByName||a.performedBy||"-"}),e.jsx(y,{className:"max-w-xs truncate",children:a.notes||"Sin observaciones"})]},a.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",children:e.jsx(U,{className:"h-12 w-12"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No hay mantenimientos registrados"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No se han registrado actividades de mantenimiento para este árbol todavía."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Para registrar mantenimientos, utiliza la sección de",e.jsx("a",{href:"/admin/trees/maintenance",className:"text-green-600 hover:text-green-700 font-medium ml-1",children:"Mantenimiento de Árboles"})]})]})})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(x,{children:"Información de Mantenimiento"})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:"Último mantenimiento"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.lastMaintenanceDate?c(s.lastMaintenanceDate):"No registrado"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:"Mantenimientos registrados"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[((R=d==null?void 0:d.data)==null?void 0:R.length)||0," en total"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:"Próximo mantenimiento sugerido"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.lastMaintenanceDate?c(new Date(new Date(s.lastMaintenanceDate).setMonth(new Date(s.lastMaintenanceDate).getMonth()+3))):"No aplica"})]})]})})]})]})}),e.jsx(p,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(o,{className:"md:col-span-1",children:[e.jsxs(m,{children:[e.jsx(x,{children:"Datos de Ubicación"}),e.jsx(N,{children:"Coordenadas y detalles de ubicación"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Parque"}),e.jsx("p",{className:"text-gray-700 font-medium mt-1",children:s.parkName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Coordenadas"}),e.jsxs("p",{className:"text-gray-700 mt-1",children:["Latitud: ",e.jsx("span",{className:"font-mono",children:s.latitude})]}),e.jsxs("p",{className:"text-gray-700",children:["Longitud: ",e.jsx("span",{className:"font-mono",children:s.longitude})]})]}),s.locationDescription&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Descripción de la Ubicación"}),e.jsx("p",{className:"text-gray-700 mt-1",children:s.locationDescription})]})]}),e.jsx(B,{className:"flex flex-col gap-2",children:e.jsxs(n,{className:"w-full",onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${s.latitude},${s.longitude}`,"_blank"),children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Ver en Google Maps"]})})]}),e.jsxs(o,{className:"md:col-span-2",children:[e.jsx(m,{children:e.jsx(x,{children:"Mapa"})}),e.jsx(h,{className:"min-h-[400px]",children:e.jsx("div",{className:"h-[400px] bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("iframe",{src:`https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dOVTAuHiigloWU&center=${s.latitude},${s.longitude}&zoom=18&maptype=satellite`,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Ubicación del árbol",onError:()=>{console.log("Error cargando mapa, mostrando alternativa")}})})})]})]})})]}),e.jsx(Dialog,{open:isMaintenanceModalOpen,onOpenChange:setIsMaintenanceModalOpen,children:e.jsxs(DialogContent,{className:"sm:max-w-[500px]",children:[e.jsxs(DialogHeader,{children:[e.jsx(DialogTitle,{children:"Registrar Nuevo Mantenimiento"}),e.jsx(DialogDescription,{children:"Ingresa los detalles del mantenimiento realizado al árbol."})]}),e.jsxs("form",{onSubmit:handleSubmitMaintenance,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"maintenanceType",className:"text-sm font-medium",children:"Tipo de Mantenimiento *"}),e.jsxs("select",{id:"maintenanceType",className:"w-full p-2 border rounded-md",value:newMaintenance.maintenanceType,onChange:a=>setNewMaintenance({...newMaintenance,maintenanceType:a.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar tipo"}),e.jsx("option",{value:"Poda",children:"Poda"}),e.jsx("option",{value:"Plantación",children:"Plantación"}),e.jsx("option",{value:"Riego",children:"Riego"}),e.jsx("option",{value:"Tratamiento Fitosanitario",children:"Tratamiento Fitosanitario"}),e.jsx("option",{value:"Reparación",children:"Reparación"}),e.jsx("option",{value:"Inspección",children:"Inspección"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"maintenanceDate",className:"text-sm font-medium",children:"Fecha de Mantenimiento *"}),e.jsx("input",{type:"date",id:"maintenanceDate",className:"w-full p-2 border rounded-md",value:newMaintenance.maintenanceDate,onChange:a=>setNewMaintenance({...newMaintenance,maintenanceDate:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"performedBy",className:"text-sm font-medium",children:"Realizado por"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"employeeSearch",className:"w-full p-2 border rounded-md",value:employeeSearch,onChange:a=>{setEmployeeSearch(a.target.value),setShowEmployeeList(a.target.value.length>0)},onFocus:()=>setShowEmployeeList(employeeSearch.length>0),placeholder:"Buscar empleado por nombre, email o puesto..."}),showEmployeeList&&filteredEmployees.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:filteredEmployees.map(a=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100",onClick:()=>{setSelectedEmployee(a),setEmployeeSearch(`${a.firstName} ${a.lastName}`),setNewMaintenance({...newMaintenance,performedBy:a.id.toString()}),setShowEmployeeList(!1)},children:[e.jsxs("div",{className:"font-medium",children:[a.firstName," ",a.lastName]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.position," • ",a.email]})]},a.id))}),selectedEmployee&&e.jsx("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"Empleado seleccionado:"}),e.jsx("br",{}),selectedEmployee.firstName," ",selectedEmployee.lastName," (ID: ",selectedEmployee.id,")"]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"notes",className:"text-sm font-medium",children:"Notas"}),e.jsx("textarea",{id:"notes",className:"w-full p-2 border rounded-md",value:newMaintenance.notes,onChange:a=>setNewMaintenance({...newMaintenance,notes:a.target.value}),placeholder:"Detalles adicionales del mantenimiento...",rows:3})]}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(n,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(n,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:createMaintenanceMutation.isPending,children:createMaintenanceMutation.isPending?"Registrando...":"Registrar Mantenimiento"})]})]})]})})]})]})}export{Se as default};
