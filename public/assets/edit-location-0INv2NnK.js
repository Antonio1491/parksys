import{d9 as F,da as c,k as E,aH as M,l as w,az as A,u as P,aA as S,a4 as k,ar as q,j as a,bh as v,B as o,A as N,f as z,g as D,h as Q,ad as T,i as U,aI as I,au as K,M as V,av as B,aJ as d,aK as u,aL as m,aM as x,V as j,aQ as h,aN as p,d as H,aB as $,aC as G}from"./index-BKCBrrzQ.js";import{S as y}from"./skeleton-DXHnzw_f.js";const R=F({latitude:c().refine(n=>{const s=parseFloat(n);return!isNaN(s)&&s>=-90&&s<=90},{message:"La latitud debe ser un número entre -90 y 90"}),longitude:c().refine(n=>{const s=parseFloat(n);return!isNaN(s)&&s>=-180&&s<=180},{message:"La longitud debe ser un número entre -180 y 180"}),location:c().optional()}),W=()=>{const s=E().id,[J,i]=M(),{toast:g}=w(),b=A(),{data:t,isLoading:C}=P({queryKey:[`/api/assets/${s}`],enabled:!!s}),r=S({resolver:$(R),defaultValues:{latitude:"",longitude:"",location:""}});k.useEffect(()=>{t&&r.reset({latitude:t.latitude||"",longitude:t.longitude||"",location:t.location||""})},[t,r]);const l=q({mutationFn:e=>{const L=t||{};return G(`/api/assets/${s}`,"PUT",{...L,latitude:e.latitude,longitude:e.longitude,location:e.location})},onSuccess:()=>{b.invalidateQueries({queryKey:[`/api/assets/${s}`]}),b.invalidateQueries({queryKey:["/api/assets"]}),g({title:"Ubicación actualizada",description:"Las coordenadas del activo se han actualizado correctamente."}),i("/admin/assets/map")},onError:e=>{g({title:"Error",description:"Ha ocurrido un error al actualizar las coordenadas.",variant:"destructive"}),console.error("Error al actualizar coordenadas:",e)}}),f=e=>{l.mutate(e)};return C?a.jsx(v,{children:a.jsxs("div",{className:"container py-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),children:[a.jsx(N,{className:"mr-2 h-4 w-4"}),"Volver al Mapa"]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(y,{className:"h-8 w-96"}),a.jsx(y,{className:"h-64 w-full"})]})]})}):a.jsx(v,{children:a.jsxs("div",{className:"container py-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),children:[a.jsx(N,{className:"mr-2 h-4 w-4"}),"Volver al Mapa"]})}),a.jsxs(z,{className:"max-w-lg mx-auto",children:[a.jsxs(D,{children:[a.jsx(Q,{className:"text-xl",children:"Editar Ubicación"}),a.jsxs(T,{children:["Activo: ",t==null?void 0:t.name]})]}),a.jsx(U,{children:a.jsx(I,{...r,children:a.jsxs("form",{onSubmit:r.handleSubmit(f),className:"space-y-6",children:[a.jsxs(K,{className:"bg-blue-50 border-blue-200",children:[a.jsx(V,{className:"h-4 w-4 text-blue-600"}),a.jsx(B,{className:"text-blue-700",children:"Ingresa las coordenadas de ubicación para este activo. Para México, la latitud suele ser positiva (norte) y la longitud negativa (oeste)."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(d,{control:r.control,name:"latitude",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Latitud"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: 19.432608",...e})}),a.jsx(h,{children:"Coordenada norte (+) / sur (-)"}),a.jsx(p,{})]})}),a.jsx(d,{control:r.control,name:"longitude",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Longitud"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: -99.133209",...e})}),a.jsx(h,{children:"Coordenada este (+) / oeste (-)"}),a.jsx(p,{})]})})]}),a.jsx(d,{control:r.control,name:"location",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Descripción de Ubicación"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: Cerca de la entrada principal",...e})}),a.jsx(h,{children:"Describe dónde se encuentra este activo dentro del parque"}),a.jsx(p,{})]})}),a.jsxs("div",{className:"flex items-center justify-end gap-4",children:[a.jsx(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),type:"button",children:"Cancelar"}),a.jsxs(o,{type:"submit",disabled:l.isPending,children:[l.isPending?"Guardando...":"Guardar Ubicación",a.jsx(H,{className:"ml-2 h-4 w-4"})]})]})]})})})]})]})})};export{W as default};
