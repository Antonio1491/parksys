import{ay as i,aH as ae,l as se,az as re,a4 as b,u as M,aA as ne,ar as ie,j as e,bh as ce,B as N,aI as le,aJ as c,aK as l,aL as o,aM as t,V as f,aN as d,a1 as G,W as q,Y as F,_ as A,$ as D,a0 as S,aQ as I,cB as B,cC as $,c4 as K,v as U,n as H,cD as O,cE as Q,a3 as R,aP as oe,b0 as te,b as J,bV as de,aB as me,aC as he}from"./index-BKCBrrzQ.js";import{S as W}from"./switch-B8yCKxVc.js";import{L as xe}from"./LocationSelector-D3bz-C3-.js";const ue=[{id:"activa",label:"ðŸŸ¢ Activa"},{id:"programada",label:"ðŸŸ¡ Programada"},{id:"cancelada",label:"ðŸ”´ Cancelada"},{id:"finalizada",label:"âš« Finalizada"},{id:"en_pausa",label:"ðŸŸ  En Pausa"}],je=i.object({nombre:i.string().min(3,"El nombre debe tener al menos 3 caracteres"),descripcion:i.string().min(10,"La descripciÃ³n debe tener al menos 10 caracteres"),categoria:i.string({required_error:"Selecciona una categorÃ­a"}),parqueId:i.number({required_error:"Selecciona un parque"}),fechaInicio:i.date({required_error:"Selecciona una fecha de inicio"}),fechaFin:i.date().optional(),horaInicio:i.string().min(1,"Selecciona una hora de inicio"),duracion:i.number().min(1,"La duraciÃ³n debe ser al menos 1 minuto"),capacidad:i.number().optional(),materiales:i.string().optional(),personalRequerido:i.number().optional(),esRecurrente:i.boolean().default(!1),esGratuita:i.boolean().default(!0),precio:i.number().optional(),ubicacion:i.string().optional(),ubicaciones:i.array(i.string()).optional(),diasRecurrentes:i.array(i.string()).optional(),requisitos:i.string().optional(),instructorId:i.number().optional(),status:i.string().default("programada")}),pe=({onImagesChange:V,selectedImages:h})=>{const[u,w]=b.useState([]),[p,E]=b.useState(0),j=x=>{const g=Array.from(x.target.files||[]).filter(v=>v.type.startsWith("image/"));if(g.length>0){const v=[...h,...g];V(v),g.forEach(r=>{const P=new FileReader;P.onload=L=>{w(T=>{var y;return[...T,(y=L.target)==null?void 0:y.result]})},P.readAsDataURL(r)})}},k=x=>{const m=h.filter((v,r)=>r!==x),g=u.filter((v,r)=>r!==x);V(m),w(g),p>=m.length&&E(Math.max(0,m.length-1))},z=x=>{E(x)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:j,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(te,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Haz clic para subir imÃ¡genes o arrastra archivos aquÃ­"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, GIF hasta 10MB cada una"})]})]}),u.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map((x,m)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:x,alt:`Preview ${m+1}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center space-x-2",children:[e.jsxs(N,{type:"button",size:"sm",variant:p===m?"default":"secondary",onClick:()=>z(m),className:"text-xs",children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),p===m?"Principal":"Hacer principal"]}),e.jsx(N,{type:"button",size:"sm",variant:"destructive",onClick:()=>k(m),children:e.jsx(de,{className:"w-3 h-3"})})]}),p===m&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white px-2 py-1 rounded text-xs font-semibold",children:[e.jsx(J,{className:"w-3 h-3 inline mr-1"}),"Principal"]})]},m))}),h.length>0&&e.jsxs("p",{className:"text-sm text-gray-600",children:[h.length," imagen",h.length!==1?"es":""," seleccionada",h.length!==1?"s":"",h.length>0&&` â€¢ Imagen principal: ${p+1}`]})]})},Ne=()=>{const[V,h]=ae(),{toast:u}=se(),w=re();b.useState("");const[p,E]=b.useState([]),[j,k]=b.useState([]);b.useState([]);const[z,x]=b.useState(0),{data:m=[]}=M({queryKey:["/api/parks"]}),{data:g=[]}=M({queryKey:["/api/activity-categories"]}),{data:v=[]}=M({queryKey:["/api/instructors"]}),r=ne({resolver:me(je),defaultValues:{nombre:"",descripcion:"",categoria:"",fechaInicio:void 0,horaInicio:"",duracion:60,capacidad:void 0,esRecurrente:!1,esGratuita:!0,precio:void 0,ubicacion:"",ubicaciones:[],diasRecurrentes:[],status:"programada"}}),P=r.watch("esRecurrente"),L=r.watch("esGratuita"),T=r.watch("parqueId"),y=ie({mutationFn:async a=>await he("/api/activities",{method:"POST",data:a}),onSuccess:async a=>{console.log("ðŸŽ¯ Actividad creada exitosamente:",a),console.log("ðŸŽ¯ ImÃ¡genes seleccionadas:",j.length),console.log("ðŸŽ¯ ID de actividad recibido:",a.id),u({title:"Actividad creada",description:"La actividad ha sido creada exitosamente."}),w.invalidateQueries({queryKey:["/api/activities"]}),j.length>0&&a.id?(console.log("ðŸŽ¯ Iniciando subida de imÃ¡genes..."),await X(a.id)):(console.log("ðŸŽ¯ No hay imÃ¡genes para subir, redirigiendo..."),h("/admin/organizador"))},onError:a=>{u({title:"Error",description:a.message||"No se pudo crear la actividad",variant:"destructive"})}}),X=async a=>{try{for(let s=0;s<j.length;s++){const n=j[s],C=new FormData;C.append("image",n),C.append("isPrimary",(s===z).toString()),await fetch(`/api/activities/${a}/images`,{method:"POST",body:C})}u({title:"ImÃ¡genes subidas",description:`Se subieron ${j.length} imÃ¡genes exitosamente.`}),h("/admin/organizador")}catch(s){console.error("Error subiendo imÃ¡genes:",s),u({title:"Error al subir imÃ¡genes",description:"La actividad se creÃ³, pero hubo un problema al subir las imÃ¡genes.",variant:"destructive"}),h("/admin/organizador")}},Y=a=>{const s={...a,ubicaciones:p};y.mutate(s)},Z=[{id:"lunes",label:"Lunes"},{id:"martes",label:"Martes"},{id:"miercoles",label:"MiÃ©rcoles"},{id:"jueves",label:"Jueves"},{id:"viernes",label:"Viernes"},{id:"sabado",label:"SÃ¡bado"},{id:"domingo",label:"Domingo"}];return e.jsxs(ce,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(N,{variant:"outline",className:"mb-4",onClick:()=>h("/admin/organizador"),children:"â† Volver a Organizador"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Crear Nueva Actividad"}),e.jsx("p",{className:"text-gray-500",children:"Completa el formulario para crear una nueva actividad o evento"})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:e.jsx(le,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Y),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold border-b pb-2",children:"InformaciÃ³n BÃ¡sica"}),e.jsx(c,{control:r.control,name:"nombre",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Nombre de la actividad"}),e.jsx(t,{children:e.jsx(f,{placeholder:"Ej: Taller de pintura",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"descripcion",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"DescripciÃ³n"}),e.jsx(t,{children:e.jsx(G,{placeholder:"Describe brevemente la actividad...",className:"min-h-[120px]",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"categoria",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"CategorÃ­a"}),e.jsxs(q,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(t,{children:e.jsx(F,{children:e.jsx(A,{placeholder:"Selecciona una categorÃ­a"})})}),e.jsx(D,{children:g.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"parqueId",render:({field:a})=>{var s;return e.jsxs(l,{children:[e.jsx(o,{children:"Parque"}),e.jsxs(q,{onValueChange:n=>a.onChange(Number(n)),defaultValue:(s=a.value)==null?void 0:s.toString(),children:[e.jsx(t,{children:e.jsx(F,{children:e.jsx(A,{placeholder:"Selecciona un parque"})})}),e.jsx(D,{children:m.map(n=>e.jsx(S,{value:n.id.toString(),children:n.name},n.id))})]}),e.jsx(d,{})]})}}),e.jsx(c,{control:r.control,name:"status",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Estado de la Actividad"}),e.jsxs(q,{onValueChange:a.onChange,value:a.value||void 0,children:[e.jsx(t,{children:e.jsx(F,{children:e.jsx(A,{placeholder:"Selecciona el estado"})})}),e.jsx(D,{children:ue.map(s=>e.jsx(S,{value:s.id,children:s.label},s.id))})]}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"instructorId",render:({field:a})=>{var s;return e.jsxs(l,{children:[e.jsx(o,{children:"Instructor Asignado"}),e.jsxs(q,{onValueChange:n=>a.onChange(n==="0"?void 0:Number(n)),defaultValue:((s=a.value)==null?void 0:s.toString())||"0",children:[e.jsx(t,{children:e.jsx(F,{children:e.jsx(A,{placeholder:"Selecciona un instructor (opcional)"})})}),e.jsxs(D,{children:[e.jsx(S,{value:"0",children:"Sin instructor asignado"}),v.map(n=>e.jsxs(S,{value:n.id.toString(),children:[n.firstName," ",n.lastName,n.specialties&&n.specialties.length>0&&e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",n.specialties.slice(0,2).join(", "),")"]})]},n.id))]})]}),e.jsx(I,{children:"Asigna un instructor responsable de dirigir esta actividad"}),e.jsx(d,{})]})}}),e.jsx(c,{control:r.control,name:"ubicacion",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"UbicaciÃ³n"}),e.jsx(t,{children:e.jsx(xe,{parkId:T,value:a.value,onChange:a.onChange,placeholder:"Seleccionar ubicaciÃ³n"})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold border-b pb-2",children:"ProgramaciÃ³n y Detalles"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"fechaInicio",render:({field:a})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsx(o,{children:"Fecha de inicio"}),e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsx(t,{children:e.jsxs(N,{variant:"outline",className:K("pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),children:[a.value?U(a.value,"PPP",{locale:R}):e.jsx("span",{children:"Seleccionar fecha"}),e.jsx(H,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(O,{className:"w-auto p-0",align:"start",children:e.jsx(Q,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0,locale:R})})]}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"fechaFin",render:({field:a})=>e.jsxs(l,{className:"flex flex-col",children:[e.jsx(o,{children:"Fecha de fin (opcional)"}),e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsx(t,{children:e.jsxs(N,{variant:"outline",className:K("pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),children:[a.value?U(a.value,"PPP",{locale:R}):e.jsx("span",{children:"Seleccionar fecha"}),e.jsx(H,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(O,{className:"w-auto p-0",align:"start",children:e.jsx(Q,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0,locale:R,disabled:s=>{const n=r.getValues("fechaInicio");return n?s<n:!1}})})]}),e.jsx(I,{children:"Dejar en blanco para actividades de un solo dÃ­a"}),e.jsx(d,{})]})})]}),e.jsx(c,{control:r.control,name:"horaInicio",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Hora de inicio"}),e.jsx(t,{children:e.jsx(f,{type:"time",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"duracion",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"DuraciÃ³n (minutos)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:1,...a,onChange:s=>a.onChange(Number(s.target.value))})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"capacidad",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Capacidad mÃ¡xima (opcional)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:1,placeholder:"Deja en blanco si no hay lÃ­mite",value:a.value||"",onChange:s=>{const n=s.target.value;a.onChange(n===""?void 0:Number(n))}})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"esRecurrente",render:({field:a})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{children:"Actividad recurrente"}),e.jsx(I,{children:"Se repite semanalmente"})]}),e.jsx(t,{children:e.jsx(W,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(c,{control:r.control,name:"esGratuita",render:({field:a})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{children:"Actividad gratuita"}),e.jsx(I,{children:"No tiene costo para los participantes"})]}),e.jsx(t,{children:e.jsx(W,{checked:a.value,onCheckedChange:a.onChange})})]})})]}),!L&&e.jsx(c,{control:r.control,name:"precio",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Precio (MXN)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:1,step:.01,...a,onChange:s=>a.onChange(Number(s.target.value))})}),e.jsx(d,{})]})}),P&&e.jsx(c,{control:r.control,name:"diasRecurrentes",render:()=>e.jsxs(l,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(o,{className:"text-base",children:"DÃ­as de la semana"}),e.jsx(I,{children:"Selecciona los dÃ­as en que se repite la actividad"})]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-2",children:Z.map(a=>e.jsx(c,{control:r.control,name:"diasRecurrentes",render:({field:s})=>{var n;return e.jsxs(l,{className:"flex flex-row items-start space-x-2 space-y-0",children:[e.jsx(t,{children:e.jsx(oe,{checked:(n=s.value)==null?void 0:n.includes(a.id),onCheckedChange:C=>{const _=s.value||[];return C?s.onChange([..._,a.id]):s.onChange(_.filter(ee=>ee!==a.id))}})}),e.jsx(o,{className:"font-normal",children:a.label})]},a.id)}},a.id))}),e.jsx(d,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold border-b pb-2",children:"Detalles Adicionales"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{control:r.control,name:"materiales",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Materiales necesarios (opcional)"}),e.jsx(t,{children:e.jsx(G,{placeholder:"Lista de materiales requeridos para la actividad...",className:"min-h-[100px]",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"requisitos",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Requisitos para participantes (opcional)"}),e.jsx(t,{children:e.jsx(G,{placeholder:"Requisitos o recomendaciones para los participantes...",className:"min-h-[100px]",...a})}),e.jsx(d,{})]})})]}),e.jsx(c,{control:r.control,name:"personalRequerido",render:({field:a})=>e.jsxs(l,{children:[e.jsx(o,{children:"Personal requerido (opcional)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:0,placeholder:"NÃºmero de personas necesarias para organizar la actividad",value:a.value||"",onChange:s=>{const n=s.target.value;a.onChange(n===""?void 0:Number(n))}})}),e.jsx(d,{})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ImÃ¡genes de la actividad"}),e.jsx(pe,{onImagesChange:k,selectedImages:j})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>h("/admin/organizador"),children:"Cancelar"}),e.jsx(N,{type:"submit",disabled:y.isPending,children:y.isPending?"Creando actividad...":"Crear Actividad"})]})]})})})]})};export{Ne as default};
