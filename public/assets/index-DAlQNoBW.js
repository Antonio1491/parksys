import{a4 as p,u as S,j as e,bh as A,f as a,bi as P,B as k,D as T,g as x,h as o,a9 as O,i as c,W as g,Y as u,_ as N,$ as y,a0 as t,a as H,bj as m,U as K,ak as Q,M as z,q as D,n as G}from"./index-BKCBrrzQ.js";import{T as W}from"./trending-down-CPeGf22o.js";function X(){const[L,q]=p.useState("month"),[E,_]=p.useState("all"),[F,R]=p.useState("all"),{data:i,isLoading:B}=S({queryKey:["/api/active-concessions"],suspense:!1,retry:1}),{data:d,isLoading:U}=S({queryKey:["/api/parks"],suspense:!1,retry:1}),n=Array.isArray(i==null?void 0:i.data)?i.data:Array.isArray(i)?i:[],V=Array.isArray(d==null?void 0:d.data)?d.data:Array.isArray(d)?d:[],h=n.length,M=n.filter(s=>s.status==="active"||s.status==="").length,v=n.reduce((s,l)=>s+(parseFloat(l.monthly_payment)||0),0),$=h>0?v/h:0,f=n.reduce((s,l)=>(s[l.parkName]=(s[l.parkName]||0)+1,s),{}),b=Object.entries(f).reduce((s,l)=>s[1]>l[1]?s:l,["",0])[0]||"N/A",I=[{id:1,action:"Nueva concesión registrada",concession:"EcoBikes Tlaquepaque",date:"2025-01-22",amount:1500},{id:2,action:"Pago mensual recibido",concession:"Eventos Culturales Quintanar",date:"2025-01-21",amount:1167},{id:3,action:"Contrato renovado",concession:"Helados Artesanales Alcalde",date:"2025-01-20",amount:500},{id:4,action:"Evaluación completada",concession:"Food Truck Asia Fusion",date:"2025-01-19"},{id:5,action:"Cambio de ubicación",concession:"EcoBikes Tlaquepaque",date:"2025-01-18"}],w=()=>{const s=[["Concesión","Tipo","Parque","Estado","Pago Mensual","Fecha Inicio","Fecha Fin"],...n.map(r=>[r.name,r.concessionTypeName,r.parkName,r.status||"Activa",r.monthly_payment,new Date(r.start_date).toLocaleDateString(),new Date(r.end_date).toLocaleDateString()])].map(r=>r.join(",")).join(`
`),l=new Blob([s],{type:"text/csv"}),C=window.URL.createObjectURL(l),j=document.createElement("a");j.href=C,j.download=`reporte_concesiones_${new Date().toISOString().split("T")[0]}.csv`,j.click(),window.URL.revokeObjectURL(C)};return B||U?e.jsx(A,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx(a,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Generando reportes..."})]})]})}),e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})]})}):e.jsx(A,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx(a,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Análisis y reportes del sistema de concesiones"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{onClick:w,className:"bg-green-600 hover:bg-green-700 text-white gap-2",children:[e.jsx(T,{size:16}),"Exportar Reporte"]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(a,{children:[e.jsx(x,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Filtros de Reporte"]})}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(g,{value:L,onValueChange:q,children:[e.jsx(u,{children:e.jsx(N,{placeholder:"Período"})}),e.jsxs(y,{children:[e.jsx(t,{value:"week",children:"Última semana"}),e.jsx(t,{value:"month",children:"Último mes"}),e.jsx(t,{value:"quarter",children:"Último trimestre"}),e.jsx(t,{value:"year",children:"Último año"})]})]}),e.jsxs(g,{value:E,onValueChange:_,children:[e.jsx(u,{children:e.jsx(N,{placeholder:"Parque"})}),e.jsxs(y,{children:[e.jsx(t,{value:"all",children:"Todos los parques"}),V.map(s=>e.jsx(t,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsxs(g,{value:F,onValueChange:R,children:[e.jsx(u,{children:e.jsx(N,{placeholder:"Estado"})}),e.jsxs(y,{children:[e.jsx(t,{value:"all",children:"Todos los estados"}),e.jsx(t,{value:"active",children:"Activas"}),e.jsx(t,{value:"suspended",children:"Suspendidas"}),e.jsx(t,{value:"expired",children:"Vencidas"})]})]}),e.jsxs(k,{onClick:w,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(a,{children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Concesiones"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:h})]}),e.jsx(H,{className:"h-8 w-8 text-blue-600"})]}),e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx(m,{className:"h-4 w-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-sm text-green-600",children:"+12% vs mes anterior"})]})]})}),e.jsx(a,{children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Concesiones Activas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:M})]}),e.jsx(K,{className:"h-8 w-8 text-green-600"})]}),e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx(m,{className:"h-4 w-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-sm text-green-600",children:"+8% vs mes anterior"})]})]})}),e.jsx(a,{children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ingresos Mensuales"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["$",v.toLocaleString()]})]}),e.jsx(Q,{className:"h-8 w-8 text-yellow-600"})]}),e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx(m,{className:"h-4 w-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-sm text-green-600",children:"+15% vs mes anterior"})]})]})}),e.jsx(a,{children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pago Promedio"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["$",$.toLocaleString()]})]}),e.jsx(m,{className:"h-8 w-8 text-purple-600"})]}),e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx(W,{className:"h-4 w-4 text-red-600 mr-1"}),e.jsx("span",{className:"text-sm text-red-600",children:"-3% vs mes anterior"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(a,{children:[e.jsx(x,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Parque Top Performer"]})}),e.jsx(c,{children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:b}),e.jsxs("p",{className:"text-gray-600",children:[f[b]||0," concesiones activas"]}),e.jsx(D,{className:"mt-2 bg-green-100 text-green-800",children:"Líder del periodo"})]})})]}),e.jsxs(a,{children:[e.jsx(x,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Actividades Recientes"]})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:I.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.action}),e.jsx("p",{className:"text-xs text-gray-600",children:s.concession})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.date}),s.amount&&e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["$",s.amount]})]})]},s.id))})})]})]}),e.jsxs(a,{children:[e.jsx(x,{children:e.jsx(o,{children:"Detalle de Concesiones"})}),e.jsxs(c,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Concesión"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Tipo"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Parque"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Pago Mensual"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Vigencia"})]})}),e.jsx("tbody",{children:n.slice(0,10).map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 font-medium",children:s.name}),e.jsx("td",{className:"py-3 px-4",children:s.concessionTypeName}),e.jsx("td",{className:"py-3 px-4",children:s.parkName}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(D,{className:s.status==="active"||!s.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.status==="active"||!s.status?"Activa":"Inactiva"})}),e.jsxs("td",{className:"py-3 px-4",children:["$",parseFloat(s.monthly_payment||"0").toLocaleString()]}),e.jsxs("td",{className:"py-3 px-4",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]})]},s.id))})]})}),n.length>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Mostrando 10 de ",n.length," concesiones"]})})]})]})]})]})})}export{X as default};
