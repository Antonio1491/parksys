import{ay as h,a4 as f,aH as te,l as ie,az as ne,u as k,aA as z,ar as E,j as e,bh as le,cY as ce,ao as p,B as o,bv as oe,a6 as de,V as b,bH as xe,bI as me,bJ as w,bK as v,bL as ue,bM as d,q as S,bC as he,bT as ge,bU as je,bV as pe,bW as be,bX as ve,bY as Ne,bZ as ye,b_ as Ce,b$ as fe,c0 as we,y as M,I,J as K,K as O,aI as B,aJ as i,aK as n,aL as l,aM as c,aN as g,a1 as H,aB as Q,aC as T}from"./index-BKCBrrzQ.js";import{S as R}from"./switch-B8yCKxVc.js";const V=h.object({name:h.string().min(1,"El nombre es obligatorio").max(100,"Máximo 100 caracteres"),description:h.string().optional(),color:h.string().default("#00a587"),icon:h.string().default("tag"),isActive:h.boolean().default(!0)}),Ee=()=>{const[A,$]=f.useState(""),[L,F]=f.useState(null),[G,N]=f.useState(!1),[J,y]=f.useState(!1);te();const{toast:x}=ie(),D=ne(),{data:U=[],isLoading:Y}=k({queryKey:["/api/activity-categories"],retry:1}),{data:W=[]}=k({queryKey:["/api/activities"],retry:1}),r=z({resolver:Q(V),defaultValues:{name:"",description:"",color:"#00a587",icon:"tag",isActive:!0}}),t=z({resolver:Q(V),defaultValues:{name:"",description:"",color:"#00a587",icon:"tag",isActive:!0}}),C=E({mutationFn:async a=>T("/api/activity-categories",{method:"POST",data:a}),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/activity-categories"]}),y(!1),t.reset(),x({title:"Categoría creada",description:"La nueva categoría se creó correctamente."})},onError:a=>{x({title:"Error",description:a.message||"No se pudo crear la categoría.",variant:"destructive"})}}),j=E({mutationFn:async a=>T(`/api/activity-categories/${a.id}`,{method:"PUT",data:a.updates}),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/activity-categories"]}),N(!1),F(null),r.reset(),x({title:"Categoría actualizada",description:"La categoría se actualizó correctamente."})},onError:a=>{x({title:"Error",description:a.message||"No se pudo actualizar la categoría.",variant:"destructive"})}}),P=E({mutationFn:async a=>T(`/api/activity-categories/${a}`,{method:"DELETE"}),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/activity-categories"]}),x({title:"Categoría eliminada",description:"La categoría se eliminó correctamente."})},onError:a=>{x({title:"Error",description:a.message||"No se pudo eliminar la categoría.",variant:"destructive"})}}),X=a=>{F(a),r.reset({name:a.name||"",description:a.description||"",color:a.color||"#00a587",icon:a.icon||"tag",isActive:a.isActive!==!1}),N(!0)},Z=()=>{y(!0),t.reset({name:"",description:"",color:"#00a587",icon:"tag",isActive:!0})},_=a=>{C.mutate(a)},ee=a=>{L&&j.mutate({id:L.id,updates:a})},ae=a=>{P.mutate(a)},q=W.reduce((a,s)=>{let u="Sin categoría";return s.category?u=s.category:s.categoryName&&(u=s.categoryName),a[u]=(a[u]||0)+1,a},{}),se=a=>{switch(a){case"Arte y Cultura":return"bg-green-100 text-green-800";case"Recreación y Bienestar":return"bg-blue-100 text-blue-800";case"Eventos de Temporada":return"bg-orange-100 text-orange-800";case"Deportivo":return"bg-red-100 text-red-800";case"Comunidad":return"bg-purple-100 text-purple-800";case"Naturaleza y Ciencia":return"bg-teal-100 text-teal-800";case"Fitness y Ejercicio":return"bg-indigo-100 text-indigo-800";default:return"bg-gray-100 text-gray-800"}},m=U.map(a=>({id:a.id,name:a.name,description:a.description||"",count:q[a.name]||0,color:a.color||"#00a587",icon:a.icon||"calendar",isActive:a.isActive!==!1})).filter(a=>a.name.toLowerCase().includes(A.toLowerCase())||a.description.toLowerCase().includes(A.toLowerCase()));return e.jsx(le,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Categorías",subtitle:"Gestión de categorías para actividades en parques",icon:e.jsx(p,{}),actions:[e.jsxs(o,{variant:"primary",onClick:Z,children:[e.jsx(oe,{size:16}),"Nueva Categoría"]},"nueva-categoria")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Total Categorías"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:m.length})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(p,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Categorías Activas"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:m.filter(a=>a.isActive).length})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(p,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Total Actividades"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:Object.values(q).reduce((a,s)=>a+Number(s),0)})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:e.jsx(p,{className:"h-6 w-6 text-purple-600"})})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(b,{placeholder:"Buscar categorías...",value:A,onChange:a=>$(a.target.value),className:"pl-10"})]})}),e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(w,{children:[e.jsx(v,{children:"Nombre"}),e.jsx(v,{children:"Descripción"}),e.jsx(v,{children:"Actividades"}),e.jsx(v,{children:"Estado"}),e.jsx(v,{children:"Acciones"})]})}),e.jsx(ue,{children:Y?e.jsx(w,{children:e.jsx(d,{colSpan:5,className:"text-center py-8 text-gray-500",children:"Cargando categorías..."})}):m.length===0?e.jsx(w,{children:e.jsx(d,{colSpan:5,className:"text-center py-8 text-gray-500",children:"No se encontraron categorías"})}):m.map((a,s)=>e.jsxs(w,{children:[e.jsx(d,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-gray-500"}),a.name]})}),e.jsx(d,{className:"text-gray-600",children:a.description}),e.jsx(d,{children:e.jsxs(S,{variant:"outline",className:"bg-blue-50 text-blue-700",children:[a.count," actividades"]})}),e.jsx(d,{children:e.jsx(S,{variant:a.isActive?"default":"secondary",className:a.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600",children:a.isActive?"Activa":"Inactiva"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>X(a),disabled:j.isPending,children:e.jsx(he,{className:"h-4 w-4"})}),e.jsxs(ge,{children:[e.jsx(je,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",disabled:P.isPending,children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(be,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"¿Eliminar categoría?"}),e.jsxs(ye,{children:['Esta acción no se puede deshacer. La categoría "',a.name,'" será eliminada permanentemente.']})]}),e.jsxs(Ce,{children:[e.jsx(fe,{children:"Cancelar"}),e.jsx(we,{onClick:()=>ae(a.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})})]},a.name))})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Distribución por Categoría"}),e.jsx("div",{className:"space-y-3",children:m.filter(a=>a.count>0).sort((a,s)=>s.count-a.count).map(a=>{const s=Math.max(...m.map(re=>re.count)),u=s>0?a.count/s*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:se(a.name),children:a.name}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"w-48 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${u}%`}})})})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[a.count," actividades"]})]},a.name)})})]}),e.jsx(M,{open:G,onOpenChange:N,children:e.jsxs(I,{className:"sm:max-w-[500px]",children:[e.jsx(K,{children:e.jsx(O,{children:"Editar Categoría"})}),e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(ee),className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"name",render:({field:a})=>e.jsxs(n,{children:[e.jsx(l,{children:"Nombre de la categoría"}),e.jsx(c,{children:e.jsx(b,{placeholder:"Ej: Arte y Cultura",...a})}),e.jsx(g,{})]})}),e.jsx(i,{control:r.control,name:"description",render:({field:a})=>e.jsxs(n,{children:[e.jsx(l,{children:"Descripción"}),e.jsx(c,{children:e.jsx(H,{placeholder:"Descripción opcional de la categoría...",...a})}),e.jsx(g,{})]})}),e.jsx(i,{control:r.control,name:"color",render:({field:a})=>e.jsxs(n,{children:[e.jsx(l,{children:"Color"}),e.jsx(c,{children:e.jsx(b,{type:"color",...a})}),e.jsx(g,{})]})}),e.jsx(i,{control:r.control,name:"isActive",render:({field:a})=>e.jsxs(n,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"text-base",children:"Estado de la categoría"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.value?"Categoría activa y disponible":"Categoría inactiva (no se muestra en formularios)"})]}),e.jsx(c,{children:e.jsx(R,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:j.isPending,children:"Cancelar"}),e.jsx(o,{type:"submit",disabled:j.isPending,children:j.isPending?"Guardando...":"Guardar cambios"})]})]})})]})}),e.jsx(M,{open:J,onOpenChange:y,children:e.jsxs(I,{className:"sm:max-w-[500px]",children:[e.jsx(K,{children:e.jsx(O,{children:"Nueva Categoría"})}),e.jsx(B,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(_),className:"space-y-4",children:[e.jsx(i,{control:t.control,name:"name",render:({field:a})=>e.jsxs(n,{children:[e.jsx(l,{children:"Nombre de la categoría"}),e.jsx(c,{children:e.jsx(b,{placeholder:"Ej: Arte y Cultura",...a})}),e.jsx(g,{})]})}),e.jsx(i,{control:t.control,name:"description",render:({field:a})=>e.jsxs(n,{children:[e.jsx(l,{children:"Descripción"}),e.jsx(c,{children:e.jsx(H,{placeholder:"Descripción opcional de la categoría...",...a})}),e.jsx(g,{})]})}),e.jsx(i,{control:t.control,name:"color",render:({field:a})=>e.jsxs(n,{children:[e.jsx(l,{children:"Color"}),e.jsx(c,{children:e.jsx(b,{type:"color",...a})}),e.jsx(g,{})]})}),e.jsx(i,{control:t.control,name:"isActive",render:({field:a})=>e.jsxs(n,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"text-base",children:"Estado de la categoría"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.value?"Categoría activa y disponible":"Categoría inactiva (no se muestra en formularios)"})]}),e.jsx(c,{children:e.jsx(R,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>y(!1),disabled:C.isPending,children:"Cancelar"}),e.jsx(o,{type:"submit",disabled:C.isPending,children:C.isPending?"Creando...":"Crear categoría"})]})]})})]})})]})})};export{Ee as default};
