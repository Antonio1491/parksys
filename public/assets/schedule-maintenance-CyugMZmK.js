import{aH as Y,k as Z,a4 as s,u as k,j as e,bh as ee,B as o,A as T,f as A,g as E,h as q,i as w,Q as t,W as d,Y as m,_ as u,$ as h,ei as D,a0 as n,a1 as F,cE as ae,a3 as V,v as z,V as se,cp as ne,cV as c,cU as te}from"./index-BKCBrrzQ.js";const le=()=>{const[ie,r]=Y(),{id:i}=Z(),[l,B]=s.useState(new Date),[y,L]=s.useState("preventivo"),[f,U]=s.useState("medium"),[p,G]=s.useState(""),[N,J]=s.useState(""),[x,K]=s.useState(""),[j,Q]=s.useState(""),[v,S]=s.useState(i||""),[C,I]=s.useState(!1),{data:b=[]}=k({queryKey:["/api/assets"],retry:!1}),{data:H=[]}=k({queryKey:["/api/users"],retry:!1}),M=H.filter(a=>["admin","tecnico","supervisor"].includes(a.role)),O=[{id:1,name:"Banca Modelo Colonial",parkId:1,parkName:"Parque Central"},{id:2,name:"Juego Infantil Múltiple",parkId:1,parkName:"Parque Central"},{id:3,name:"Fuente Central",parkId:2,parkName:"Parque Metropolitano"},{id:4,name:"Señalización Informativa",parkId:2,parkName:"Parque Metropolitano"}],_=[{id:1,fullName:"Juan Pérez",role:"admin"},{id:2,fullName:"María López",role:"tecnico"},{id:3,fullName:"Carlos Gómez",role:"supervisor"}],$=b.length>0?b:O,R=M.length>0?M:_;s.useEffect(()=>{i&&S(i)},[i]);const W=async a=>{if(a.preventDefault(),!l){c({title:"Error",description:"Debes seleccionar una fecha para el mantenimiento",variant:"destructive"});return}if(!v){c({title:"Error",description:"Debes seleccionar un activo para el mantenimiento",variant:"destructive"});return}if(!p.trim()){c({title:"Error",description:"Debes ingresar una descripción del mantenimiento",variant:"destructive"});return}I(!0);try{const g={assetId:parseInt(v),date:z(l,"yyyy-MM-dd"),maintenanceType:y,description:p,priority:f,notes:N.trim()||null,estimatedCost:x?parseFloat(x):null,assignedToId:j?parseInt(j):null,status:"pendiente"},P=await fetch("/api/maintenance/schedule",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(g)});if(!P.ok){const X=await P.json();throw new Error(X.message||"Error al programar el mantenimiento")}te.invalidateQueries({queryKey:["/api/assets/maintenance/upcoming"]}),c({title:"Mantenimiento programado",description:"El mantenimiento ha sido programado correctamente"}),r(i?"/admin/assets/inventory":"/admin/assets/maintenance/calendar")}catch(g){console.error("Error al programar mantenimiento:",g),c({title:"Error",description:"No se pudo programar el mantenimiento. Por favor, intenta de nuevo.",variant:"destructive"})}finally{I(!1)}};return e.jsx(ee,{children:e.jsxs("div",{className:"container py-6",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(o,{variant:"outline",onClick:()=>r("/admin/assets/maintenance/calendar"),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Volver al Calendario"]}),i&&e.jsxs(o,{variant:"outline",onClick:()=>r("/admin/assets/inventory"),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Volver al Inventario"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Programar Mantenimiento"}),e.jsx("p",{className:"text-muted-foreground",children:"Programa un nuevo mantenimiento para un activo"})]})]})}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(q,{className:"text-lg",children:"Información Básica"})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"asset",children:"Activo*"}),e.jsxs(d,{value:v,onValueChange:S,required:!0,children:[e.jsx(m,{id:"asset",children:e.jsx(u,{placeholder:"Selecciona un activo"})}),e.jsx(h,{children:e.jsx(D,{children:$.map(a=>e.jsxs(n,{value:a.id.toString(),children:[a.name," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"maintenanceType",children:"Tipo de Mantenimiento*"}),e.jsxs(d,{value:y,onValueChange:L,required:!0,children:[e.jsx(m,{id:"maintenanceType",children:e.jsx(u,{placeholder:"Selecciona un tipo"})}),e.jsxs(h,{children:[e.jsx(n,{value:"preventivo",children:"Preventivo"}),e.jsx(n,{value:"correctivo",children:"Correctivo"}),e.jsx(n,{value:"predictivo",children:"Predictivo"}),e.jsx(n,{value:"inspeccion",children:"Inspección"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"priority",children:"Prioridad*"}),e.jsxs(d,{value:f,onValueChange:U,required:!0,children:[e.jsx(m,{id:"priority",children:e.jsx(u,{placeholder:"Selecciona la prioridad"})}),e.jsxs(h,{children:[e.jsx(n,{value:"low",children:"Baja"}),e.jsx(n,{value:"medium",children:"Media"}),e.jsx(n,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"description",children:"Descripción*"}),e.jsx(F,{id:"description",placeholder:"Describe el mantenimiento a realizar",value:p,onChange:a=>G(a.target.value),rows:3,required:!0})]})]})]}),e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(q,{className:"text-lg",children:"Detalles Adicionales"})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Fecha Programada*"}),e.jsx("div",{className:"border rounded-md p-3",children:e.jsx(ae,{mode:"single",selected:l,onSelect:B,locale:V,className:"mx-auto"})}),l&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fecha seleccionada: ",z(l,"dd 'de' MMMM 'de' yyyy",{locale:V})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"assignedTo",children:"Asignar a"}),e.jsxs(d,{value:j,onValueChange:Q,children:[e.jsx(m,{id:"assignedTo",children:e.jsx(u,{placeholder:"Selecciona un responsable (opcional)"})}),e.jsx(h,{children:e.jsx(D,{children:R.map(a=>e.jsxs(n,{value:a.id.toString(),children:[a.fullName," (",a.role,")"]},a.id))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"estimatedCost",children:"Costo Estimado (MXN)"}),e.jsx(se,{id:"estimatedCost",type:"number",placeholder:"Ingresa el costo estimado",value:x,onChange:a=>K(a.target.value),min:0,step:.01})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"notes",children:"Notas Adicionales"}),e.jsx(F,{id:"notes",placeholder:"Información adicional relevante",value:N,onChange:a=>J(a.target.value),rows:3})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(o,{variant:"outline",type:"button",className:"mr-2",onClick:()=>r("/admin/assets/maintenance/calendar"),children:"Cancelar"}),e.jsxs(o,{type:"submit",disabled:C,children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),C?"Guardando...":"Programar Mantenimiento"]})]})]})]})})};export{le as default};
