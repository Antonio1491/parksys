import{aH as Fe,l as Te,az as Le,a4 as c,u as ke,ar as W,R as q,j as e,bh as Re,bT as Z,bW as X,bX as ee,bY as se,bZ as ae,b_ as ie,b$ as le,c0 as re,f as b,i as S,w as Ye,a5 as $e,n as qe,b as te,ah as Ve,B as m,bv as Qe,bP as ze,bQ as Be,D as He,cZ as Ke,bR as Oe,c_ as Ge,c$ as Ue,bS as V,d0 as Q,bV as ne,a6 as _e,V as Je,W as D,Y as P,_ as I,$ as M,a0 as t,bG as ce,O as We,bH as Ze,bI as Xe,bJ as de,bK as h,d1 as es,bL as ss,bM as j,aa as oe,ab as xe,ac as me,an as as,bC as is,d2 as ls,d3 as rs,d4 as z,d5 as ts,d6 as ns,d7 as cs,y as ds,I as os,J as xs,K as ms,r as hs,P as js,q as o,M as us,v as ps,a3 as gs,aC as he}from"./index-BKCBrrzQ.js";function fs(){const[,F]=Fe(),{toast:w}=Te(),T=Le(),[u,B]=c.useState(""),[i,je]=c.useState(null),[ue,C]=c.useState(!1),[x,L]=c.useState(null),[g,H]=c.useState("all"),[v,K]=c.useState("all"),[d,O]=c.useState("all"),[f,G]=c.useState("all"),[n,U]=c.useState(1),N=10,[pe,E]=c.useState(!1),[vs,ge]=c.useState(null),{data:r=[],isLoading:ve,isError:Ne,refetch:fe}=ke({queryKey:["/api/instructors"],retry:1,enabled:!0}),k=W({mutationFn:async s=>await he(`/api/instructors/${s}`,{method:"DELETE"}),onSuccess:(s,a)=>{w({title:"Instructor eliminado",description:"El instructor ha sido eliminado correctamente",variant:"default"}),T.invalidateQueries({queryKey:["/api/instructors"]}),T.invalidateQueries({queryKey:["/public-api/instructors/public"]}),C(!1),L(null)},onError:s=>{console.error("Error al eliminar instructor:",s),w({title:"Error",description:"No se pudo eliminar el instructor. Por favor, inténtalo de nuevo.",variant:"destructive"}),C(!1),L(null)}}),R=W({mutationFn:async()=>await he("/api/instructors/batch/all",{method:"DELETE"}),onSuccess:s=>{w({title:"Instructores inactivados",description:`${s.count} instructores han sido inactivados correctamente`,variant:"default"}),T.invalidateQueries({queryKey:["/api/instructors"]}),E(!1)},onError:s=>{console.error("Error al eliminar todos los instructores:",s),w({title:"Error",description:"No se pudieron eliminar los instructores. Por favor, inténtalo de nuevo.",variant:"destructive"}),E(!1)}});Array.from(new Set(r.flatMap(s=>Array.isArray(s.specialties)?s.specialties:[]))).sort();const y=q.useMemo(()=>Array.isArray(r)?r.filter(s=>{var J;const a=u===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(u.toLowerCase())||((J=s.email)==null?void 0:J.toLowerCase().includes(u.toLowerCase()))||(Array.isArray(s.specialties)?s.specialties:[]).some(Me=>Me.toLowerCase().includes(u.toLowerCase())),l=f==="all"||!s.status||s.status===f,$=g==="all"||g===""||(Array.isArray(s.specialties)?s.specialties:[]).includes(g),Pe=v==="all"||v===""||s.rating&&s.rating>=parseFloat(v),Ie=d==="all"||d===""||d==="0-2"&&s.experienceYears<=2||d==="3-5"&&s.experienceYears>=3&&s.experienceYears<=5||d==="6-10"&&s.experienceYears>=6&&s.experienceYears<=10||d==="10+"&&s.experienceYears>10;return a&&l&&$&&Pe&&Ie}):[],[r,u,f,g,v,d]),A=q.useMemo(()=>{const s=(n-1)*N;return y.slice(s,s+N)},[y,n,N]),p=Math.ceil(y.length/N);c.useEffect(()=>{U(1)},[u,f,g,v,d]);const ye=()=>{x&&k.mutate(x.id)},be=()=>{E(!0)},we=()=>{R.mutate()},Ce=s=>{const a=r.find(l=>l.id===s);L(a),ge(s),C(!0)},Ee=s=>{if(!s)return"Fecha desconocida";try{const a=new Date(s);return ps(a,"dd MMM yyyy",{locale:gs})}catch{return"Fecha inválida"}},Ae=s=>{if(!s)return e.jsx(o,{children:"Sin estado"});switch(s){case"active":return e.jsx(o,{className:"bg-green-100 text-green-800 hover:bg-green-200",children:"Activo"});case"inactive":return e.jsx(o,{className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Inactivo"});case"pending":return e.jsx(o,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:"Pendiente"});default:return e.jsx(o,{children:s})}},Y=s=>{U(s)},Se=s=>!s||!Array.isArray(s)||s.length===0?e.jsx("span",{className:"text-gray-400 italic",children:"No especificado"}):s.length<=2?s.map((a,l)=>e.jsx(o,{variant:"outline",className:"mr-1 mb-1",children:a},l)):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",className:"mr-1 mb-1",children:s[0]}),e.jsxs(o,{variant:"outline",className:"mr-1 mb-1",children:["+",s.length-1," más"]})]}),De=q.useMemo(()=>{if(!Array.isArray(r)||r.length===0)return[];const s=new Set;return r.forEach(a=>{a.specialties&&Array.isArray(a.specialties)?a.specialties.forEach(l=>{s.add(l.trim())}):a.specialties&&typeof a.specialties=="string"&&a.specialties.split(",").forEach($=>{s.add($.trim())})}),Array.from(s)},[r]),_=s=>e.jsxs("div",{className:"flex items-center",children:[[1,2,3,4,5].map(a=>e.jsx(te,{className:`h-4 w-4 ${a<=s?"text-yellow-400 fill-current":"text-gray-300"}`},a)),e.jsxs("span",{className:"ml-1 text-sm text-gray-600",children:["(",s.toFixed(1),")"]})]});return e.jsxs(Re,{title:"Gestión de Instructores",children:[e.jsx(Z,{open:pe,onOpenChange:E,children:e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"¿Estás seguro?"}),e.jsx(ae,{children:"Esta acción desactivará a todos los instructores en el sistema y no se puede deshacer. Los instructores marcados como inactivos ya no aparecerán en las listas públicas ni podrán ser asignados a actividades."})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Cancelar"}),e.jsx(re,{onClick:we,disabled:R.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:R.isPending?"Procesando...":"Confirmar eliminación"})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(b,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Instructores"}),e.jsx("p",{className:"text-2xl font-bold text-[#00a587]",children:r.length})]}),e.jsx(Ye,{className:"h-8 w-8 text-[#00a587]"})]})})}),e.jsx(b,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Especialidades"}),e.jsx("p",{className:"text-2xl font-bold text-[#067f5f]",children:new Set(r.flatMap(s=>s.specialties)).size})]}),e.jsx($e,{className:"h-8 w-8 text-[#067f5f]"})]})})}),e.jsx(b,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Promedio Experiencia"}),e.jsxs("p",{className:"text-2xl font-bold text-[#8498a5]",children:[r.length>0?Math.round(r.reduce((s,a)=>s+a.experienceYears,0)/r.length):0," años"]})]}),e.jsx(qe,{className:"h-8 w-8 text-[#8498a5]"})]})})}),e.jsx(b,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Calificación Promedio"}),e.jsx("p",{className:"text-2xl font-bold text-[#bcd256]",children:r.length>0?(r.reduce((s,a)=>s+(a.rating||0),0)/r.length).toFixed(1):"0.0"})]}),e.jsx(te,{className:"h-8 w-8 text-[#bcd256]"})]})})})]}),e.jsx(b,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Instructores"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona la lista de instructores registrados en la plataforma"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{onClick:()=>F("/admin/activities/instructors/new"),className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Nuevo Instructor"]}),e.jsxs(ze,{children:[e.jsx(Be,{asChild:!0,children:e.jsxs(m,{variant:"outline",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Exportar",e.jsx(Ke,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(Oe,{children:[e.jsx(Ge,{children:"Formato"}),e.jsx(Ue,{}),e.jsxs(V,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Excel"]}),e.jsxs(V,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"CSV"]}),e.jsxs(V,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"PDF"]})]})]}),e.jsxs(m,{variant:"outline",onClick:be,children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Eliminar Todos"]})]})]})}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative w-full sm:w-96",children:[e.jsx(_e,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(Je,{placeholder:"Buscar instructores...",value:u,onChange:s=>B(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4 items-end",children:[e.jsx("div",{className:"w-full md:w-1/5",children:e.jsxs(D,{value:f,onValueChange:G,children:[e.jsx(P,{children:e.jsx(I,{placeholder:"Filtrar por estado"})}),e.jsxs(M,{children:[e.jsx(t,{value:"all",children:"Todos los estados"}),e.jsx(t,{value:"active",children:"Activos"}),e.jsx(t,{value:"inactive",children:"Inactivos"}),e.jsx(t,{value:"pending",children:"Pendientes"})]})]})}),e.jsx("div",{className:"w-full md:w-1/5",children:e.jsxs(D,{value:g,onValueChange:H,children:[e.jsx(P,{children:e.jsx(I,{placeholder:"Filtrar por especialidad"})}),e.jsxs(M,{children:[e.jsx(t,{value:"all",children:"Todas las especialidades"}),De.map((s,a)=>e.jsx(t,{value:s,children:s},a))]})]})}),e.jsx("div",{className:"w-full md:w-1/5",children:e.jsxs(D,{value:v,onValueChange:K,children:[e.jsx(P,{children:e.jsx(I,{placeholder:"Calificación mínima"})}),e.jsxs(M,{children:[e.jsx(t,{value:"all",children:"Todas las calificaciones"}),e.jsx(t,{value:"4.5",children:"4.5+ estrellas"}),e.jsx(t,{value:"4.0",children:"4.0+ estrellas"}),e.jsx(t,{value:"3.5",children:"3.5+ estrellas"}),e.jsx(t,{value:"3.0",children:"3.0+ estrellas"})]})]})}),e.jsx("div",{className:"w-full md:w-1/5",children:e.jsxs(D,{value:d,onValueChange:O,children:[e.jsx(P,{children:e.jsx(I,{placeholder:"Experiencia"})}),e.jsxs(M,{children:[e.jsx(t,{value:"all",children:"Toda la experiencia"}),e.jsx(t,{value:"0-2",children:"0-2 años"}),e.jsx(t,{value:"3-5",children:"3-5 años"}),e.jsx(t,{value:"6-10",children:"6-10 años"}),e.jsx(t,{value:"10+",children:"Más de 10 años"})]})]})}),e.jsxs(m,{variant:"outline",className:"w-full md:w-auto",onClick:()=>{B(""),G("all"),H("all"),K("all"),O("all")},children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Limpiar filtros"]})]}),e.jsx("div",{className:"bg-white rounded-md shadow",children:ve?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Cargando instructores..."})]}):Ne?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(We,{className:"h-8 w-8 mx-auto text-red-500"}),e.jsx("p",{className:"mt-2 text-red-500",children:"Error al cargar los instructores"}),e.jsx(m,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>fe(),children:"Reintentar"})]}):(A==null?void 0:A.length)===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:r?"No se encontraron instructores que coincidan con los criterios de búsqueda.":"Haz clic en 'Cargar instructores' para ver los datos."})}):e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(Ze,{children:[e.jsx(Xe,{children:e.jsxs(de,{children:[e.jsx(h,{children:"Nombre"}),e.jsx(h,{children:"Contacto"}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center",children:["Estado",e.jsx(es,{className:"ml-2 h-4 w-4"})]})}),e.jsx(h,{children:"Especialidades"}),e.jsx(h,{children:"Experiencia"}),e.jsx(h,{children:"Calificación"}),e.jsx(h,{children:"Inicio"}),e.jsx(h,{className:"text-right",children:"Acciones"})]})}),e.jsx(ss,{children:A.map(s=>{var a,l;return e.jsxs(de,{children:[e.jsx(j,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(oe,{children:[e.jsx(xe,{src:s.profileImageUrl}),e.jsxs(me,{children:[((a=s.firstName)==null?void 0:a[0])||"I",((l=s.lastName)==null?void 0:l[0])||"N"]})]}),e.jsxs("div",{children:[s.firstName," ",s.lastName,e.jsxs("div",{className:"text-sm text-gray-500",children:[s.activitiesCount||0," actividades"]})]})]})}),e.jsxs(j,{children:[e.jsx("div",{children:s.email}),s.phone&&e.jsx("div",{className:"text-muted-foreground text-xs",children:s.phone})]}),e.jsx(j,{children:Ae(s.status)}),e.jsx(j,{children:Se(s.specialties)}),e.jsx(j,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.experienceYears," ",s.experienceYears===1?"año":"años"]}),s.hourlyRate&&e.jsxs("div",{className:"text-sm text-gray-600",children:["$",s.hourlyRate,"/hr"]})]})}),e.jsx(j,{children:s.rating?_(s.rating):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin calificar"})}),e.jsx(j,{children:Ee(s.createdAt)}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>F(`/admin/activities/instructors/detail/${s.id}`),title:"Ver detalles",children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>F(`/admin/activities/instructors/edit/${s.id}`),title:"Editar instructor",children:e.jsx(is,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>Ce(s.id),title:"Eliminar instructor",className:"hover:bg-red-50 hover:text-red-600",children:e.jsx(ne,{className:"h-4 w-4"})})]})})]},s.id)})})]})})}),p>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",(n-1)*N+1," a ",Math.min(n*N,y.length)," de ",y.length," instructores"]}),e.jsx(ls,{children:e.jsxs(rs,{children:[e.jsx(z,{children:e.jsx(ts,{onClick:()=>Y(Math.max(1,n-1)),className:n<=1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,p)},(s,a)=>{let l;return p<=5||n<=3?l=a+1:n>=p-2?l=p-4+a:l=n-2+a,e.jsx(z,{children:e.jsx(ns,{onClick:()=>Y(l),isActive:n===l,className:"cursor-pointer",children:l})},l)}),e.jsx(z,{children:e.jsx(cs,{onClick:()=>Y(Math.min(p,n+1)),className:n>=p?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]}),i&&e.jsx(ds,{open:!0,onOpenChange:()=>je(null),children:e.jsxs(os,{className:"max-w-2xl",children:[e.jsx(xs,{children:e.jsxs(ms,{className:"flex items-center space-x-3",children:[e.jsxs(oe,{className:"h-12 w-12",children:[e.jsx(xe,{src:i.profileImageUrl}),e.jsxs(me,{children:[i.firstName[0],i.lastName[0]]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xl font-bold",children:[i.firstName," ",i.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Instructor - ",i.experienceYears," años de experiencia"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Información de Contacto"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(hs,{className:"mr-2 h-4 w-4 text-gray-400"}),e.jsx("span",{children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(js,{className:"mr-2 h-4 w-4 text-gray-400"}),e.jsx("span",{children:i.phone})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Especialidades"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:i.specialties.map((s,a)=>e.jsx(o,{variant:"secondary",className:"bg-[#00a587]/10 text-[#00a587]",children:s},a))})]}),i.preferredParkName&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Parque Preferido"}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(us,{className:"mr-2 h-4 w-4 text-gray-400"}),e.jsx("span",{children:i.preferredParkName})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Información Profesional"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Experiencia:"})," ",i.experienceYears," años"]}),i.hourlyRate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",i.hourlyRate,"/hora"]}),i.availability&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Disponibilidad:"})," ",i.availability]}),i.rating&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium mr-2",children:"Calificación:"}),_(i.rating)]})]})]}),i.activitiesCount!==void 0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Estadísticas"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Actividades impartidas:"})," ",i.activitiesCount]})]})]})]}),i.bio&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Biografía"}),e.jsx("p",{className:"text-sm text-gray-700",children:i.bio})]}),i.experience&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Experiencia y Certificaciones"}),e.jsx("p",{className:"text-sm text-gray-700",children:i.experience})]})]})}),e.jsx(Z,{open:ue,onOpenChange:C,children:e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"¿Eliminar instructor?"}),e.jsxs(ae,{children:['Esta acción eliminará permanentemente el instructor "',x==null?void 0:x.firstName," ",x==null?void 0:x.lastName,'" . Esta acción no se puede deshacer.']})]}),e.jsxs(ie,{children:[e.jsx(le,{children:"Cancelar"}),e.jsx(re,{onClick:ye,className:"bg-red-600 hover:bg-red-700",disabled:k.isPending,children:k.isPending?"Eliminando...":"Eliminar"})]})]})})]})}export{fs as default};
