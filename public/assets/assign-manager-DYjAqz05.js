import{aH as G,a4 as g,u as y,j as e,bh as J,B as h,A as K,f as S,g as I,h as C,ad as A,i as k,Q as q,W as w,Y as E,_ as U,$ as R,ei as L,a0 as P,q as M,aa as Q,ab as $,ac as H,cp as O,cV as d,cU as _}from"./index-BKCBrrzQ.js";const W=r=>r.split(" ").map(n=>n[0]).join("").toUpperCase(),z=r=>({admin:"bg-red-100 text-red-800",supervisor:"bg-blue-100 text-blue-800",tecnico:"bg-green-100 text-green-800",responsable:"bg-purple-100 text-purple-800",gerente:"bg-yellow-100 text-yellow-800"})[r]||"bg-gray-100 text-gray-800",j=r=>({admin:"Administrador",supervisor:"Supervisor",tecnico:"Técnico",responsable:"Responsable",gerente:"Gerente"})[r]||r,X=()=>{const[r,n]=G(),[l,B]=g.useState(""),[i,m]=g.useState(""),[f,N]=g.useState(!1),{data:u=[]}=y({queryKey:["/api/assets"],retry:!1}),{data:v=[]}=y({queryKey:["/api/users"],retry:!1}),b=Array.isArray(v)?v.filter(a=>["admin","supervisor","gerente","responsable"].includes(a.role)):[],D=[{id:1,name:"Banca Modelo Colonial",parkId:1,parkName:"Parque Central",managerId:null},{id:2,name:"Juego Infantil Múltiple",parkId:1,parkName:"Parque Central",managerId:null},{id:3,name:"Fuente Central",parkId:2,parkName:"Parque Metropolitano",managerId:null},{id:4,name:"Señalización Informativa",parkId:2,parkName:"Parque Metropolitano",managerId:null}],T=[{id:1,fullName:"Juan Pérez",role:"admin",profileImageUrl:null},{id:2,fullName:"María López",role:"supervisor",profileImageUrl:null},{id:3,fullName:"Carlos Gómez",role:"gerente",profileImageUrl:null}],p=Array.isArray(u)&&u.length>0?u:D,x=b.length>0?b:T,s=p.find(a=>a.id.toString()===l),o=s!=null&&s.managerId?x.find(a=>a.id.toString()===s.managerId.toString()):null,V=async a=>{if(a.preventDefault(),!l){d({title:"Error",description:"Debes seleccionar un activo para asignar un responsable",variant:"destructive"});return}if(!i){d({title:"Error",description:"Debes seleccionar un usuario como responsable",variant:"destructive"});return}N(!0);try{const t={assetId:parseInt(l),managerId:parseInt(i)},c=await fetch(`/api/assets/${l}/assign-manager`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)});if(!c.ok){const F=await c.json();throw new Error(F.message||"Error al asignar responsable")}_.invalidateQueries({queryKey:["/api/assets"]}),d({title:"Responsable asignado",description:"El responsable ha sido asignado correctamente al activo"}),n("/admin/assets")}catch(t){console.error("Error al asignar responsable:",t),d({title:"Error",description:"No se pudo asignar el responsable. Por favor, intenta de nuevo.",variant:"destructive"})}finally{N(!1)}};return e.jsx(J,{children:e.jsxs("div",{className:"container py-6",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(h,{variant:"outline",onClick:()=>n("/admin/assets"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Volver a Activos"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Asignar Responsable"}),e.jsx("p",{className:"text-muted-foreground",children:"Asigna un usuario responsable para la gestión de activos"})]})]})}),e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(C,{className:"text-lg",children:"Seleccionar Activo"}),e.jsx(A,{children:"Elige el activo al que deseas asignar un responsable"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"asset",children:"Activo*"}),e.jsxs(w,{value:l,onValueChange:a=>{B(a);const t=p.find(c=>c.id.toString()===a);t&&t.managerId?m(t.managerId.toString()):m("")},required:!0,children:[e.jsx(E,{id:"asset",children:e.jsx(U,{placeholder:"Selecciona un activo"})}),e.jsx(R,{children:e.jsx(L,{children:p.map(a=>e.jsxs(P,{value:a.id.toString(),children:[a.name," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]}),l&&e.jsxs("div",{className:"border rounded-md p-4 bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Información del activo"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nombre:"}),e.jsx("span",{className:"text-sm font-medium",children:s==null?void 0:s.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Parque:"}),e.jsx("span",{className:"text-sm font-medium",children:(s==null?void 0:s.parkName)||"No asignado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Responsable actual:"}),e.jsx("span",{className:"text-sm font-medium",children:o?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:o.fullName}),e.jsx(M,{variant:"outline",className:z(o.role),children:j(o.role)})]}):"No asignado"})]})]})]})]})]}),e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(C,{className:"text-lg",children:"Seleccionar Responsable"}),e.jsx(A,{children:"Elige el usuario que será responsable del activo"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"manager",children:"Responsable*"}),e.jsxs(w,{value:i,onValueChange:m,required:!0,children:[e.jsx(E,{id:"manager",children:e.jsx(U,{placeholder:"Selecciona un responsable"})}),e.jsx(R,{children:e.jsx(L,{children:x.map(a=>e.jsxs(P,{value:a.id.toString(),children:[a.fullName," (",j(a.role),")"]},a.id))})})]})]}),i&&e.jsx("div",{className:"grid gap-4",children:x.filter(a=>a.id.toString()===i).map(a=>e.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-md",children:[e.jsx(Q,{className:"h-12 w-12",children:a.profileImageUrl?e.jsx($,{src:a.profileImageUrl,alt:a.fullName}):e.jsx(H,{children:W(a.fullName)})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium",children:a.fullName}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{variant:"outline",className:z(a.role),children:j(a.role)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.email})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Este usuario tendrá permisos para gestionar este activo, programar mantenimientos y actualizar su estado."})]})]},a.id))})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(h,{variant:"outline",type:"button",className:"mr-2",onClick:()=>n("/admin/assets"),children:"Cancelar"}),e.jsxs(h,{type:"submit",disabled:f,children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),f?"Guardando...":"Asignar Responsable"]})]})]})]})})};export{X as default};
