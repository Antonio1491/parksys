import{a4 as o,az as F,l as U,ar as V,j as e,bh as $,f as c,L as z,B as d,A as B,bD as j,g as m,h as x,i as h,au as g,O as E,av as f,D as v,ad as S,b0 as I,Q as O,V as P,al as T}from"./index-BKCBrrzQ.js";function Q(){const[l,N]=o.useState(null),[b,y]=o.useState(!1),[a,p]=o.useState(null),u=o.useRef(null),A=F(),{toast:i}=U(),D=V({mutationFn:async s=>{const r=new FormData;r.append("file",s);const t=await fetch("/api/amenities/import",{method:"POST",body:r});if(!t.ok)throw new Error("Error al importar amenidades");return t.json()},onSuccess:s=>{p(s),s.success?(A.invalidateQueries({queryKey:["/api/amenities"]}),i({title:"Importación completada",description:`${s.imported} amenidades importadas exitosamente`})):i({title:"Error en la importación",description:s.message,variant:"destructive"})},onError:s=>{i({title:"Error",description:"Error al procesar el archivo",variant:"destructive"}),console.error("Import error:",s)}}),R=s=>{var t;const r=(t=s.target.files)==null?void 0:t[0];r&&(N(r),p(null))},k=async()=>{if(l){y(!0);try{await D.mutateAsync(l)}finally{y(!1)}}},L=()=>{N(null),p(null),u.current&&(u.current.value="")},w=async s=>{try{const t=await(await fetch(`/api/amenities/template?format=${s}`)).blob(),C=window.URL.createObjectURL(t),n=document.createElement("a");n.href=C,n.download=`plantilla_amenidades.${s}`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(C),i({title:"Plantilla descargada",description:`Se ha descargado la plantilla en formato ${s.toUpperCase()}`})}catch{i({title:"Error",description:"Error al descargar la plantilla",variant:"destructive"})}};return e.jsxs($,{children:[e.jsx(c,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{href:"/admin/amenities",children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Volver a Amenidades"]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-8 h-8 text-gray-900"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Importar Amenidades"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Importa amenidades masivamente desde un archivo CSV o Excel"})]})]})}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(c,{children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"Instrucciones de Importación"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-medium",children:"1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Descarga la plantilla"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Descarga la plantilla con los campos requeridos para amenidades"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-medium",children:"2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Completa los datos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Llena la plantilla con la información de las amenidades. Los campos obligatorios son: name, icon, category"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-medium",children:"3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Sube el archivo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecciona el archivo completado y procesa la importación"})]})]})]}),e.jsxs(g,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs(f,{children:[e.jsx("strong",{children:"Valores válidos:"}),e.jsx("br",{}),"• ",e.jsx("strong",{children:"category:"})," servicios, infraestructura, recreativo, deportivo, cultural, ambiental",e.jsx("br",{}),"• ",e.jsx("strong",{children:"icon_type:"})," system, custom (por defecto: system)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"icon:"})," Para system: playground, sports, bathroom, parking, restaurant, bench, fountain, wifi, security, garden, park"]})]})]})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Descargar Plantilla"]}),e.jsx(S,{children:"Descarga la plantilla con los campos necesarios para importar amenidades"})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(d,{variant:"outline",onClick:()=>w("csv"),className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"Descargar CSV"]}),e.jsxs(d,{variant:"outline",onClick:()=>w("xlsx"),className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"Descargar Excel"]})]})})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Subir Archivo"]}),e.jsx(S,{children:"Selecciona el archivo CSV o Excel con las amenidades a importar"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(O,{htmlFor:"file",children:"Archivo de amenidades"}),e.jsx(P,{id:"file",type:"file",ref:u,accept:".csv,.xlsx,.xls",onChange:R,className:"cursor-pointer"}),l&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium",children:l.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(l.size/1024).toFixed(1)," KB)"]})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:L,className:"text-gray-500 hover:text-gray-700",children:"Eliminar"})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(d,{onClick:k,disabled:!l||b,className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),b?"Importando...":"Importar Amenidades"]})})]})]}),a&&e.jsxs(c,{children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[a.success?e.jsx(T,{className:"h-5 w-5 text-green-500"}):e.jsx(E,{className:"h-5 w-5 text-red-500"}),"Resultados de la Importación"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600",children:"Registros procesados"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:a.processed})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600",children:"Registros importados"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:a.imported})]})]}),a.message&&e.jsx(g,{variant:a.success?"default":"destructive",children:e.jsx(f,{children:a.message})}),a.errors&&a.errors.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-red-700",children:"Errores encontrados:"}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:a.errors.map((s,r)=>e.jsx(g,{variant:"destructive",children:e.jsxs(f,{children:[e.jsxs("strong",{children:["Fila ",s.row,":"]})," ",s.field&&`${s.field} - `,s.message]})},r))})]})]})]})]})]})}export{Q as default};
