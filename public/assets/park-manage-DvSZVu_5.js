import{l as be,az as we,a4 as d,u as X,ar as N,j as e,bk as os,bl as cs,bm as J,cN as bs,F as Ke,cO as ye,bn as H,y as te,z as ke,B as c,bv as Y,I as ne,J as le,K as oe,V as h,a1 as me,bE as ue,f as S,q,b as fe,i as A,an as Me,bV as ce,D as ws,b0 as Es,aC as W,g as K,h as M,cP as Xe,cQ as qe,M as xe,bC as ds,aA as Be,b5 as Cs,b1 as ks,ad as re,a6 as ms,cR as _e,b2 as he,N as Ge,aI as Ze,aJ as L,aK as R,aL as Q,aM as O,aN as I,W as Je,Y as He,_ as Ye,$ as We,a0 as ae,ay as Z,aB as es,U as ie,a9 as qs,r as ss,P as as,w as Ss,k as As,bh as Se,L as rs,A as Ds}from"./index-BKCBrrzQ.js";import{L as Ts}from"./link-B2tJo4Q1.js";import{P as Ps}from"./play-CT3qsobi.js";import{T as is}from"./tree-species-icon-EKrahysV.js";import{I as ts}from"./images-Cb_dqg3y.js";import"./flower-BdnEzTBO.js";function Fs({parkId:r}){const{toast:l}=be(),o=we(),[y,j]=d.useState(!1),[b,D]=d.useState(!1),[w,$]=d.useState(!1),[z,E]=d.useState(null),[f,g]=d.useState(""),[x,F]=d.useState(""),[C,U]=d.useState(!1),[k,V]=d.useState(null),[i,m]=d.useState(""),[p,T]=d.useState(null),[P,ee]=d.useState(""),[_,se]=d.useState(""),[t,u]=d.useState(""),[G,de]=d.useState(!1),[a,v]=d.useState("file"),[pe,Ae]=d.useState(""),[De,Te]=d.useState(""),[Pe,Fe]=d.useState("general"),us=()=>{E(null),g(""),F(""),U(!1)},xs=()=>{V(null),m(""),Ae(""),Te(""),Fe("general")},hs=()=>{T(null),ee(""),se(""),u(""),de(!1),v("file")},{data:ge=[],isLoading:Ue,error:ps}=X({queryKey:[`/api/parks/${r}/images`],queryFn:async()=>{console.log(`ðŸ” FRONTEND: Cargando imÃ¡genes para parque ${r}`);const s=await fetch(`/api/parks/${r}/images`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!s.ok)throw new Error("Error cargando imÃ¡genes");const n=await s.json();return console.log("âœ… FRONTEND: ImÃ¡genes cargadas:",n),n},staleTime:0,gcTime:0}),{data:je=[],isLoading:$e,error:gs}=X({queryKey:[`/api/parks/${r}/documents`],queryFn:async()=>{console.log(`ðŸ” FRONTEND: Cargando documentos para parque ${r}`);const s=await fetch(`/api/parks/${r}/documents`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!s.ok)throw new Error("Error cargando documentos");const n=await s.json();return console.log("âœ… FRONTEND: Documentos cargados:",n),n},staleTime:0,gcTime:0}),{data:Ee=[],isLoading:js,error:ze}=X({queryKey:[`/api/parks/${r}/videos`],queryFn:async()=>{console.log(`ðŸ” FRONTEND: Cargando videos para parque ${r}`);const s=await fetch(`/api/parks/${r}/videos`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!s.ok)throw new Error("Error cargando videos");const n=await s.json();return console.log("âœ… FRONTEND: Videos cargados:",n),n},staleTime:0,gcTime:0}),ve=N({mutationFn:async s=>{if(s instanceof FormData){const n=await fetch(`/api/parks/${r}/images`,{method:"POST",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:s});if(!n.ok)throw new Error("Error subiendo imagen");return n.json()}else return(await W(`/api/parks/${r}/images`,{method:"POST",data:s})).json()},onSuccess:()=>{l({title:"Imagen subida",description:"La imagen se ha agregado exitosamente al parque."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/images`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]}),us(),j(!1)},onError:s=>{l({title:"Error",description:"No se pudo subir la imagen. Intente nuevamente.",variant:"destructive"})}}),Ve=N({mutationFn:async s=>(await W(`/api/park-images/${s}/set-primary`,{method:"POST",data:{}})).json(),onSuccess:()=>{l({title:"Imagen principal actualizada",description:"Se ha establecido la nueva imagen principal del parque."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/images`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]})},onError:()=>{l({title:"Error",description:"No se pudo establecer la imagen principal.",variant:"destructive"})}}),Le=N({mutationFn:async s=>await W(`/api/park-images/${s}`,{method:"DELETE"}),onSuccess:()=>{l({title:"Imagen eliminada",description:"La imagen se ha eliminado correctamente."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/images`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]}),o.removeQueries({queryKey:[`/api/parks/${r}/images`]}),o.refetchQueries({queryKey:[`/api/parks/${r}/images`]}),setTimeout(()=>{o.invalidateQueries({queryKey:[`/api/parks/${r}/images`]})},100)},onError:()=>{l({title:"Error",description:"No se pudo eliminar la imagen.",variant:"destructive"})}}),Ce=N({mutationFn:async s=>{const n=await fetch(`/api/parks/${r}/documents`,{method:"POST",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:s});if(!n.ok){const B=await n.text();throw console.error("âŒ Error uploading document:",B),new Error("Error subiendo documento")}return n.json()},onSuccess:()=>{l({title:"Documento subido",description:"El documento se ha agregado exitosamente al parque."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/documents`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]}),xs(),D(!1)},onError:s=>{l({title:"Error",description:"No se pudo subir el documento. Intente nuevamente.",variant:"destructive"})}}),Re=N({mutationFn:async s=>(console.log(`ðŸŒ [API REQUEST] DELETE /api/park-documents/${s}`),await W(`/api/park-documents/${s}`,{method:"DELETE"})),onSuccess:s=>{l({title:"Documento eliminado",description:(s==null?void 0:s.message)||"El documento se ha eliminado correctamente."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/documents`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]}),o.invalidateQueries({queryKey:["/api/parks"]}),o.refetchQueries({queryKey:[`/api/parks/${r}/documents`]})},onError:s=>{console.error("âŒ Error en eliminaciÃ³n:",s),o.invalidateQueries({queryKey:[`/api/parks/${r}/documents`]}),o.refetchQueries({queryKey:[`/api/parks/${r}/documents`]}),l({title:"Error",description:"No se pudo eliminar el documento.",variant:"destructive"})}}),Ne=N({mutationFn:async s=>{if(s instanceof FormData){const n=await fetch(`/api/parks/${r}/videos`,{method:"POST",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:s});if(!n.ok)throw new Error("Error subiendo video");return n.json()}else{const n=await fetch(`/api/parks/${r}/videos`,{method:"POST",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin","Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok)throw new Error("Error subiendo video");return n.json()}},onSuccess:()=>{l({title:"Video subido",description:"El video se ha agregado exitosamente al parque."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/videos`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]}),hs(),$(!1)},onError:s=>{l({title:"Error",description:"No se pudo subir el video. Intente nuevamente.",variant:"destructive"})}}),Qe=N({mutationFn:async s=>{const n=await fetch(`/api/park-videos/${s}/set-featured`,{method:"POST",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin","Content-Type":"application/json"},body:JSON.stringify({})});if(!n.ok)throw new Error("Error actualizando video destacado");return n.json()},onSuccess:()=>{l({title:"Video destacado actualizado",description:"Se ha establecido el nuevo video destacado del parque."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/videos`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]})},onError:()=>{l({title:"Error",description:"No se pudo establecer el video destacado.",variant:"destructive"})}}),Oe=N({mutationFn:async s=>{const n=await fetch(`/api/park-videos/${s}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!n.ok)throw new Error("Error eliminando video");return n.json()},onSuccess:()=>{l({title:"Video eliminado",description:"El video se ha eliminado correctamente."}),o.invalidateQueries({queryKey:[`/api/parks/${r}/videos`]}),o.invalidateQueries({queryKey:[`/api/parks/${r}`]})},onError:()=>{l({title:"Error",description:"No se pudo eliminar el video.",variant:"destructive"})}}),vs=()=>{if(z){const s=new FormData;s.append("image",z),s.append("caption",x),s.append("isPrimary",C.toString()),ve.mutate(s)}else f&&ve.mutate({imageUrl:f,caption:x,isPrimary:C})},Ns=()=>{if(!pe.trim()){l({title:"Error",description:"El tÃ­tulo del documento es requerido.",variant:"destructive"});return}if(!k){l({title:"Error",description:"Debe seleccionar un archivo para subir.",variant:"destructive"});return}const s=new FormData;s.append("document",k),s.append("title",pe),s.append("description",De),s.append("category",Pe),Ce.mutate(s)},ys=()=>{if(!_.trim()){l({title:"Error",description:"El tÃ­tulo del video es requerido.",variant:"destructive"});return}if(a==="file"){if(!p){l({title:"Error",description:"Debe seleccionar un archivo de video para subir.",variant:"destructive"});return}const s=new FormData;s.append("video",p),s.append("title",_),s.append("description",t),s.append("isFeatured",G.toString()),s.append("videoType","file"),Ne.mutate(s)}else{if(!P.trim()){l({title:"Error",description:"La URL del video es requerida.",variant:"destructive"});return}let s="external";P.includes("youtube.com")||P.includes("youtu.be")?s="youtube":P.includes("vimeo.com")&&(s="vimeo"),Ne.mutate({videoUrl:P,title:_,description:t,isFeatured:G,videoType:s})}},fs=s=>{if(s===0)return"0 Bytes";const n=1024,B=["Bytes","KB","MB","GB"],Ie=Math.floor(Math.log(s)/Math.log(n));return parseFloat((s/Math.pow(n,Ie)).toFixed(2))+" "+B[Ie]};return console.log("ðŸ” MULTIMEDIA MANAGER - Renderizando con:",{parkId:r,images:ge.length,documents:je.length,imagesLoading:Ue,documentsLoading:$e,imagesError:ps,documentsError:gs}),e.jsx("div",{className:"space-y-6",children:e.jsxs(os,{defaultValue:"images",className:"w-full",children:[e.jsxs(cs,{className:"grid w-full grid-cols-3",children:[e.jsxs(J,{value:"images",className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"ImÃ¡genes (",ge.length,")"]}),e.jsxs(J,{value:"documents",className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),"Documentos (",je.length,")"]}),e.jsxs(J,{value:"videos",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Videos (",Ee.length,")"]})]}),e.jsxs(H,{value:"images",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"GalerÃ­a de ImÃ¡genes"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(te,{open:y,onOpenChange:j,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(c,{className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Agregar Imagen"]})}),e.jsxs(ne,{className:"max-w-md",children:[e.jsx(le,{children:e.jsx(oe,{children:"Agregar Nueva Imagen"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Subir archivo"}),e.jsx(h,{type:"file",accept:"image/*",onChange:s=>{var B;const n=(B=s.target.files)==null?void 0:B[0];n&&(E(n),g(""))}})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:"- O -"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"URL de imagen"}),e.jsx(h,{value:f,onChange:s=>{g(s.target.value),s.target.value&&E(null)},placeholder:"https://ejemplo.com/imagen.jpg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"DescripciÃ³n"}),e.jsx(me,{value:x,onChange:s=>F(s.target.value),placeholder:"DescripciÃ³n de la imagen...",rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",checked:C,onChange:s=>U(s.target.checked)}),e.jsx("label",{htmlFor:"isPrimary",className:"text-sm",children:"Establecer como imagen principal"})]})]}),e.jsx(ue,{children:e.jsx(c,{onClick:vs,disabled:!z&&!f||ve.isPending,children:ve.isPending?"Subiendo...":"Agregar Imagen"})})]})]})})]}),Ue?e.jsx("div",{className:"text-center py-8",children:"Cargando imÃ¡genes..."}):ge.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay imÃ¡genes para este parque"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ge.map(s=>e.jsxs(S,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.imageUrl,alt:s.caption,className:"w-full h-48 object-cover"}),s.isPrimary&&e.jsxs(q,{className:"absolute top-2 left-2 bg-yellow-500",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"Principal"]})]}),e.jsxs(A,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.caption}),e.jsxs("div",{className:"flex gap-2",children:[!s.isPrimary&&e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Ve.mutate(s.id),disabled:Ve.isPending,children:e.jsx(fe,{className:"h-3 w-3"})}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>window.open(s.imageUrl,"_blank"),children:e.jsx(Me,{className:"h-3 w-3"})}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>Le.mutate(s.id),disabled:Le.isPending,children:e.jsx(ce,{className:"h-3 w-3"})})]})]})]},s.id))})]}),e.jsxs(H,{value:"documents",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Documentos del Parque"}),e.jsxs(te,{open:b,onOpenChange:D,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Agregar Documento"]})}),e.jsxs(ne,{className:"max-w-md",children:[e.jsx(le,{children:e.jsx(oe,{children:"Agregar Nuevo Documento"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"TÃ­tulo"}),e.jsx(h,{value:pe,onChange:s=>Ae(s.target.value),placeholder:"TÃ­tulo del documento"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Archivo del Documento *"}),e.jsx(h,{type:"file",accept:".pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx",onChange:s=>{var B;const n=(B=s.target.files)==null?void 0:B[0];V(n||null)},required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Formatos permitidos: PDF, DOC, DOCX, TXT, XLS, XLSX, PPT, PPTX (mÃ¡x. 10MB)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"URL de Referencia (opcional)"}),e.jsx(h,{value:i,onChange:s=>m(s.target.value),placeholder:"https://ejemplo.com/documento-original.pdf"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"URL opcional para referenciar el documento original o fuente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"CategorÃ­a"}),e.jsxs("select",{value:Pe,onChange:s=>Fe(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"reglamento",children:"Reglamento"}),e.jsx("option",{value:"mantenimiento",children:"Mantenimiento"}),e.jsx("option",{value:"eventos",children:"Eventos"}),e.jsx("option",{value:"legal",children:"Legal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"DescripciÃ³n"}),e.jsx(me,{value:De,onChange:s=>Te(s.target.value),placeholder:"DescripciÃ³n del documento...",rows:3})]})]}),e.jsx(ue,{children:e.jsx(c,{onClick:Ns,disabled:!k||!pe.trim()||Ce.isPending,children:Ce.isPending?"Subiendo...":"Agregar Documento"})})]})]})]}),$e?e.jsx("div",{className:"text-center py-8",children:"Cargando documentos..."}):je.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay documentos para este parque"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:je.map(s=>e.jsx(S,{children:e.jsxs(A,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.category})]})]}),e.jsx(q,{variant:"outline",children:fs(s.fileSize)})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>window.open(s.fileUrl,"_blank"),children:[e.jsx(ws,{className:"h-3 w-3 mr-1"}),"Ver"]}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>Re.mutate(s.id),disabled:Re.isPending,children:e.jsx(ce,{className:"h-3 w-3"})})]})]})},s.id))})]}),e.jsxs(H,{value:"videos",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"GalerÃ­a de Videos"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(te,{open:w,onOpenChange:$,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(c,{className:"bg-purple-600 hover:bg-purple-700 text-white flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Agregar Video"]})}),e.jsxs(ne,{className:"max-w-md",children:[e.jsx(le,{children:e.jsx(oe,{children:"Agregar Nuevo Video"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Tipo de subida"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{type:"button",variant:a==="file"?"default":"outline",onClick:()=>v("file"),className:"flex-1",children:[e.jsx(Es,{className:"h-4 w-4 mr-2"}),"Archivo"]}),e.jsxs(c,{type:"button",variant:a==="url"?"default":"outline",onClick:()=>v("url"),className:"flex-1",children:[e.jsx(Ts,{className:"h-4 w-4 mr-2"}),"URL"]})]})]}),a==="file"?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Archivo de Video"}),e.jsx(h,{type:"file",accept:"video/*",onChange:s=>{var n;return T(((n=s.target.files)==null?void 0:n[0])||null)}})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"URL del Video"}),e.jsx(h,{placeholder:"https://youtube.com/watch?v=... o https://vimeo.com/...",value:P,onChange:s=>ee(s.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Soporta YouTube, Vimeo y otras URLs de video"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"TÃ­tulo *"}),e.jsx(h,{placeholder:"TÃ­tulo del video",value:_,onChange:s=>se(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"DescripciÃ³n"}),e.jsx(me,{placeholder:"DescripciÃ³n del video (opcional)",value:t,onChange:s=>u(s.target.value),rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"videoFeatured",checked:G,onChange:s=>de(s.target.checked),className:"h-4 w-4"}),e.jsx("label",{htmlFor:"videoFeatured",className:"text-sm font-medium",children:"Video destacado"})]})]}),e.jsxs(ue,{children:[e.jsx(c,{variant:"outline",onClick:()=>$(!1),children:"Cancelar"}),e.jsx(c,{onClick:ys,disabled:Ne.isPending,className:"bg-purple-600 hover:bg-purple-700",children:Ne.isPending?"Subiendo...":"Agregar Video"})]})]})]})})]}),js?e.jsx("div",{className:"text-center py-8",children:"Cargando videos..."}):ze?e.jsxs("div",{className:"text-red-500 text-center py-8",children:["Error al cargar videos: ",ze.message]}):Ee.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay videos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Comienza agregando el primer video al parque."}),e.jsxs(c,{onClick:()=>$(!0),className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Agregar Video"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Ee.map(s=>e.jsx(S,{className:"overflow-hidden",children:e.jsxs(A,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:s.videoType==="youtube"?e.jsx(Ps,{className:"h-4 w-4 text-purple-600"}):s.videoType==="vimeo"?e.jsx(ye,{className:"h-4 w-4 text-purple-600"}):e.jsx(ye,{className:"h-4 w-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.videoType==="youtube"?"YouTube":s.videoType==="vimeo"?"Vimeo":s.videoType==="file"?"Archivo":"Externo"})]})]}),s.isFeatured&&e.jsxs(q,{variant:"default",className:"bg-purple-100 text-purple-800",children:[e.jsx(fe,{className:"h-3 w-3 mr-1 fill-current"}),"Destacado"]})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>window.open(s.videoUrl,"_blank"),children:[e.jsx(Me,{className:"h-3 w-3 mr-1"}),"Ver"]}),!s.isFeatured&&e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Qe.mutate(s.id),disabled:Qe.isPending,className:"border-purple-200 text-purple-600 hover:bg-purple-50",children:e.jsx(fe,{className:"h-3 w-3"})}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>Oe.mutate(s.id),disabled:Oe.isPending,children:e.jsx(ce,{className:"h-3 w-3"})})]})]})},s.id))})]})]})})}const Us={activo:"Activo",inactivo:"Inactivo",mantenimiento:"En Mantenimiento"};function $s({parkId:r}){const{toast:l}=be(),o=we(),[y,j]=d.useState(!1),[b,D]=d.useState(null),[w,$]=d.useState(null),[z,E]=d.useState(""),[f,g]=d.useState(""),[x,F]=d.useState(""),{data:C=[],isLoading:U,error:k}=X({queryKey:[`/api/parks/${r}/amenities`],queryFn:async()=>{console.log("ðŸ” FRONTEND: Cargando amenidades para parque",r);const t=await fetch(`/api/parks/${r}/amenities`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!t.ok)throw new Error("Error cargando amenidades");const u=await t.json();return console.log("âœ… FRONTEND: Amenidades cargadas:",u),u},enabled:!!r}),{data:V=[],isLoading:i}=X({queryKey:["/api/amenities"],queryFn:async()=>{console.log("ðŸ” FRONTEND: Cargando amenidades disponibles...");const t=await fetch("/api/amenities",{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!t.ok)throw new Error("Error cargando amenidades disponibles");const u=await t.json();return console.log("âœ… FRONTEND: Amenidades disponibles cargadas:",u),u}}),m=N({mutationFn:async t=>{const u=await fetch(`/api/parks/${r}/amenities`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:JSON.stringify(t)});if(!u.ok)throw new Error("Error agregando amenidad");return u.json()},onSuccess:()=>{o.invalidateQueries({queryKey:[`/api/parks/${r}/amenities`]}),l({title:"Amenidad agregada",description:"La amenidad se agregÃ³ correctamente al parque"}),$(null),E(""),g(""),F("")},onError:t=>{l({title:"Error",description:"No se pudo agregar la amenidad",variant:"destructive"})}}),p=N({mutationFn:async({parkAmenityId:t,data:u})=>{const G=await fetch(`/api/park-amenities/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:JSON.stringify(u)});if(!G.ok)throw new Error("Error actualizando amenidad");return G.json()},onSuccess:()=>{o.invalidateQueries({queryKey:[`/api/parks/${r}/amenities`]}),j(!1),D(null),l({title:"Amenidad actualizada",description:"La amenidad se actualizÃ³ correctamente"})}}),T=N({mutationFn:async t=>{if(!(await fetch(`/api/parks/${r}/amenities/${t}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}})).ok)throw new Error("Error eliminando amenidad")},onSuccess:()=>{o.invalidateQueries({queryKey:[`/api/parks/${r}/amenities`]}),l({title:"Amenidad eliminada",description:"La amenidad se eliminÃ³ correctamente del parque"})}}),P=t=>{D(t),E(t.moduleName||""),g(t.surfaceArea||""),F(t.description||""),j(!0)},ee=()=>{if(!b)return;const t={moduleName:z||null,surfaceArea:f||null,description:x||null};p.mutate({parkAmenityId:b.id,data:t})},_=t=>{confirm("Â¿EstÃ¡s seguro de que deseas eliminar esta amenidad del parque?")&&T.mutate(t)},se=t=>{const u={amenityId:t,moduleName:"",surfaceArea:null,description:null};m.mutate(u)};return console.log("ðŸ” AMENITIES MANAGER - Renderizando con:",{parkId:r,amenitiesCount:C.length,amenitiesLoading:U,amenitiesError:(k==null?void 0:k.message)||null,availableCount:V.length}),U?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando amenidades..."})]}):k?e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-red-600",children:["Error cargando amenidades: ",k.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"GestiÃ³n de Amenidades del Parque"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona amenidades de la lista disponible para agregarlas al parque"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsxs(K,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"Amenidades Disponibles"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Haz clic en una amenidad para agregarla al parque"})]}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:[V.filter(t=>!C.some(u=>u.amenityId===t.id)).map(t=>e.jsxs("div",{onClick:()=>se(t.id),className:"flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 hover:border-blue-200 cursor-pointer transition-colors",children:[e.jsx(qe,{name:t.name,iconType:t.icon==="custom"?"custom":"system",customIconUrl:t.icon==="custom"?`/uploads/amenity-icon-${t.id}.png`:void 0,size:32}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click para agregar"})]}),e.jsx(Y,{className:"h-4 w-4 text-gray-400"})]},t.id)),V.filter(t=>!C.some(u=>u.amenityId===t.id)).length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Xe,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"Todas las amenidades disponibles ya estÃ¡n asignadas"})]})]})})]}),e.jsxs(S,{children:[e.jsxs(K,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Amenidades del Parque (",C.length,")"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Amenidades actualmente asignadas a este parque"})]}),e.jsx(A,{children:e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"No hay amenidades asignadas"}),e.jsx("p",{className:"text-xs mt-1",children:"Agrega amenidades desde la lista de la izquierda"})]}):C.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-green-50 border-green-200",children:[e.jsx(qe,{name:t.amenityName,iconType:t.amenityIcon==="custom"?"custom":"system",customIconUrl:t.customIconUrl,size:32}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:t.amenityName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{variant:"outline",className:"text-xs",children:Us[t.status]||t.status}),t.moduleName&&e.jsxs("span",{className:"text-xs text-gray-500",children:["ðŸ“ ",t.moduleName]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>P(t),children:e.jsx(ds,{className:"h-3 w-3"})}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>_(t.id),disabled:T.isPending,children:e.jsx(ce,{className:"h-3 w-3"})})]})]},t.id))})})]})]}),e.jsx(te,{open:y,onOpenChange:j,children:e.jsxs(ne,{className:"max-w-md",children:[e.jsx(le,{children:e.jsx(oe,{children:"Editar Amenidad"})}),b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(qe,{name:b.amenityName,iconType:b.amenityIcon==="custom"?"custom":"system",customIconUrl:b.customIconUrl,size:32}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:b.amenityName}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:"General"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"MÃ³dulo/UbicaciÃ³n"}),e.jsx(h,{value:z,onChange:t=>E(t.target.value),placeholder:"Ej: Zona Norte, Entrada Principal..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Superficie (mÂ²)"}),e.jsx(h,{value:f,onChange:t=>g(t.target.value),placeholder:"Ej: 150.5",type:"number",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"DescripciÃ³n"}),e.jsx(h,{value:x,onChange:t=>F(t.target.value),placeholder:"DescripciÃ³n adicional..."})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{onClick:ee,disabled:p.isPending,className:"flex-1",children:p.isPending?"Actualizando...":"Actualizar"}),e.jsx(c,{variant:"outline",onClick:()=>j(!1),className:"flex-1",children:"Cancelar"})]})]})]})})]})}const ns=Z.object({speciesId:Z.number().min(1,"Debe seleccionar una especie"),recommendedQuantity:Z.number().min(1,"Cantidad debe ser mayor a 0").optional(),currentQuantity:Z.number().min(0,"Cantidad actual no puede ser negativa").default(0),plantingZone:Z.string().optional(),notes:Z.string().optional(),status:Z.string().default("planificado")});function zs({parkId:r}){var de;const[l,o]=d.useState(""),[y,j]=d.useState(null),[b,D]=d.useState(!1),[w,$]=d.useState(null),[z,E]=d.useState(!1),{toast:f}=be(),g=we(),{data:x,isLoading:F,error:C}=X({queryKey:[`/api/parks/${r}/tree-species`],queryFn:async()=>{const a=await fetch(`/api/parks/${r}/tree-species`);if(!a.ok)throw new Error("Error al cargar especies asignadas");return a.json()}}),{data:U,isLoading:k}=X({queryKey:["/api/tree-species",l],queryFn:async()=>{const a=new URLSearchParams({page:"1",limit:"50",...l&&{search:l}}),v=await fetch(`/api/tree-species?${a}`);if(!v.ok)throw new Error("Error al cargar especies disponibles");return v.json()}}),V=(x==null?void 0:x.map(a=>a.speciesId))||[],i=((de=U==null?void 0:U.data)==null?void 0:de.filter(a=>!V.includes(a.id)))||[],m=Be({resolver:es(ns),defaultValues:{currentQuantity:0,status:"planificado"}}),p=Be({resolver:es(ns)}),T=N({mutationFn:async a=>W(`/api/parks/${r}/tree-species`,{method:"POST",data:a}),onSuccess:()=>{g.invalidateQueries({queryKey:[`/api/parks/${r}/tree-species`]}),g.invalidateQueries({queryKey:["/api/tree-species"]}),D(!1),j(null),m.reset(),f({title:"Ã‰xito",description:"Especie asignada al parque correctamente"})},onError:a=>{f({title:"Error",description:a.message||"Error al asignar la especie",variant:"destructive"})}}),P=N({mutationFn:async a=>W(`/api/park-tree-species/${w==null?void 0:w.id}`,{method:"PUT",data:a}),onSuccess:()=>{g.invalidateQueries({queryKey:[`/api/parks/${r}/tree-species`]}),E(!1),$(null),p.reset(),f({title:"Ã‰xito",description:"AsignaciÃ³n actualizada correctamente"})},onError:a=>{f({title:"Error",description:a.message||"Error al actualizar la asignaciÃ³n",variant:"destructive"})}}),ee=N({mutationFn:async a=>W(`/api/park-tree-species/${a}`,{method:"DELETE"}),onSuccess:()=>{g.invalidateQueries({queryKey:[`/api/parks/${r}/tree-species`]}),g.invalidateQueries({queryKey:["/api/tree-species"]}),f({title:"Ã‰xito",description:"Especie removida del parque correctamente"})},onError:a=>{f({title:"Error",description:a.message||"Error al remover la especie",variant:"destructive"})}}),_=a=>{j(a),m.setValue("speciesId",a.id),D(!0)},se=a=>{$(a),p.reset({speciesId:a.speciesId,recommendedQuantity:a.recommendedQuantity||void 0,currentQuantity:a.currentQuantity,plantingZone:a.plantingZone||"",notes:a.notes||"",status:a.status}),E(!0)},t=a=>{confirm("Â¿EstÃ¡ seguro de que desea remover esta especie del parque?")&&ee.mutate(a)},u=a=>{switch(a){case"planificado":return"bg-yellow-100 text-yellow-800";case"en_desarrollo":return"bg-blue-100 text-blue-800";case"establecido":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},G=a=>{switch(a){case"planificado":return"Planificado";case"en_desarrollo":return"En Desarrollo";case"establecido":return"Establecido";default:return a}};return F||k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):C?e.jsxs("div",{className:"text-center py-8 text-red-600",children:[e.jsx(Cs,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Error al cargar las especies del parque"})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[600px]",children:[e.jsxs(S,{className:"flex flex-col",children:[e.jsxs(K,{children:[e.jsxs(M,{className:"flex items-center gap-2 text-green-700",children:[e.jsx(ks,{className:"h-5 w-5"}),"Especies Disponibles (",i.length,")"]}),e.jsx(re,{children:"Especies arbÃ³reas que pueden ser asignadas a este parque"}),e.jsxs("div",{className:"relative",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(h,{placeholder:"Buscar especies...",value:l,onChange:a=>o(a.target.value),className:"pl-10"})]})]}),e.jsx(A,{className:"flex-1 p-0",children:e.jsx(_e,{className:"h-full px-6 pb-6",children:e.jsxs("div",{className:"space-y-2",children:[i.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>_(a),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(is,{iconType:a.iconType,customIconUrl:a.customIconUrl,size:32}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium truncate",children:a.commonName}),e.jsx("p",{className:"text-sm text-gray-600 italic truncate",children:a.scientificName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{variant:"outline",className:"text-xs",children:a.family}),e.jsx(q,{variant:a.origin==="Nativo"?"default":"secondary",className:"text-xs",children:a.origin}),a.isEndangered&&e.jsx(q,{variant:"destructive",className:"text-xs",children:"Amenazada"})]})]})]}),e.jsxs(c,{variant:"outline",size:"sm",className:"shrink-0",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Asignar"]})]},a.id)),i.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(he,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No hay especies disponibles"}),l&&e.jsx("p",{className:"text-sm",children:"Intenta con otros tÃ©rminos de bÃºsqueda"})]})]})})})]}),e.jsxs(S,{className:"flex flex-col",children:[e.jsxs(K,{children:[e.jsxs(M,{className:"flex items-center gap-2 text-green-700",children:[e.jsx(he,{className:"h-5 w-5"}),"Especies del Parque (",(x==null?void 0:x.length)||0,")"]}),e.jsx(re,{children:"Especies arbÃ³reas asignadas a este parque"})]}),e.jsx(A,{className:"flex-1 p-0",children:e.jsx(_e,{className:"h-full px-6 pb-6",children:e.jsxs("div",{className:"space-y-2",children:[x==null?void 0:x.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-green-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(is,{iconType:a.iconType,customIconUrl:a.customIconUrl,size:32}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium truncate",children:a.commonName}),e.jsx("p",{className:"text-sm text-gray-600 italic truncate",children:a.scientificName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{className:u(a.status),children:G(a.status)}),a.currentQuantity>0&&e.jsxs(q,{variant:"outline",className:"text-xs",children:[a.currentQuantity," plantados"]}),a.recommendedQuantity&&e.jsxs(q,{variant:"secondary",className:"text-xs",children:["Meta: ",a.recommendedQuantity]}),a.isEndangered&&e.jsx(q,{variant:"destructive",className:"text-xs",children:"Amenazada"})]}),a.plantingZone&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Zona: ",a.plantingZone]})]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>se(a),children:e.jsx(ds,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>t(a.id),className:"text-red-600 hover:text-red-700",children:e.jsx(ce,{className:"h-4 w-4"})})]})]},a.id)),(!x||x.length===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(he,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No hay especies asignadas a este parque"}),e.jsx("p",{className:"text-sm",children:"Selecciona especies de la columna izquierda"})]})]})})})]}),e.jsx(te,{open:b,onOpenChange:D,children:e.jsxs(ne,{className:"sm:max-w-[500px]",children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Asignar Especie al Parque"}),e.jsxs(Ge,{children:["Configura los detalles de la asignaciÃ³n de ",y==null?void 0:y.commonName]})]}),e.jsx(Ze,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(a=>T.mutate(a)),className:"space-y-4",children:[e.jsx(L,{control:m.control,name:"recommendedQuantity",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Cantidad Recomendada"}),e.jsx(O,{children:e.jsx(h,{type:"number",placeholder:"Cantidad objetivo a plantar",...a,value:a.value||"",onChange:v=>a.onChange(v.target.value?parseInt(v.target.value):void 0)})}),e.jsx(I,{})]})}),e.jsx(L,{control:m.control,name:"currentQuantity",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Cantidad Actual Plantada"}),e.jsx(O,{children:e.jsx(h,{type:"number",...a,onChange:v=>a.onChange(parseInt(v.target.value)||0)})}),e.jsx(I,{})]})}),e.jsx(L,{control:m.control,name:"plantingZone",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Zona de PlantaciÃ³n (Opcional)"}),e.jsx(O,{children:e.jsx(h,{placeholder:"Ej. Ãrea norte, Sendero principal...",...a})}),e.jsx(I,{})]})}),e.jsx(L,{control:m.control,name:"status",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Estado"}),e.jsxs(Je,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(O,{children:e.jsx(He,{children:e.jsx(Ye,{placeholder:"Selecciona el estado"})})}),e.jsxs(We,{children:[e.jsx(ae,{value:"planificado",children:"Planificado"}),e.jsx(ae,{value:"en_desarrollo",children:"En Desarrollo"}),e.jsx(ae,{value:"establecido",children:"Establecido"})]})]}),e.jsx(I,{})]})}),e.jsx(L,{control:m.control,name:"notes",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Notas (Opcional)"}),e.jsx(O,{children:e.jsx(me,{placeholder:"Observaciones sobre la plantaciÃ³n...",...a})}),e.jsx(I,{})]})}),e.jsxs(ue,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>D(!1),children:"Cancelar"}),e.jsx(c,{type:"submit",disabled:T.isPending,className:"bg-green-600 hover:bg-green-700",children:T.isPending?"Asignando...":"Asignar Especie"})]})]})})]})}),e.jsx(te,{open:z,onOpenChange:E,children:e.jsxs(ne,{className:"sm:max-w-[500px]",children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Editar AsignaciÃ³n de Especie"}),e.jsxs(Ge,{children:["Modifica los detalles de la asignaciÃ³n de ",w==null?void 0:w.commonName]})]}),e.jsx(Ze,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(a=>P.mutate(a)),className:"space-y-4",children:[e.jsx(L,{control:p.control,name:"recommendedQuantity",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Cantidad Recomendada"}),e.jsx(O,{children:e.jsx(h,{type:"number",placeholder:"Cantidad objetivo a plantar",...a,value:a.value||"",onChange:v=>a.onChange(v.target.value?parseInt(v.target.value):void 0)})}),e.jsx(I,{})]})}),e.jsx(L,{control:p.control,name:"currentQuantity",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Cantidad Actual Plantada"}),e.jsx(O,{children:e.jsx(h,{type:"number",...a,onChange:v=>a.onChange(parseInt(v.target.value)||0)})}),e.jsx(I,{})]})}),e.jsx(L,{control:p.control,name:"plantingZone",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Zona de PlantaciÃ³n"}),e.jsx(O,{children:e.jsx(h,{placeholder:"Ej. Ãrea norte, Sendero principal...",...a})}),e.jsx(I,{})]})}),e.jsx(L,{control:p.control,name:"status",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Estado"}),e.jsxs(Je,{onValueChange:a.onChange,value:a.value,children:[e.jsx(O,{children:e.jsx(He,{children:e.jsx(Ye,{placeholder:"Selecciona el estado"})})}),e.jsxs(We,{children:[e.jsx(ae,{value:"planificado",children:"Planificado"}),e.jsx(ae,{value:"en_desarrollo",children:"En Desarrollo"}),e.jsx(ae,{value:"establecido",children:"Establecido"})]})]}),e.jsx(I,{})]})}),e.jsx(L,{control:p.control,name:"notes",render:({field:a})=>e.jsxs(R,{children:[e.jsx(Q,{children:"Notas"}),e.jsx(O,{children:e.jsx(me,{placeholder:"Observaciones sobre la plantaciÃ³n...",...a})}),e.jsx(I,{})]})}),e.jsxs(ue,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(c,{type:"submit",disabled:P.isPending,className:"bg-green-600 hover:bg-green-700",children:P.isPending?"Guardando...":"Guardar Cambios"})]})]})})]})})]})}const ls={active:"Activo",inactive:"Inactivo",pending:"Pendiente",suspended:"Suspendido"};function Vs({parkId:r}){const{toast:l}=be(),o=we(),[y,j]=d.useState(""),[b,D]=d.useState("all"),{data:w=[],isLoading:$}=X({queryKey:[`/api/parks/${r}/volunteers`],queryFn:async()=>{console.log("ðŸ” FRONTEND: Cargando voluntarios asignados para parque",r);const i=await fetch(`/api/parks/${r}/volunteers`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!i.ok)throw new Error("Error cargando voluntarios asignados");const m=await i.json();return console.log("âœ… FRONTEND: Voluntarios asignados cargados:",m),m},enabled:!!r}),{data:z=[]}=X({queryKey:["/api/volunteers"],queryFn:async()=>{const i=await fetch("/api/volunteers",{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!i.ok)throw new Error("Error cargando voluntarios disponibles");return i.json()}}),E=w.map(i=>i.id),g=z.filter(i=>!E.includes(i.id)&&i.status==="active").filter(i=>{var T;const m=y===""||i.fullName.toLowerCase().includes(y.toLowerCase())||i.email.toLowerCase().includes(y.toLowerCase())||((T=i.skills)==null?void 0:T.toLowerCase().includes(y.toLowerCase())),p=b==="all"||i.status===b;return m&&p}),x=N({mutationFn:async i=>{const m=await fetch(`/api/parks/${r}/volunteers`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:JSON.stringify({volunteerId:i})});if(!m.ok)throw new Error("Error asignando voluntario");return m.json()},onSuccess:()=>{o.invalidateQueries({queryKey:[`/api/parks/${r}/volunteers`]}),o.invalidateQueries({queryKey:["/api/volunteers"]}),l({title:"Voluntario asignado",description:"El voluntario ha sido asignado correctamente al parque"})},onError:i=>{l({title:"Error",description:"Error al asignar voluntario al parque",variant:"destructive"})}}),F=N({mutationFn:async i=>{const m=await fetch(`/api/parks/${r}/volunteers/${i}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!m.ok)throw new Error("Error removiendo voluntario");return m.json()},onSuccess:()=>{o.invalidateQueries({queryKey:[`/api/parks/${r}/volunteers`]}),o.invalidateQueries({queryKey:["/api/volunteers"]}),l({title:"Voluntario removido",description:"El voluntario ha sido removido correctamente del parque"})},onError:i=>{l({title:"Error",description:"Error al remover voluntario del parque",variant:"destructive"})}}),C=i=>{x.mutate(i)},U=i=>{F.mutate(i)},k=i=>({active:"default",inactive:"secondary",pending:"outline",suspended:"destructive"})[i]||"secondary",V=i=>new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsxs(K,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Voluntarios Disponibles (",g.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(h,{placeholder:"Buscar voluntarios...",value:y,onChange:i=>j(i.target.value),className:"pl-10"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{j(""),D("all")},children:[e.jsx(qs,{className:"h-4 w-4 mr-1"}),"Limpiar"]})]})]}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:[g.map(i=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:i.fullName}),e.jsx(q,{variant:k(i.status),children:ls[i.status]||i.status})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:i.phone})]}),i.skills&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Habilidades:"}),e.jsx("span",{className:"text-gray-600",children:i.skills})]}),i.age&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:[i.age," aÃ±os"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Registrado:"}),e.jsx("span",{className:"text-gray-600",children:V(i.createdAt)})]})]})]}),e.jsxs(c,{size:"sm",onClick:()=>C(i.id),disabled:x.isPending,children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Asignar"]})]})},i.id)),g.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay voluntarios disponibles"}),e.jsx("p",{className:"text-sm",children:"Todos los voluntarios activos ya estÃ¡n asignados a parques."})]})]})})]}),e.jsxs(S,{children:[e.jsx(K,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Voluntarios Asignados (",w.length,")"]})}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:[w.map(i=>e.jsx("div",{className:"border rounded-lg p-4 bg-green-50 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:i.fullName}),e.jsx(q,{variant:k(i.status),children:ls[i.status]||i.status})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:i.phone})]}),i.skills&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Habilidades:"}),e.jsx("span",{className:"text-gray-600",children:i.skills})]}),i.interestAreas&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Intereses:"}),e.jsx("span",{className:"text-gray-600",children:i.interestAreas})]})]})]}),e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>U(i.id),disabled:F.isPending,children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Remover"]})]})},i.id)),w.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay voluntarios asignados"}),e.jsx("p",{className:"text-sm",children:"Selecciona voluntarios de la columna izquierda para asignarlos a este parque."})]})]})})]})]})}function Ms(){const{id:r}=As(),{data:l,isLoading:o,error:y}=X({queryKey:[`/api/parks/${r}`],queryFn:async()=>{const j=await fetch(`/api/parks/${r}`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!j.ok)throw new Error("Error cargando parque");return j.json()},enabled:!!r});return o?e.jsx(Se,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando parque..."})]})})}):y||!l?e.jsx(Se,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600",children:"Error cargando el parque"}),e.jsx(rs,{href:"/admin/parks",children:e.jsx(c,{className:"mt-4",children:"Volver a parques"})})]})})}):e.jsx(Se,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(rs,{href:"/admin/parks",children:e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:l.name}),e.jsxs("div",{className:"flex items-center text-gray-600 mt-1",children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:l.address})]})]})]})}),e.jsxs(os,{defaultValue:"multimedia",className:"space-y-4",children:[e.jsxs(cs,{className:"grid w-full grid-cols-4",children:[e.jsxs(J,{value:"multimedia",className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4"}),"Multimedia"]}),e.jsxs(J,{value:"amenidades",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Amenidades"]}),e.jsxs(J,{value:"arboles",className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Ãrboles"]}),e.jsxs(J,{value:"voluntarios",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Voluntarios"]})]}),e.jsx(H,{value:"multimedia",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(K,{children:[e.jsxs(M,{className:"text-2xl text-blue-600 flex items-center gap-2",children:[e.jsx(ts,{className:"h-6 w-6"}),"GestiÃ³n de Multimedia del Parque"]}),e.jsx(re,{children:"Administra imÃ¡genes y documentos del parque. Puedes subir archivos o usar URLs externas."})]}),e.jsx(A,{children:e.jsx(Fs,{parkId:parseInt(r||"0")})})]})}),e.jsx(H,{value:"amenidades",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(K,{children:[e.jsxs(M,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(xe,{className:"h-6 w-6"}),"GestiÃ³n de Amenidades del Parque"]}),e.jsx(re,{children:"Administra las amenidades y servicios disponibles en el parque. Puedes agregar nuevas amenidades o editar las existentes."})]}),e.jsx(A,{children:e.jsx($s,{parkId:parseInt(r)})})]})}),e.jsx(H,{value:"arboles",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(K,{children:[e.jsxs(M,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(he,{className:"h-6 w-6"}),"GestiÃ³n de Especies ArbÃ³reas del Parque"]}),e.jsx(re,{children:"Administra las especies arbÃ³reas asignadas al parque. Puedes seleccionar especies del catÃ¡logo y configurar detalles de plantaciÃ³n."})]}),e.jsx(A,{children:e.jsx(zs,{parkId:parseInt(r)})})]})}),e.jsx(H,{value:"voluntarios",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(K,{children:[e.jsxs(M,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(ie,{className:"h-6 w-6"}),"GestiÃ³n de Voluntarios del Parque"]}),e.jsx(re,{children:"Administra los voluntarios asignados al parque. Selecciona voluntarios disponibles de la columna izquierda para asignarlos a este parque."})]}),e.jsx(A,{children:e.jsx(Vs,{parkId:parseInt(r)})})]})})]})]})})}export{Ms as default};
