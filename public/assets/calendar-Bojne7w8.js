import{aH as ee,a4 as v,u as C,R as F,aU as se,aV as ae,j as e,bh as re,f as T,n as P,B as n,aX as te,v as l,aY as le,cB as ie,cC as ne,cD as ce,cE as de,g as z,h as O,X as oe,ad as K,i as B,W as D,Y as w,_ as M,$ as k,a0 as c,q as I,y as me,I as xe,J as he,K as ue,N as ge,M as je,as as pe,w as ye,p as ve,bE as Ne,a_ as be,c4 as R,a3 as j}from"./index-BKCBrrzQ.js";import{e as fe}from"./eachDayOfInterval-Cr2SSxG5.js";import{g as Ce}from"./getDay-ARZLhrUe.js";import{s as De}from"./subMonths-CWHOHbgb.js";const N=p=>{if(!p)return"bg-gray-100 text-gray-800 hover:bg-gray-200";switch(p){case"#e74c3c":return"bg-red-100 text-red-800 hover:bg-red-200";case"#2ecc71":return"bg-green-100 text-green-800 hover:bg-green-200";case"#9b59b6":return"bg-purple-100 text-purple-800 hover:bg-purple-200";case"#27ae60":return"bg-emerald-100 text-emerald-800 hover:bg-emerald-200";case"#3498db":return"bg-blue-100 text-blue-800 hover:bg-blue-200";case"#f39c12":return"bg-orange-100 text-orange-800 hover:bg-orange-200";case"#ffea00":return"bg-yellow-100 text-yellow-800 hover:bg-yellow-200";default:return"bg-gray-100 text-gray-800 hover:bg-gray-200"}};function Ae(){var L;const[,p]=ee(),[d,b]=v.useState(new Date),[o,q]=v.useState(void 0),[r,E]=v.useState(null),[G,m]=v.useState(!1),[t,y]=v.useState({category:"all",parkId:"all",instructorId:"all",isFree:"all"}),{data:A=[],isLoading:J}=C({queryKey:["/api/activities"],retry:1}),{data:x=[]}=C({queryKey:["/api/activity-categories"],retry:1}),{data:H=[]}=C({queryKey:["/api/parks"],retry:1}),{data:V=[]}=C({queryKey:["/api/instructors"],retry:1}),S=F.useMemo(()=>{const s={};return Array.isArray(x)&&x.forEach(a=>{s[a.name]=N(a.color)}),s},[x]),$=F.useMemo(()=>(Array.isArray(A)?A:[]).filter(a=>{const i=t.category==="all"||a.categoryName===t.category,h=t.parkId==="all"||a.parkId===parseInt(t.parkId),u=t.instructorId==="all"||a.instructorId===parseInt(t.instructorId),g=t.isFree==="all"||t.isFree==="free"&&(!a.price||a.price===0)||t.isFree==="paid"&&a.price&&a.price>0;return i&&h&&u&&g}),[A,t]),U=F.useMemo(()=>{const s=se(d),a=ae(d),i=fe({start:s,end:a}),h=Ce(s);return[...Array(h).fill(null),...i]},[d]),f=s=>{if(!s||!$)return[];const a=l(s,"yyyy-MM-dd");return $.filter(i=>(i.startDate?i.startDate.substring(0,10):null)===a)},X=()=>{b(De(d,1))},Y=()=>{b(be(d,1))},_=()=>{b(new Date),q(new Date)},Q=(s,a)=>{if(!s)return e.jsx("div",{className:"h-28 bg-gray-50 border border-gray-200"},`empty-${a}`);const i=l(s,"yyyy-MM-dd")===l(new Date,"yyyy-MM-dd"),h=o&&l(s,"yyyy-MM-dd")===l(o,"yyyy-MM-dd"),u=f(s);return e.jsxs("div",{className:R("h-28 min-h-[7rem] border border-gray-200 p-1 overflow-hidden",i?"bg-blue-50":"bg-white",h?"ring-2 ring-blue-400 ring-inset":""),onClick:()=>q(s),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:R("text-sm font-medium",i?"text-blue-600":""),children:l(s,"d")}),e.jsx("span",{className:"text-xs text-gray-500",children:l(s,"EEE",{locale:j})})]}),e.jsxs("div",{className:"mt-1 space-y-1 overflow-y-auto max-h-20",children:[u.slice(0,3).map(g=>e.jsx("div",{className:"text-xs truncate cursor-pointer",onClick:Z=>{Z.stopPropagation(),E(g),m(!0)},children:e.jsx(I,{className:S[g.categoryName||""]||N(),variant:"outline",children:g.title})},g.id)),u.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",u.length-3," más"]})]})]},l(s,"yyyy-MM-dd"))},W=()=>{y({category:"all",parkId:"all",instructorId:"all",isFree:"all"})};return e.jsx(re,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs(T,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Calendario de Actividades"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Consulta las actividades programadas en el calendario mensual."})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:X,children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-lg font-medium min-w-[200px] text-center",children:l(d,"MMMM yyyy",{locale:j})}),e.jsx(n,{variant:"outline",size:"sm",onClick:Y,children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:_,children:"Hoy"}),e.jsxs(ie,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Elegir mes"]})}),e.jsx(ce,{className:"w-auto p-0",align:"end",children:e.jsx(de,{mode:"single",selected:d,onSelect:s=>s&&b(s)})})]})]}),e.jsx(n,{onClick:()=>p("/admin/organizador/catalogo/crear"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Nueva Actividad"})]}),e.jsxs(T,{className:"mb-6",children:[e.jsxs(z,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{className:"text-lg",children:"Filtros"}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:W,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Limpiar filtros"]})]}),e.jsx(K,{children:"Filtra las actividades mostradas en el calendario"})]}),e.jsx(B,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Categoría"}),e.jsxs(D,{value:t.category,onValueChange:s=>y({...t,category:s}),children:[e.jsx(w,{children:e.jsx(M,{placeholder:"Todas las categorías"})}),e.jsxs(k,{children:[e.jsx(c,{value:"all",children:"Todas las categorías"}),x.map(s=>e.jsx(c,{value:s.name,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Parque"}),e.jsxs(D,{value:t.parkId,onValueChange:s=>y({...t,parkId:s}),children:[e.jsx(w,{children:e.jsx(M,{placeholder:"Todos los parques"})}),e.jsxs(k,{children:[e.jsx(c,{value:"all",children:"Todos los parques"}),Array.isArray(H)&&H.map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Instructor"}),e.jsxs(D,{value:t.instructorId,onValueChange:s=>y({...t,instructorId:s}),children:[e.jsx(w,{children:e.jsx(M,{placeholder:"Todos los instructores"})}),e.jsxs(k,{children:[e.jsx(c,{value:"all",children:"Todos los instructores"}),Array.isArray(V)&&V.map(s=>e.jsx(c,{value:s.id.toString(),children:s.fullName},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Precio"}),e.jsxs(D,{value:t.isFree,onValueChange:s=>y({...t,isFree:s}),children:[e.jsx(w,{children:e.jsx(M,{placeholder:"Todas las actividades"})}),e.jsxs(k,{children:[e.jsx(c,{value:"all",children:"Todas las actividades"}),e.jsx(c,{value:"free",children:"Gratuitas"}),e.jsx(c,{value:"paid",children:"De pago"})]})]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border shadow",children:[e.jsx("div",{className:"grid grid-cols-7 gap-0",children:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"].map(s=>e.jsx("div",{className:"py-2 text-center font-medium text-gray-600 border-b",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:J?e.jsx("div",{className:"col-span-7 py-12 text-center text-gray-500",children:"Cargando actividades..."}):U.map((s,a)=>Q(s,a))})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-2",children:[e.jsx("div",{className:"text-sm font-medium mr-2",children:"Categorías:"}),Array.isArray(x)&&x.map(s=>e.jsx(I,{className:N(s.color),variant:"outline",children:s.name},s.id))]}),e.jsx(me,{open:G,onOpenChange:m,children:e.jsx(xe,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:r?e.jsxs(e.Fragment,{children:[e.jsxs(he,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ue,{className:"text-2xl font-bold",children:r.title}),e.jsx(I,{className:S[r.categoryName||""]||N(),variant:"outline",children:r.categoryName})]}),e.jsxs(ge,{children:[e.jsxs("div",{className:"mt-2 flex items-center text-gray-500",children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"mr-3",children:r.startDate?l(new Date(r.startDate),"dd/MM/yyyy HH:mm",{locale:j}):"Fecha no disponible"}),r.location&&e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:r.location})]})]}),r.parkName&&e.jsxs("div",{className:"mt-1 text-gray-500",children:["Parque: ",r.parkName]})]})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Descripción"}),e.jsx("p",{className:"text-gray-700",children:r.description||"Sin descripción disponible"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[r.price!==void 0&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(pe,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Precio"}),e.jsx("p",{children:r.price>0?`$${r.price}`:"Gratuita"})]})]}),((L=r.instructor)==null?void 0:L.fullName)&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(ye,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Instructor"}),e.jsx("p",{children:r.instructor.fullName})]})]}),r.startDate&&r.endDate&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(ve,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Duración"}),e.jsxs("p",{children:[l(new Date(r.startDate),"HH:mm",{locale:j})," -",l(new Date(r.endDate),"HH:mm",{locale:j})]})]})]})]})]}),e.jsxs(Ne,{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>m(!1),children:"Cerrar"}),e.jsx(n,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{m(!1),p("/admin/activities")},children:"Ver todas las actividades"})]})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("p",{children:"No se encontraron detalles de la actividad"}),e.jsx(n,{variant:"outline",className:"mt-4",onClick:()=>m(!1),children:"Cerrar"})]})})}),o&&e.jsxs(T,{className:"mt-6",children:[e.jsxs(z,{children:[e.jsxs(O,{children:["Actividades para el ",l(o,"d MMMM yyyy",{locale:j})]}),e.jsxs(K,{children:[f(o).length," actividades programadas"]})]}),e.jsx(B,{children:f(o).length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No hay actividades programadas para este día"}):e.jsx("div",{className:"space-y-3",children:f(o).map(s=>{var a;return e.jsxs("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>{E(s),m(!0)},children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"font-medium",children:s.title}),e.jsx(I,{className:S[s.category||""]||N(),variant:"outline",children:s.category||"Sin categoría"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[(a=s.description)==null?void 0:a.substring(0,100),s.description&&s.description.length>100?"...":""]}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Parque:"})," ",s.parkName||`Parque #${s.parkId}`]}),s.instructor&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Instructor:"})," ",s.instructor.fullName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Precio:"})," ",s.price&&s.price>0?`$${s.price}`:"Gratuita"]})]})]},s.id)})})})]})]})})}export{Ae as default};
