import{ay as m,aH as z,l as I,a4 as n,aA as B,j as e,f as x,i as j,dg as p,g as N,bO as D,h as y,ad as g,cW as v,B as u,A as b,e as O,Q as P,V as C,dn as S,an as k,al as U,aB as R}from"./index-BKCBrrzQ.js";const H=m.object({newPassword:m.string().min(6,"La contraseña debe tener al menos 6 caracteres").regex(/[A-Z]/,"Debe contener al menos una mayúscula").regex(/[a-z]/,"Debe contener al menos una minúscula").regex(/[0-9]/,"Debe contener al menos un número"),confirmPassword:m.string()}).refine(r=>r.newPassword===r.confirmPassword,{message:"Las contraseñas no coinciden",path:["confirmPassword"]}),J=()=>{const[,r]=z(),{toast:c}=I(),[h,w]=n.useState(!1),[i,E]=n.useState(!1),[d,L]=n.useState(!1),[f,o]=n.useState(null),[T,A]=n.useState(""),a=B({resolver:R(H),defaultValues:{newPassword:"",confirmPassword:""}});n.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("token");s?(A(s),F(s)):o(!1)},[]);const F=async l=>{try{const t=await(await fetch(`/api/password/verify-token/${l}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json();t.valid?o(!0):(o(!1),c({title:"Token inválido",description:t.message||"El enlace de recuperación ha expirado o es inválido",variant:"destructive"}))}catch(s){console.error("Error verificando token:",s),o(!1),c({title:"Error de conexión",description:"No se pudo verificar el enlace de recuperación",variant:"destructive"})}},V=async l=>{try{w(!0);const t=await(await fetch("/api/password/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:T,newPassword:l.newPassword}),credentials:"include"})).json();if(t.success)c({title:"✅ Contraseña actualizada",description:t.message}),setTimeout(()=>{r("/admin/login")},2e3);else throw new Error(t.message||"Error al restablecer contraseña")}catch(s){console.error("Error restableciendo contraseña:",s),c({title:"Error",description:"No se pudo restablecer la contraseña. Inténtalo más tarde.",variant:"destructive"})}finally{w(!1)}};return f===null?e.jsx("div",{className:"h-screen w-screen fixed inset-0 flex items-center justify-center bg-gray-50 px-4",children:e.jsx(x,{className:"w-full max-w-md",children:e.jsx(j,{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verificando enlace..."})]})})})}):f===!1?e.jsx("div",{className:"h-screen w-screen fixed inset-0 flex items-center justify-center bg-gray-50 px-4",children:e.jsxs(x,{className:"w-full max-w-md",children:[e.jsxs(N,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx(D,{className:"h-12 w-12 text-red-500"})}),e.jsx(y,{className:"text-xl",children:"Enlace Inválido"}),e.jsx(g,{children:"El enlace de recuperación ha expirado o no es válido"})]}),e.jsx(v,{children:e.jsxs(u,{className:"w-full",onClick:()=>r("/admin/login"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Volver al Login"]})})]})}):e.jsx("div",{className:"h-screen w-screen fixed inset-0 flex items-center justify-center bg-gray-50 px-4",children:e.jsxs(x,{className:"w-full max-w-md",children:[e.jsxs(N,{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(O,{className:"h-10 w-10 text-primary"})}),e.jsx(y,{className:"text-xl text-center",children:"Nueva Contraseña"}),e.jsx(g,{className:"text-center",children:"Crea una contraseña segura para tu cuenta"})]}),e.jsxs("form",{onSubmit:a.handleSubmit(V),children:[e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"newPassword",children:"Nueva Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"newPassword",type:i?"text":"password",placeholder:"Ingresa tu nueva contraseña",...a.register("newPassword")}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:()=>E(!i),children:i?e.jsx(S,{className:"h-4 w-4"}):e.jsx(k,{className:"h-4 w-4"})})]}),a.formState.errors.newPassword&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.newPassword.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"confirmPassword",children:"Confirmar Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"confirmPassword",type:d?"text":"password",placeholder:"Confirma tu nueva contraseña",...a.register("confirmPassword")}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:()=>L(!d),children:d?e.jsx(S,{className:"h-4 w-4"}):e.jsx(k,{className:"h-4 w-4"})})]}),a.formState.errors.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.confirmPassword.message})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2 font-medium",children:"La contraseña debe contener:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Al menos 6 caracteres"}),e.jsx("li",{children:"• Una letra mayúscula"}),e.jsx("li",{children:"• Una letra minúscula"}),e.jsx("li",{children:"• Un número"})]})]})]}),e.jsxs(v,{className:"flex flex-col space-y-2",children:[e.jsx(u,{className:"w-full",type:"submit",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Actualizar Contraseña"]})}),e.jsxs(u,{type:"button",variant:"outline",className:"w-full",onClick:()=>r("/admin/login"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Cancelar"]})]})]})]})})};export{J as default};
