import{ap as O,aq as H,l as M,a4 as D,ar as B,j as e,f as n,g as y,h as w,ak as U,i as c,m as Q,q as T,as as A,ad as _,at as F,au as I,O as L,av as $,aw as G,B as p,ax as K,ay as N,az as V,aA as X,aB as Z,aC as W,aD as J,al as Y,v as ee,a3 as se,n as S,k as ae,u as re,L as R,A as q,x as te,H as ie,M as b,p as ne,U as le,w as ce,r as oe,P as de}from"./index-BKCBrrzQ.js";import{P as k}from"./PublicLayout-Cks6Enyp.js";function me({eventId:a,event:s,participantData:l,onSuccess:f,onError:m}){const i=O(),h=H(),{toast:r}=M(),[g,x]=D.useState(!1),[v,o]=D.useState(null),u=(s==null?void 0:s.price)||0,E=B({mutationFn:async d=>{const t=await fetch(`/api/events/${a}/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!t.ok){const j=await t.json();throw new Error(j.error||"Error al crear el pago")}return t.json()},onError:d=>{x(!1),o(d.message),m(d.message)}}),P=async d=>{if(d.preventDefault(),!i||!h){o("Stripe no está disponible");return}x(!0),o(null);const t=h.getElement(F);if(!t){o("Elemento de tarjeta no encontrado"),x(!1);return}if(u<=0){o("El monto debe ser mayor a $0"),x(!1);return}try{const j=await E.mutateAsync({customerData:{fullName:l.fullName,email:l.email,phone:l.phone},amount:u}),z=await i.confirmCardPayment(j.clientSecret,{payment_method:{card:t,billing_details:{name:l.fullName,email:l.email}}});z.error?(o(z.error.message||"Error en el pago"),x(!1)):(r({title:"Pago exitoso",description:"Tu pago ha sido procesado correctamente"}),f())}catch(j){o(j.message||"Error inesperado en el pago"),x(!1)}},C={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(n,{children:[e.jsx(y,{className:"pb-3",children:e.jsxs(w,{className:"text-lg flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Resumen del pago"]})}),e.jsxs(c,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Evento:"}),e.jsx("span",{className:"font-medium text-sm",children:s==null?void 0:s.title})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Participante:"}),e.jsx("span",{className:"font-medium text-sm",children:l.fullName})]}),e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs(T,{variant:"secondary",className:"text-lg px-3 py-1",children:["$",u.toFixed(2)," MXN"]})]})]})]}),e.jsxs(n,{children:[e.jsxs(y,{className:"pb-3",children:[e.jsxs(w,{className:"text-lg flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Información de pago"]}),e.jsx(_,{children:"Ingresa los datos de tu tarjeta para completar el pago"})]}),e.jsx(c,{children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Información de la tarjeta"}),e.jsx("div",{className:"p-3 border border-gray-300 rounded-md",children:e.jsx(F,{options:C})})]}),v&&e.jsxs(I,{variant:"destructive",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx($,{children:v})]}),e.jsxs(I,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx($,{children:"Tu información de pago está protegida con encriptación SSL. No almacenamos datos de tarjetas de crédito."})]}),e.jsx(p,{type:"submit",disabled:!i||g,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Procesando pago..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Pagar $",u.toFixed(2)," MXN"]})})]})})]})]})}const xe=K("pk_test_51RMAjuGG6sO0c1pHaEQFnqIV4IlSduHlwslnZ8qDdLto0VkvrEnHK646uRZRiMa5QKZMk7Ruqh7e8stvsN5WOF2Y00P8IDzUm4"),pe=N.object({participantName:N.string().min(2,"El nombre debe tener al menos 2 caracteres"),participantEmail:N.string().email("Debe proporcionar un email válido"),participantPhone:N.string().min(10,"El teléfono debe tener al menos 10 dígitos"),notes:N.string().optional()});function he({event:a}){var d;const{toast:s}=M(),l=V(),[f,m]=D.useState(!1),[i,h]=D.useState(null),r=X({resolver:Z(pe),defaultValues:{participantName:"",participantEmail:"",participantPhone:"",notes:""}}),g=B({mutationFn:async t=>W(`/api/events/${a.id}/register`,{method:"POST",data:{fullName:t.participantName,email:t.participantEmail,phone:t.participantPhone,notes:t.notes}}),onSuccess:()=>{s({title:"¡Inscripción exitosa!",description:a.requiresApproval?"Tu solicitud ha sido enviada y será revisada. Recibirás una confirmación por correo electrónico.":"Te has inscrito exitosamente. Recibirás una confirmación por correo electrónico."}),r.reset(),l.invalidateQueries({queryKey:[`/api/events/${a.id}`]})},onError:t=>{s({title:"Error en la inscripción",description:t.message||"No se pudo completar la inscripción. Inténtalo de nuevo.",variant:"destructive"})}}),x=t=>{a.price&&a.price>0&&!a.isFree?(h(t),m(!0)):g.mutate(t)},v=()=>{m(!1),h(null),r.reset(),s({title:"¡Pago e inscripción exitosos!",description:"Tu pago ha sido procesado y te has inscrito exitosamente al evento."}),l.invalidateQueries({queryKey:[`/api/events/${a.id}`]})},o=t=>{s({title:"Error en el pago",description:t,variant:"destructive"})};if(a.registrationType!=="registration")return null;const u=((d=a.registrations)==null?void 0:d.length)||0,E=!a.capacity||u<a.capacity,P=a.registrationDeadline?new Date>new Date(a.registrationDeadline):!1,C=new Date>new Date(a.startDate);return!E||P||C?e.jsxs(n,{className:"mt-4",children:[e.jsx(y,{children:e.jsxs(w,{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Inscripciones no disponibles"]})}),e.jsx(c,{children:e.jsxs("p",{className:"text-gray-600",children:[!E&&"El evento ha alcanzado su capacidad máxima.",P&&"La fecha límite de inscripción ha pasado.",C&&"Este evento ya ha finalizado."]})})]}):f&&i?e.jsxs(n,{className:"mt-4",children:[e.jsx(y,{children:e.jsxs(w,{className:"text-green-600 flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Completar Pago"]})}),e.jsxs(c,{children:[e.jsx(J,{stripe:xe,children:e.jsx(me,{eventId:a.id.toString(),event:{id:a.id,title:a.title,price:a.price||0,isFree:a.isFree},participantData:{fullName:i.participantName,email:i.participantEmail,phone:i.participantPhone,additionalInfo:i.notes},onSuccess:v,onError:o})}),e.jsx(p,{variant:"outline",onClick:()=>m(!1),className:"mt-4 w-full",children:"Cancelar pago"})]})]}):e.jsxs(n,{className:"mt-4",children:[e.jsxs(y,{children:[e.jsxs(w,{className:"text-green-600 flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"¡Inscríbete a este evento!"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Completa el formulario para registrarte",a.requiresApproval&&" (sujeto a aprobación)"]})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Plazas disponibles:"}),e.jsx("span",{className:"font-medium text-green-600",children:a.capacity?`${a.capacity-u} de ${a.capacity} personas`:"Sin límite"})]}),a.registrationDeadline&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Fecha límite:"}),e.jsx("span",{className:"font-medium text-orange-600",children:ee(new Date(a.registrationDeadline),"dd/MM/yyyy",{locale:se})})]}),a.price&&a.price>0&&!a.isFree&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Precio:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",a.price," MXN"]})]})]}),e.jsxs("form",{onSubmit:r.handleSubmit(x),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre completo *"}),e.jsx("input",{type:"text",...r.register("participantName"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Tu nombre completo"}),r.formState.errors.participantName&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.formState.errors.participantName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correo electrónico *"}),e.jsx("input",{type:"email",...r.register("participantEmail"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"tu@email.com"}),r.formState.errors.participantEmail&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.formState.errors.participantEmail.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono *"}),e.jsx("input",{type:"tel",...r.register("participantPhone"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"(555) 123-4567"}),r.formState.errors.participantPhone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.formState.errors.participantPhone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comentarios adicionales"}),e.jsx("textarea",{...r.register("notes"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",rows:3,placeholder:"¿Alguna pregunta o información adicional?"})]}),e.jsxs(p,{type:"submit",disabled:g.isPending,className:"w-full bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),g.isPending?"Procesando...":a.isFree||!a.price||a.price===0?"Inscribirse gratis":`Inscribirse - $${a.price} MXN`]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:a.requiresApproval?"Tu solicitud será revisada y recibirás una confirmación por correo electrónico":"Recibirás una confirmación inmediata por correo electrónico"})]})]})}const je=()=>{const{id:a}=ae(),{data:s,isLoading:l,error:f}=re({queryKey:[`/api/events/${a}`],enabled:!!a}),m=r=>new Date(r).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),i=r=>r?r.slice(0,5):"";if(l)return e.jsx(k,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded mb-6"}),e.jsx("div",{className:"h-64 bg-gray-300 rounded-lg mb-6"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-4"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-4 w-2/3"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]})})})});if(f||!s)return e.jsx(k,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Evento no encontrado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"El evento que buscas no existe o ha sido eliminado."}),e.jsx(p,{asChild:!0,children:e.jsxs(R,{href:"/events",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Volver a eventos"]})})]})})});const h={Benéficos:"#06B6D4",Culturales:"#8B5CF6",Deportivos:"#10B981",Empresariales:"#3B82F6",Gubernamentales:"#EF4444",Sociales:"#EC4899"};return e.jsx(k,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{variant:"ghost",asChild:!0,className:"hover:bg-green-50",children:e.jsxs(R,{href:"/events",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Volver a eventos"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Compartir"]}),e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(n,{className:"overflow-hidden",children:e.jsxs("div",{className:"aspect-video bg-gradient-to-br from-green-100 to-blue-100 relative",children:[s.featuredImageUrl?e.jsx("img",{src:s.featuredImageUrl,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(S,{className:"h-16 w-16 text-green-600/30"})}),e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-white/90",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:s.parks&&s.parks.length>0?s.parks[0].name:s.location})]}),e.jsx(T,{className:"text-xs border shadow-sm font-medium text-white",style:{backgroundColor:h[s.eventType]||"#3B82F6",borderColor:"rgba(255,255,255,0.3)"},children:s.eventType}),e.jsx(T,{className:"text-xs border shadow-sm font-semibold",style:{backgroundColor:s.status==="published"?"#10B981":"#6B7280",color:"white",borderColor:"white"},children:s.status==="published"?"Activo":"Borrador"})]})]})]})}),e.jsx(n,{className:"mt-4",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Descripción"}),e.jsx("p",{className:"text-gray-700 text-lg leading-relaxed",children:s.description})]})}),e.jsx(he,{event:s})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(n,{className:"bg-gradient-to-br from-green-50 to-blue-50 border-green-200",children:e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-green-600"}),"Detalles del Evento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Fecha"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[m(s.startDate),s.endDate!==s.startDate&&` - ${m(s.endDate)}`]})]})]}),s.startTime&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ne,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Horario"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[i(s.startTime),s.endTime&&` - ${i(s.endTime)}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(b,{className:"h-5 w-5 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Ubicación"}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.location})]})]}),s.capacity&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(le,{className:"h-5 w-5 text-purple-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Capacidad"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[s.capacity," personas"]})]})]})]})]})}),s.geolocation&&e.jsx(n,{children:e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-red-600"}),"Cómo llegar"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("a",{href:`https://www.google.com/maps?q=${s.geolocation.lat},${s.geolocation.lng}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(b,{className:"h-4 w-4"}),"Abrir en Google Maps"]}),e.jsxs("a",{href:`https://waze.com/ul?ll=${s.geolocation.lat},${s.geolocation.lng}&navigate=yes`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(b,{className:"h-4 w-4"}),"Abrir en Waze"]})]})})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-gray-600"}),"Información de Contacto"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:s.organizerName}),s.organizerOrganization&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.organizerOrganization})]}),e.jsxs("div",{className:"flex items-center justify-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(oe,{className:"h-4 w-4 text-gray-600"}),e.jsx("a",{href:`mailto:${s.organizerEmail}`,className:"text-blue-600 hover:text-blue-800 transition-colors text-sm",children:s.organizerEmail})]}),s.organizerPhone&&e.jsxs("div",{className:"flex items-center justify-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(de,{className:"h-4 w-4 text-gray-600"}),e.jsx("a",{href:`tel:${s.organizerPhone}`,className:"text-blue-600 hover:text-blue-800 transition-colors text-sm",children:s.organizerPhone})]})]})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Información Adicional"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-gray-600",children:"Audiencia:"}),e.jsx("span",{className:"font-medium",children:s.targetAudience==="all"?"Público general":s.targetAudience==="adults"?"Adultos":s.targetAudience==="children"?"Niños":s.targetAudience==="seniors"?"Adultos mayores":s.targetAudience})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-gray-600",children:"Registro:"}),e.jsx("span",{className:"font-medium",children:s.registrationType==="registration"?"Requerido":s.registrationType==="free"?"Libre acceso":"No especificado"})]}),s.isRecurring&&e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-gray-600",children:"Recurrente:"}),e.jsx("span",{className:"font-medium",children:"Sí"})]})]})]})}),s.registrationType==="registration"&&s.status==="published"&&e.jsx(n,{className:"bg-gradient-to-r from-green-500 to-green-600",children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"¿Te interesa?"}),e.jsx("p",{className:"text-green-100 mb-4 text-sm",children:"Regístrate para participar en este evento."}),e.jsx(p,{className:"w-full bg-white text-green-600 hover:bg-green-50",size:"lg",children:"Registrarse"})]})})]})]})})]})})};export{je as default};
