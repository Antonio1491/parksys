import{aH as X,l as _,az as Z,a4 as u,u as U,ar as ee,j as e,bh as F,B as m,A as ae,f as j,g,h as N,w as B,i as v,aa as se,ab as ie,ac as re,V as o,b0 as le,a5 as te,W as R,Y as G,_ as M,$ as Y,a0 as d,q as ce,X as T,M as ne,a1 as z,cp as oe}from"./index-BKCBrrzQ.js";import{F as V}from"./file-symlink-TOFqU66-.js";function ue(){var k,D,q;const[L,p]=X(),{toast:x}=_(),C=Z(),I=L.split("/"),h=I[I.length-1],[K,w]=u.useState(null),[f,P]=u.useState(""),[s,E]=u.useState({firstName:"",lastName:"",email:"",phone:"",specialties:[],experienceYears:1,bio:"",preferredParkId:void 0,qualifications:"",availability:"",hourlyRate:0,experience:"",profileImageFile:null,curriculumFile:null}),{data:c,isLoading:O,isError:Q}=U({queryKey:[`/api/instructors/${h}`],enabled:!!h}),{data:n=[]}=U({queryKey:["/api/parks"]});u.useEffect(()=>{console.log("游댌 DEBUG: Parks data:",n),console.log("游댌 DEBUG: Parks count:",(n==null?void 0:n.length)||0),n&&n.length>0&&console.log("游댌 DEBUG: Primera park:",n[0])},[n]),u.useEffect(()=>{if(c&&typeof c=="object"){const a=c;console.log("游댌 DEBUG: Datos del instructor cargados:",a),console.log("游댌 DEBUG: preferredParkId:",a.preferredParkId,typeof a.preferredParkId);let i=[];if(a.specialties){if(Array.isArray(a.specialties))i=a.specialties;else if(typeof a.specialties=="string")try{if(a.specialties.startsWith("[")||a.specialties.startsWith("{")){const t=JSON.parse(a.specialties);i=Array.isArray(t)?t:[t]}else a.specialties.includes(",")?i=a.specialties.split(",").map(t=>t.trim()):i=[a.specialties.trim()]}catch{i=[a.specialties]}}const r={firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phone:a.phone||"",specialties:i,experienceYears:a.experienceYears||1,bio:a.bio||"",preferredParkId:a.preferredParkId||void 0,qualifications:a.qualifications||"",availability:a.availability||"",hourlyRate:a.hourlyRate||0,experience:a.experience||"",profileImageFile:null,curriculumFile:null};console.log("游댌 DEBUG: Form data preparada:",r),console.log("游댌 DEBUG: preferredParkId en form data:",r.preferredParkId,typeof r.preferredParkId),E(r),a.profileImageUrl&&w(a.profileImageUrl)}},[c]);const y=ee({mutationFn:async a=>{const i=new FormData,r={firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone||"",specialties:a.specialties,experienceYears:a.experienceYears,experience:a.experience||"",qualifications:a.qualifications||"",availability:a.availability||"",hourlyRate:a.hourlyRate||0,preferredParkId:a.preferredParkId||void 0};i.append("data",JSON.stringify(r)),a.profileImageFile&&i.append("profileImage",a.profileImageFile),a.curriculumFile&&i.append("curriculum",a.curriculumFile);const t=await fetch(`/api/instructors/${h}`,{method:"PUT",body:i});if(!t.ok){const b=await t.json();throw new Error(b.message||"Error al actualizar instructor")}return await t.json()},onSuccess:()=>{x({title:"Instructor actualizado",description:"Los datos del instructor han sido actualizados exitosamente."}),C.invalidateQueries({queryKey:["/api/instructors"]}),C.invalidateQueries({queryKey:[`/api/instructors/${h}`]}),p("/admin/activities/instructors")},onError:a=>{x({title:"Error al actualizar",description:a.message,variant:"destructive"})}}),l=(a,i)=>{E(r=>({...r,[a]:i}))},$=a=>{var r;const i=(r=a.target.files)==null?void 0:r[0];if(i){const t=new FileReader;t.onload=b=>{var A;return w((A=b.target)==null?void 0:A.result)},t.readAsDataURL(i),l("profileImageFile",i)}},H=a=>{var r;const i=(r=a.target.files)==null?void 0:r[0];i&&l("curriculumFile",i)},S=()=>{if(f.trim()&&!s.specialties.includes(f.trim())){const a=[...s.specialties,f.trim()];l("specialties",a),P("")}},J=a=>{const i=s.specialties.filter(r=>r!==a);l("specialties",i)},W=a=>{if(a.preventDefault(),!s.firstName||!s.lastName||!s.email){x({title:"Campos requeridos",description:"Por favor completa los campos de nombre, apellido y email.",variant:"destructive"});return}if(s.specialties.length===0){x({title:"Especialidades requeridas",description:"Por favor agrega al menos una especialidad.",variant:"destructive"});return}y.mutate(s)};return O?e.jsx(F,{title:"Cargando...",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#00a587] mx-auto mb-4"}),e.jsx("p",{children:"Cargando datos del instructor..."})]})})}):Q?e.jsx(F,{title:"Error",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:"Error al cargar los datos del instructor"}),e.jsx(m,{onClick:()=>p("/admin/activities/instructors"),children:"Volver a la lista"})]})})}):e.jsx(F,{title:"Editar Instructor",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(m,{variant:"ghost",onClick:()=>p("/admin/activities/instructors"),className:"mr-4",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Editar Instructor"}),e.jsxs("p",{className:"text-muted-foreground",children:["Actualiza la informaci칩n del instructor ",c==null?void 0:c.firstName," ",c==null?void 0:c.lastName]})]})]})}),e.jsx("form",{onSubmit:W,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(B,{className:"mr-2 h-5 w-5"}),"Foto de Perfil"]})}),e.jsx(v,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs(se,{className:"h-32 w-32",children:[e.jsx(ie,{src:K||void 0}),e.jsxs(re,{className:"text-2xl",children:[(k=s.firstName)==null?void 0:k[0],(D=s.lastName)==null?void 0:D[0]]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{type:"file",accept:"image/*",onChange:$,className:"hidden",id:"profile-image"}),e.jsx("label",{htmlFor:"profile-image",children:e.jsx(m,{type:"button",variant:"outline",size:"sm",asChild:!0,children:e.jsxs("span",{className:"cursor-pointer",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Cambiar foto"]})})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Formatos: JPG, PNG. M치x: 5MB"})]})})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(B,{className:"mr-2 h-5 w-5"}),"Informaci칩n Personal"]})}),e.jsxs(v,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"firstName",className:"text-sm font-medium",children:"Nombre *"}),e.jsx(o,{id:"firstName",placeholder:"Nombre del instructor",value:s.firstName,onChange:a=>l("firstName",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"lastName",className:"text-sm font-medium",children:"Apellido *"}),e.jsx(o,{id:"lastName",placeholder:"Apellido del instructor",value:s.lastName,onChange:a=>l("lastName",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email *"}),e.jsx(o,{id:"email",type:"email",placeholder:"email@ejemplo.com",value:s.email,onChange:a=>l("email",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium",children:"Tel칠fono"}),e.jsx(o,{id:"phone",placeholder:"(33) 1234-5678",value:s.phone,onChange:a=>l("phone",a.target.value)})]})]})]}),e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(te,{className:"mr-2 h-5 w-5"}),"Informaci칩n Profesional"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"experienceYears",className:"text-sm font-medium",children:"A침os de Experiencia"}),e.jsx(o,{id:"experienceYears",type:"number",min:"0",max:"50",value:s.experienceYears,onChange:a=>l("experienceYears",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"hourlyRate",className:"text-sm font-medium",children:"Tarifa por Hora (MXN)"}),e.jsx(o,{id:"hourlyRate",type:"number",min:"0",placeholder:"0",value:s.hourlyRate,onChange:a=>l("hourlyRate",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"availability",className:"text-sm font-medium",children:"Disponibilidad"}),e.jsxs(R,{value:s.availability,onValueChange:a=>l("availability",a),children:[e.jsx(G,{children:e.jsx(M,{placeholder:"Selecciona disponibilidad"})}),e.jsxs(Y,{children:[e.jsx(d,{value:"full-time",children:"Tiempo completo"}),e.jsx(d,{value:"part-time",children:"Medio tiempo"}),e.jsx(d,{value:"weekends",children:"Fines de semana"}),e.jsx(d,{value:"evenings",children:"Tardes"}),e.jsx(d,{value:"mornings",children:"Ma침anas"}),e.jsx(d,{value:"flexible",children:"Flexible"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Especialidades *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{placeholder:"Ej: Yoga, Danza, Deportes acu치ticos",value:f,onChange:a=>P(a.target.value),onKeyPress:a=>a.key==="Enter"&&(a.preventDefault(),S())}),e.jsx(m,{type:"button",onClick:S,variant:"outline",children:"Agregar"})]}),s.specialties.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.specialties.map((a,i)=>e.jsxs(ce,{variant:"secondary",className:"bg-[#00a587]/10 text-[#00a587]",children:[a,e.jsx("button",{type:"button",onClick:()=>J(a),className:"ml-2 hover:text-red-600",children:e.jsx(T,{className:"h-3 w-3"})})]},i))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Agrega las especialidades una por una"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"curriculumFile",className:"text-sm font-medium",children:"Curriculum Vitae"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 bg-gray-50",children:s.curriculumFile?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 truncate max-w-[200px]",children:s.curriculumFile.name})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>l("curriculumFile",null),children:e.jsx(T,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("label",{htmlFor:"curriculumUpload",className:"cursor-pointer inline-flex items-center gap-2 py-2 px-4 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(V,{className:"h-4 w-4"}),"Subir CV",e.jsx("input",{id:"curriculumUpload",type:"file",accept:".pdf,.doc,.docx",className:"hidden",onChange:H})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formatos: PDF, DOC, DOCX. M치x: 5MB"})]})})]})]})]}),e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(ne,{className:"mr-2 h-5 w-5"}),"Informaci칩n Adicional"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"preferredParkId",className:"text-sm font-medium",children:"Parque Preferido (Opcional)"}),e.jsxs(R,{value:((q=s.preferredParkId)==null?void 0:q.toString())||"no-preference",onValueChange:a=>l("preferredParkId",a==="no-preference"?void 0:parseInt(a)),children:[e.jsx(G,{children:e.jsx(M,{placeholder:"Selecciona un parque"})}),e.jsxs(Y,{children:[e.jsx(d,{value:"no-preference",children:"Sin preferencia"}),n.map(a=>e.jsx(d,{value:a.id.toString(),children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"qualifications",className:"text-sm font-medium",children:"Cualificaciones"}),e.jsx(z,{id:"qualifications",placeholder:"Describe las certificaciones, t칤tulos o cualificaciones del instructor...",value:s.qualifications,onChange:a=>l("qualifications",a.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"experience",className:"text-sm font-medium",children:"Experiencia / Biograf칤a"}),e.jsx(z,{id:"experience",placeholder:"Describe la experiencia profesional y biograf칤a del instructor...",value:s.experience,onChange:a=>l("experience",a.target.value),rows:4})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>p("/admin/activities/instructors"),children:"Cancelar"}),e.jsx(m,{type:"submit",disabled:y.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Guardar cambios"]})})]})]})]})})]})})}export{ue as default};
